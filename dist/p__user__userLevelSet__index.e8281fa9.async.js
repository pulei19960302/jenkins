(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[99],{AxmW:function(e,t,a){"use strict";a.r(t);a("14J3");var n,r,i,s=a("BMrR"),o=(a("+L6B"),a("2/Rp")),c=(a("IzEo"),a("bx4M")),l=(a("5NDa"),a("5rEg")),u=(a("giR+"),a("fyUT")),p=a("qIgq"),d=a.n(p),f=a("d6i3"),m=a.n(f),g=a("p0pE"),h=a.n(g),v=a("1l/V"),b=a.n(v),y=(a("miYZ"),a("tsqr")),E=a("2Taf"),k=a.n(E),I=a("vZ4D"),C=a.n(I),_=a("MhPg"),w=a.n(_),O=a("l4Ni"),S=a.n(O),x=a("ujKo"),J=a.n(x),N=a("q1tI"),j=a.n(N),L=a("Kvkj"),P=a("WsrF"),F=(a("XlDN"),a("1UUG")),q=a("78t4"),D=a("7Qib");function R(e){return function(){var t,a=J()(e);if(B()){var n=J()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return S()(this,t)}}function B(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var T=P["a"].Item,V=(n=P["a"].create(),n((i=function(e){w()(a,e);var t=R(a);function a(e){var n;return k()(this,a),n=t.call(this,e),n.rebatePatternChange=function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=JSON.parse(JSON.stringify(n.state.patternItems)),s=i.flat().length,o=n.state.rebateConfigs.length;switch(e){case"addPlus":s<o?i.push(r):y["a"].warning("\u9009\u9879\u6570\u91cf\u5df2\u8fbe\u4e0a\u9650");break;case"add":s<o?i[t].push(r):y["a"].warning("\u9009\u9879\u6570\u91cf\u5df2\u8fbe\u4e0a\u9650");break;case"change":i[t].splice(a,1,r);break;case"del":1===i[t].length?i.splice(t,1):i[t].splice(a,1);break}n.setState({patternItems:i}),console.log("patternItems",i)},n.upgradeConditionChange=function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=JSON.parse(JSON.stringify(n.state.conditionItems));switch(e){case"addPlus":i.push(r);break;case"add":i[t].push(r);break;case"change":i[t].splice(a,1,r);break;case"del":1===i[t].length?i.splice(t,1):i[t].splice(a,1);break}console.log(i),n.setState({conditionItems:i})},n.toogleLoading=function(e){n.setState({loading:e})},n.submit=function(){var e=n.props.form,t=n.state,a=t.conditionItems,r=t.patternItems,i=n.props.history.location.query.id;a=JSON.parse(JSON.stringify(a)),e.validateFields(function(){var e=b()(m.a.mark(function e(t,s){var o,c,l,u,p;return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=12;break}if(o=s.name,c=s.sort,l=s.is_verify,u=s.is_auto,p={name:o,sort:c,data:{upgrade:{is_verify:l,is_auto:u,rule:a.map(function(e){var t={};return e.forEach(function(e){e.value&&("goods_ids"===e.value&&(e.params=e.params.split(",")),t[e.value]=""===e.params?"":+e.params)}),t}).filter(function(e){return"{}"!==JSON.stringify(e)})},rebate:{rule:r.map(function(e){var t={};return e.forEach(function(e){e.value&&(t[e.value]=1)}),t}).filter(function(e){return"{}"!==JSON.stringify(e)})}}},void 0===i){e.next=8;break}return e.next=6,$api.user.editLevel(h()({id:i},p),{success:!0,loadingFn:n.toogleLoading});case 6:e.next=11;break;case 8:return e.next=10,$api.user.addLevel(p,{success:!0,loadingFn:n.toogleLoading});case 10:$api.user.userLevelList({},{cache:!0,cacheFresh:!0});case 11:n.props.history.goBack();case 12:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}())},n.state={conditionItems:[],patternItems:[],loading:!1,is_auto:0,rebateConfigs:[]},n}return C()(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.history.location.query.id,a=this.props.history.location.query.sort;if(void 0!==t&&$api.user.userLevelDetail({id:t}).then(function(t){console.log("datadatadatadatadatadata",t.data);var a=t.data,n=a.sort,r=a.name,i=a.rebate_configs,s=t.data.data,o=s.upgrade,c=s.rebate,l=o.is_auto,u=o.is_verify,p=e.props.form;setTimeout(function(){p.setFieldsValue({sort:n,name:r,is_auto:l,is_verify:u})},0);var f=c.rule.reduce(function(e,t){var a=[];return Object.keys(t).forEach(function(e){i[e]&&a.push(Object(F["getPatternItems"])(e))}),a.length>0&&e.push(a),e},[]),m=o.rule.reduce(function(e,t){return e.push(Object.keys(t).map(function(e){return"goods_ids"===e&&(t[e]=t[e].join(",")),Object(F["getPatternItems"])(e,t[e])})),e},[]);e.setState({patternItems:f,conditionItems:m,is_auto:l,rebateConfigs:Object.entries(i).map(function(e){var t=d()(e,2),a=t[0],n=t[1];return{name:n,value:a,uuid:Object(D["b"])()}})})}).catch(function(t){setTimeout(function(){e.props.history.replace("/user/userLevel")},2500)}),a){var n=this.props.form;setTimeout(function(){n.setFieldsValue({sort:a})},0)}}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,n=this.rebatePatternChange,r=this.upgradeConditionChange,i=this.submit,p=this.state,d=p.conditionItems,f=p.patternItems,m=p.loading,g=p.rebateConfigs,h={labelCol:{span:3},wrapperCol:{span:6}},v={rules:[{required:!0,message:"\u8bf7\u586b\u5199"}]};return j.a.createElement(L["x"],{inner:!0,style:{background:"inherit",padding:0}},j.a.createElement(P["a"],h,j.a.createElement(c["a"],{style:{marginBottom:16}},j.a.createElement(L["y"],{title:"\u57fa\u672c\u4fe1\u606f"}),j.a.createElement(T,{label:"\u7b49\u7ea7"},a("sort",v)(j.a.createElement(u["a"],{disabled:!0,style:{width:"100%"},placeholder:"\u8bf7\u8f93\u5165"}))),j.a.createElement(T,{label:"\u7b49\u7ea7\u540d\u79f0"},a("name",v)(j.a.createElement(l["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),j.a.createElement(c["a"],{style:{marginBottom:16}},j.a.createElement(L["y"],{title:"\u664b\u5347\u673a\u5236"}),j.a.createElement(T,{label:"\u662f\u5426\u81ea\u52a8\u5347\u7ea7"},a("is_auto",{initialValue:0})(j.a.createElement(L["m"],{onChange:function(t){e.setState({is_auto:t})}}))),!!this.state.is_auto&&j.a.createElement(N["Fragment"],null,j.a.createElement(T,{label:"\u662f\u5426\u9700\u8981\u5ba1\u6838"},a("is_verify",{initialValue:0})(j.a.createElement(L["m"],null))),j.a.createElement(q["default"],{conditionItems:d,upgradeConditionChange:r}))),j.a.createElement(c["a"],{style:{marginBottom:16}},j.a.createElement(L["y"],{title:"\u8fd4\u5229\u6a21\u5f0f"}),j.a.createElement(F["default"],{patternItems:f,rebatePatternChange:n,rebateConfigs:g}))),j.a.createElement(s["a"],{type:"flex",justify:"center"},j.a.createElement(o["a"],{onClick:i,loading:m,type:"primary"},"\u63d0\u4ea4")))}}]),a}(N["PureComponent"]),r=i))||r);t["default"]=V}}]);