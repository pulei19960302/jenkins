(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"0Pmx":function(e,t,r){"use strict";r.r(t);var n,a,o,i=r("eHn4"),l=r.n(i),s=(r("2qtc"),r("kLXV")),c=r("BkRI"),d=r.n(c),u=r("2Taf"),f=r.n(u),p=r("vZ4D"),h=r.n(p),m=r("MhPg"),v=r.n(m),k=r("l4Ni"),y=r.n(k),g=r("ujKo"),w=r.n(g),_=r("wd/R"),b=r.n(_),S=r("MuoO"),L=r("q1tI"),C=r.n(L),E=r("Kvkj"),O=(r("5Dmo"),r("3S7+")),I=r("TFei"),M=[{value:I["h"].ORDER,title:"\u8ba2\u5355"},{value:I["h"].AFTERSALE,title:"\u552e\u540e"}],D=function(e){return e.reduce(function(e,t){return t.value&&(e[t.value]=t.title),e},{})},T=[{key:"worksheet_code",placeholder:"\u8bf7\u8f93\u5165\u5de5\u5355\u53f7"},{key:"time",searchKeys:["start_time","end_time"],placeholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"],type:"dateRange",initialValue:[b()().subtract(2,"days"),b()()]},{key:"customer_member_id",placeholder:"\u8bf7\u8f93\u5165\u5ba2\u6237ID"},{key:"create_member_phone",placeholder:"\u8bf7\u8f93\u5165\u521b\u5efa\u4eba/\u5ba2\u670d\u8d26\u53f7"},{key:"order_sn",placeholder:"\u8ba2\u5355\u53f7"},{key:"after_order_sn",placeholder:"\u552e\u540e\u670d\u52a1\u5355\u53f7"}],x=[{title:"\u5168\u90e8\u5de5\u5355",value:"-1",key:"total"},{title:"\u5904\u7406\u4e2d",value:I["k"].PROGRESS,key:"progress"},{title:"\u5df2\u5173\u95ed",value:I["k"].CLOSED,key:"closed"}],R=function(){var e=this;return[{title:"\u5de5\u5355\u53f7",dataIndex:"code"},{title:"\u5ba2\u6237\u8d26\u53f7",dataIndex:"customer_member_name",render:function(e,t){return C.a.createElement("span",null,e,"\xa0(",t.customer_member_id,")")}},{title:"\u5de5\u5355\u7c7b\u578b",dataIndex:"worksheet_type_name"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at"},{title:"\u521b\u5efa\u4eba",dataIndex:"create_member_phone"},{title:"\u5173\u8054\u5355\u636e\u6570\u91cf",dataIndex:"relation_num",render:function(t,r){var n=r.relation,a=void 0===n?[]:n,o=a&&a.map(function(t){var n=t.relation_sn_type,a=t.relation_sn,o=D(M)[n];return n===I["h"].AFTERSALE?C.a.createElement("div",null,"\u3010",o,"\u3011\xa0",C.a.createElement("a",{onClick:function(){e.onViewAfterSale(a,r.customer_member_id)}},a)):C.a.createElement("div",null,"\u3010",o,"\u3011\xa0",C.a.createElement("a",{onClick:function(){e.onViewOrderInfo(a,r.customer_member_id)}},a))});return C.a.createElement(O["a"],{title:o,placement:"bottomLeft",overlayStyle:{backgroundColor:"#fff",zIndex:"100"}},C.a.createElement("span",{style:{cursor:"pointer",color:"#12C2C2"}},t))}},{title:"\u5de5\u5355\u72b6\u6001",dataIndex:"status",render:function(e,t){return C.a.createElement("span",null,D(x)[e])}},{title:"\u5904\u7406\u4eba",dataIndex:"service_member_phone"},{title:"\u64cd\u4f5c",dataIndex:"operations",render:function(t,r){return Object(I["l"])("details")&&C.a.createElement("a",{onClick:function(){e.onViewDetail(r)}},"\u67e5\u770b\u8be6\u60c5")}}]},V=r("Bz3q"),A=r("M1UW"),j=r("w4ly");function q(e){return function(){var t,r=w()(e);if(P()){var n=w()(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return y()(this,t)}}function P(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var F=(n=Object(S["connect"])(function(e){var t=e.workOrderList,r=e.loading;return{workOrderList:t,loading:r}}),n((o=function(e){v()(r,e);var t=q(r);function r(e){var n;return f()(this,r),n=t.call(this,e),n.getTabs=function(){var e=n.props.workOrderList,t=e.tabsCount,r=void 0===t?{}:t,a=d()(x);return a.forEach(function(e){var t=r&&r[e.value]||0;e.title="".concat(e.title,"(").concat(t,")")}),a},n.getList=function(e){var t=n.props.dispatch;t({type:"workOrderList/getList",payload:e})},n.toggleTransferModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n.setState(function(t){return{afterModal:!t.afterModal,worksheet_codes:e}})},n.onTabsChange=function(e){var t=e.value,r=n.props.dispatch;r({type:"workOrderList/getTabsCount"}),r({type:"workOrderList/updateState",payload:{status:t}}),r({type:"workOrderList/getList",payload:{page:1}})},n.onSearch=function(e){var t=n.props.dispatch;t({type:"workOrderList/onSearch",payload:e}),t({type:"workOrderList/getList",payload:e})},n.onDisabled=function(e){return e.status===I["k"].CLOSED},n.onTransfer=function(e){n.toggleTransferModal(e)},n.onClose=function(e){s["a"].confirm({title:"\u786e\u8ba4\u5173\u95ed\u6240\u9009\u5de5\u5355\u4e48?",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){$api.workorder.close({worksheet_codes:e},{success:!0}).then(function(e){n.getList()})}})},n.onCloseDrawer=function(e){n.setState(l()({},e,!1))},n.onViewDetail=function(e){var t=e.code,r=void 0===t?"":t,a=e.im_conversation_key,o=void 0===a?"":a,i=n.props.history;i.push({pathname:"/customerService/workOrderDetail",query:{code:r,key:o}})},n.onViewAfterSale=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&$api.customerService.afterSaleList({search_sn:e,uid:t}).then(function(e){var t=e.data,r=t&&t[0];n.setState({afterSaleModal:!0,order:r})})},n.onViewOrderInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&$api.customerService.orderDetail({order_sn:e,uid:t}).then(function(e){var t=e.data;n.setState({orderInfoModal:!0,order:t})})},n.mutipulClick=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&arguments[2];var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=t&&t.map(function(e){return e.code});switch(e){case"transfer":n.onTransfer(r);break;case"close":n.onClose(r);break}},n.state={afterSaleModal:!1,orderInfoModal:!1,afterModal:!1,worksheet_codes:"",order:null},n}return h()(r,[{key:"render",value:function(){var e=this,t=this.state,r=t.afterSaleModal,n=t.orderInfoModal,a=t.afterModal,o=t.worksheet_codes,i=t.order,l=this.props,s=l.workOrderList,c=l.loading,d=s.list,u=void 0===d?[]:d,f=s.pagination,p=s.status,h=s.query,m={search:h},v={type:"export",url:"",query:h},k=[{name:"\u6279\u91cf\u8f6c\u79fb",key:"transfer",permission:Object(I["l"])("transfer")},{name:"\u6279\u91cf\u5173\u95ed",key:"close",permission:Object(I["l"])("close")}].filter(function(e){return e.permission});return C.a.createElement(E["x"],{inner:!0,className:K.workList},C.a.createElement(E["E"],{defaultActiveKey:p,tabs:this.getTabs(),onChange:this.onTabsChange,btns:[v]}),C.a.createElement(E["i"],{dataSource:u,getList:this.getList,onSearch:this.onSearch,pagination:f,loading:c.effects["workOrderList/getList"],searchFields:T,columns:R.call(this),searchProp:m,mutipulBtns:k,mutipulClick:this.mutipulClick,onDisabled:this.onDisabled}),C.a.createElement(j["a"],{onCancel:function(){e.onCloseDrawer("afterSaleModal")},modalVisible:r,order:i}),C.a.createElement(V["a"],{onCancel:function(){e.onCloseDrawer("orderInfoModal")},modalVisible:n,order:i}),C.a.createElement(A["a"],{visible:a,onCancel:this.toggleTransferModal,onOk:function(){e.getList(),e.toggleTransferModal()},worksheet_codes:o}))}}]),r}(L["PureComponent"]),a=o))||a),K=t["default"]=F}}]);