webpackJsonp([34],{T099:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("IHPB"),i=o.n(a),s=o("lC5x"),n=o.n(s),l=o("J0Oq"),c=o.n(l),r=o("4YfN"),d=o.n(r),h=o("8Rg7"),u=o("48sp"),p=[{prop:"1",type:"selection",fixed:!0},{prop:"id",label:"商品ID"},{prop:"thumb",label:"商品缩略图",handle:!0},{prop:"title",label:"商品主标题"},{prop:"title_1",label:"商品分类"},{prop:"start_at",label:"上架时间"},{prop:"shop_price_1",label:"状态"},{prop:"shop_price",label:"售价（元）"},{prop:"stock",label:"库存"},{prop:"cost_price",label:"佣金"}],m={mixins:[h.a],props:{showChooseGoods:{type:Boolean},specialId:{type:String},choosedGoodsId:[Array]},data:function(){return{chooseGoodsVisible:!1,searchOPtions:[{type:"select",key:"is_select",placeholder:"选中状态",options:[{label:"已选中",value:"1"},{label:"未选中",value:"0"}]},{type:"input",key:"keywords",placeholder:"商品ID / 商品名称"},{type:"dateRangePicker",key:"time",placeholder:"上架时间"}],Colums:p,selected:[],multipleSelection:[]}},computed:d()({},Object(u.e)("product",["allGoods","allCategories"])),watch:{showChooseGoods:function(e){this.chooseGoodsVisible=e},chooseGoodsVisible:function(e){this.$emit("update:showChooseGoods",e),this.chooseGoodsVisible&&this.getData()},choosedGoodsId:function(e){var t=this;this.tableData.forEach(function(e){t.choosedGoodsId.includes(e.id)?t.$refs.multipleTable.toggleRowSelection(e,!0):t.$refs.multipleTable.toggleRowSelection(e,!1)})}},created:function(){var e=this;this.searchOPtions.forEach(function(t){"cate_id"===t.key&&(t.options=e.allCategories)})},methods:d()({},Object(u.b)("product",["getAllGoods"]),{handleSelectionChange:function(e){var t=this.findLinkId(),o=t.linked,a=t.noLink;o=e.map(function(e){return e.id}),this.$emit("update:choosedGoodsId",a.concat(o))},findLinkId:function(){var e=this.tableData.map(function(e){return e.id}),t=[],o=[];return this.choosedGoodsId.forEach(function(a){e.includes(a)?t.push(a):o.push(a)}),{linked:t,noLink:o}},getData:function(){var e=this;return c()(n.a.mark(function t(){var o,a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,e.query.cate_id&&0!==e.query.cate_id.length&&(e.query.cate_id=e.query.cate_id[e.query.cate_id.length-1]),e.query.is_select?e.query.special_id=e.specialId:e.query.special_id=void 0,t.next=5,e.$api.common.getGoodsList(d()({},e.query,{pageSize:e.pageSize,page:e.current}));case 5:o=t.sent,a=o.data,e.loading=!1,s=[].concat(i()(e.choosedGoodsId)),e.tableData=a.list.items,e.count=a.list.count,e.$nextTick(function(){0!==s.length&&e.$emit("update:choosedGoodsId",s)});case 12:case"end":return t.stop()}},t,e)}))()}})},f={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("RightSidePopup",{staticStyle:{width:"60%"},attrs:{visible:e.chooseGoodsVisible},on:{"update:visible":function(t){e.chooseGoodsVisible=t}}},[o("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}}),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",border:"none",borderBottom:"1px solid #e8e8e8"}},on:{"selection-change":e.handleSelectionChange}},[e._l(e.Colums,function(t){return[t.handle?e._e():o("el-table-column",{key:t.prop,attrs:{prop:t.prop,fixed:t.fixed,align:"center",label:t.label,type:t.type}}),e._v(" "),t.handle?o("el-table-column",{key:t.prop,attrs:{prop:t.prop,fixed:t.fixed,align:"center",label:t.label,type:t.type},scopedSlots:e._u([{key:"default",fn:function(e){return"thumb"===t.prop?[o("img",{staticClass:"table-img",attrs:{src:e.row.thumb}})]:void 0}}],null,!0)}):e._e()]})],2),e._v(" "),o("Pagination",{attrs:{current:e.current,pageSize:e.pageSize,count:e.count},on:{pageChangeCBK:e.handlePageChange,sizeChangeCBK:e.handleSizeChange}})],1)},staticRenderFns:[]};var g=[{value:"1",name:"H5链接"},{value:"2",name:"商品分类"},{value:"3",name:"商品详情"},{value:"other",name:"其他"}],v=[{value:"7",name:"外联"},{value:"4",name:"我的订单"},{value:"5",name:"富文本(新人导航)"},{value:"6",name:"优惠券"},{value:"9",name:"直播"},{value:"8",name:"不跳转"}],y={name:"specialManager",components:{ChooseGoods:o("C7Lr")(m,f,!1,function(e){o("njlD")},"data-v-5c6a6cd7",null).exports},data:function(){return{listData:[],wayList:g,wayListOther:v,chooseIndex:-1,choose_good_ids:[],showChooseGoods:!1,btnLoading:!0}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.$api.activity.getSpecialList({}).then(function(t){t.data.data.forEach(function(e){e.otherWay="7",e.way&&(parseInt(e.way,10)<4?e.otherWay="7":(e.otherWay=e.way,e.way="other"))}),e.listData=t.data.data,e.btnLoading=!1}).catch(function(e){})},onRadiochange:function(e,t){"1"===e.way&&(this.chooseIndex=t,this.showChooseGoods=!0,this.choose_good_ids=e.extra.id||[])},addItem:function(){this.listData.push({otherWay:"7",extra:{id:[]}})},deleteItem:function(e,t){var o=this;e.id?this.$confirm("确认删除该专题设置，删除后不可恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.btnLoading=!0,o.$api.activity.deleteSpecial({id:e.id}).then(function(e){o.listData.splice(t,1),o.$message({type:"success",message:"删除成功!"})}).finally(function(e){o.btnLoading=!1})}):this.listData.splice(t,1)},submit:function(){var e=this;this.btnLoading=!0;var t=[].concat(i()(this.listData));t.forEach(function(e){"other"===e.way&&(e.way=e.otherWay),e.otherWay=void 0}),this.$api.activity.editSpecial({data:t}).then(function(t){e.$message({type:"success",message:"提交成功!"}),e.getList()}).catch(function(t){e.btnLoading=!1})}},watch:{showChooseGoods:{handler:function(e){!1===this.showChooseGoods&&(this.listData[this.chooseIndex].extra.id=this.choose_good_ids,this.chooseIndex=-1,this.choose_good_ids=[])}}}},b={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{className:"specialManager"}},[o("el-form",{attrs:{"label-position":"right","label-width":"100px"}},[o("el-row",{attrs:{gutter:20}},[e._l(e.listData,function(t,a){return o("el-col",{key:a,attrs:{span:8}},[o("div",{staticClass:"grid-content"},[o("i",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.activity.specialManager.delete],expression:"[$api.activity.specialManager.delete]"}],staticClass:"el-icon-close",on:{click:function(o){return e.deleteItem(t,a)}}}),e._v(" "),o("div",{staticClass:"form-content"},[o("el-form-item",{attrs:{label:"专题名称："}},[o("el-input",{model:{value:t.name,callback:function(o){e.$set(t,"name",o)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"实现方式："}},[e._l(e.wayList,function(i){return o("el-radio",{key:i.value,attrs:{label:i.value},on:{change:function(o){return e.onRadiochange(t,a)}},model:{value:t.way,callback:function(o){e.$set(t,"way",o)},expression:"form.way"}},[e._v(e._s(i.name))])}),e._v(" "),o("el-select",{attrs:{placeholder:"请选择活动区域"},model:{value:t.otherWay,callback:function(o){e.$set(t,"otherWay",o)},expression:"form.otherWay"}},e._l(e.wayListOther,function(e){return o("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1)],2),e._v(" "),o("el-form-item",{attrs:{label:"参数："}},[o("el-input",{model:{value:t.param,callback:function(o){e.$set(t,"param",o)},expression:"form.param"}})],1),e._v(" "),"1"===t.way?o("el-form-item",{attrs:{label:"已选商品："}},[o("span",{staticClass:"detail-btn",on:{click:function(o){o.stopPropagation(),e.showChooseGoods=!0,e.choose_good_ids=t.extra.id||[],e.chooseIndex=a}}},[e._v("查看详情")])]):e._e()],1)])])}),e._v(" "),o("el-col",{attrs:{span:8}},[o("div",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.activity.specialManager.edit],expression:"[$api.activity.specialManager.edit]"}],staticClass:"grid-content",staticStyle:{cursor:"pointer"},on:{click:e.addItem}},[o("i",{staticClass:"el-icon-plus"})])])],2)],1),e._v(" "),o("div",{staticClass:"submit"},[o("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.activity.specialManager.edit],expression:"[$api.activity.specialManager.edit]"}],attrs:{type:"primary",size:"medium",loading:e.btnLoading},on:{click:e.submit}},[e._v("提 交")])],1),e._v(" "),o("ChooseGoods",{attrs:{specialId:(e.listData[e.chooseIndex]||{}).id,choosedGoodsId:e.choose_good_ids,showChooseGoods:e.showChooseGoods},on:{"update:choosedGoodsId":function(t){e.choose_good_ids=t},"update:choosed-goods-id":function(t){e.choose_good_ids=t},"update:showChooseGoods":function(t){e.showChooseGoods=t},"update:show-choose-goods":function(t){e.showChooseGoods=t}}})],1)},staticRenderFns:[]};var _=o("C7Lr")(y,b,!1,function(e){o("viVh")},"data-v-050f0a99",null);t.default=_.exports},njlD:function(e,t){},viVh:function(e,t){}});