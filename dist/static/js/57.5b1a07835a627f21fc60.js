webpackJsonp([57],{"8p42":function(e,t){},PjdO:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("4YfN"),i=r.n(a),n=r("rVsN"),o=r.n(n),l=r("aA9S"),s=r.n(l),c=r("IHPB"),u=r.n(c),p=r("lC5x"),d=r.n(p),m=r("J0Oq"),v=r.n(m),h={0:"无",10:"售后",1:"咨询"},f={name:"memberManagement",data:function(){return{drawerVisible:!1,id:null,adminGroup:[],simpleRule:{required:!0,message:"必填项",trigger:"change"},ruleForm:{username:"",name:"",role:"",sex:1,phone:"",email:"",group_id:[],password:"",service_type:""},roles:[],rules:{},avatar:[],visible:!1,previewImg:"",loading:!1,page:1,pageSize:10,count:0,current:1,query:{},tableData:[],searchOPtions:[{type:"input",key:"username",placeholder:"用户名"},{type:"cascader",key:"group_id",placeholder:"所属部门",options:[]}],service_map:h}},created:function(){var e=this;this.gettAdminGroupDataDrawer(),this.getRoles(),this.gettAdminGroupData().then(function(t){t&&e.getData()})},methods:{formatDrawer:function(e){var t=this;return e.map(function(e){return e.children&&e.children.length>0?{value:""+e.id,label:e.name,children:t.formatDrawer(e.children)}:{value:""+e.id,label:e.name}})},handleEdit:function(e){this.id=e,this.drawerVisible=!0,this.getAdminMemberDetail(e)},gettAdminGroupDataDrawer:function(){var e=this;return v()(d.a.mark(function t(){var r,a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.jurisdiction.tree();case 3:r=t.sent,a=r.data,e.adminGroup=e.formatDrawer(a.tree),t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(0),new Error(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},getRoles:function(){var e=this;return v()(d.a.mark(function t(){var r,a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.jurisdiction.getRoleList();case 3:r=t.sent,a=r.data,e.roles=a.items,t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(0),new Error(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},getAdminMemberDetail:function(e){var t=this;return v()(d.a.mark(function r(){var a,i,n;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.jurisdiction.getAdminMemberDetail({id:e});case 3:for(n in a=r.sent,i=a.data,t.ruleForm)t.ruleForm[n]=i[n];t.avatar=[{name:"avatar",url:i.avatar}],t.ruleForm.group_id=[].concat(u()(i.position.split(","))),r.next=13;break;case 10:throw r.prev=10,r.t0=r.catch(0),new Error(r.t0);case 13:case"end":return r.stop()}},r,t,[[0,10]])}))()},getsuccessUpload:function(e){this.avatar=[{name:"avatar",url:e[0]}]},submit:function(){var e,t=this;this.$refs.ruleForm.validate((e=v()(d.a.mark(function e(r){var a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=21;break}if(e.prev=1,(a=s()({},t.ruleForm)).position=[].concat(u()(a.group_id)).join(",")||",",a.group_id=[].concat(u()(a.group_id)).splice(-1,1)[0]||0,t.avatar.length>0&&(a.avatar=t.avatar[0].url),!t.id){e.next=12;break}return a.id=t.id,e.next=10,t.$api.jurisdiction.EditAdminMember(a);case 10:e.next=14;break;case 12:return e.next=14,t.$api.jurisdiction.AddAdminMember(a);case 14:t.drawerVisible=!1,t.gettAdminGroupData().then(function(e){e&&t.getData()}),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(1),new Error(e.t0);case 21:case"end":return e.stop()}},e,t,[[1,18]])})),function(t){return e.apply(this,arguments)}))},resetForm:function(e){this.$refs[e].resetFields()},format:function(e){var t=this;return e.map(function(e){return e.children&&e.children.length>0?{value:e.id,label:e.name,children:t.format(e.children)}:{value:e.id,label:e.name}})},gettAdminGroupData:function(){var e=this;return v()(d.a.mark(function t(){var r,a,i;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.jurisdiction.tree();case 3:return r=t.sent,a=r.data,i=e.format(a.tree),e.searchOPtions.map(function(e){"group_id"===e.key&&(e.options=[].concat(u()(i)))}),t.abrupt("return",o.a.resolve(!0));case 10:throw t.prev=10,t.t0=t.catch(0),new Error(t.t0);case 14:case"end":return t.stop()}},t,e,[[0,10]])}))()},handlePageChange:function(e){this.page=e,this.getData()},handleSizeChange:function(e){this.pageSize=e,this.getData()},handelSearch:function(e,t){var r=this;console.log(">>>>>> type",e),console.log(">>>>>> query",t),{search:function(){t.group_id&&(t.group_id=[].concat(u()(t.group_id)).splice(-1,1)),r.query=i()({},t),r.page=1,r.getData()},reset:function(){r.query={},r.pageSize=10,r.page=1,r.getData()}}[e]()},getData:function(){var e=this;return v()(d.a.mark(function t(){var r,a,i;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,(r=s()({},e.query)).page=e.page,r.pageSize=e.pageSize,t.next=7,e.$api.jurisdiction.getAdminMemberList(r);case 7:a=t.sent,i=a.data,e.loading=!1,e.tableData=i.items,e.count=i.count,t.next=18;break;case 14:throw t.prev=14,t.t0=t.catch(0),e.loading=!1,new Error(t.t0);case 18:case"end":return t.stop()}},t,e,[[0,14]])}))()},jumpTo:function(e,t){this.$router.push({name:e,params:{id:t}})},handleDel:function(e){var t=this;this.$confirm("确认删除选中成员？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(v()(d.a.mark(function r(){return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.jurisdiction.DelAdminMember({id:e});case 3:t.getData(),r.next=9;break;case 6:throw r.prev=6,r.t0=r.catch(0),new Error(r.t0);case 9:case"end":return r.stop()}},r,t,[[0,6]])})))}}},g={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"min-height":"calc(100vh - 135px)",background:"#fff"}},[r("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}},[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.jurisdiction.admincp_member.add],expression:"[$api.jurisdiction.admincp_member.add]"}],attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){t.stopPropagation(),e.id=null,e.drawerVisible=!0,e.avatar=[],e.resetForm("ruleForm")}}},[e._v("添加")])],1),e._v(" "),[r("div",{staticStyle:{padding:"0 16px 16px 16px",background:"#fff","border-radius":"0 0 4px 4px"}},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"header-cell-class-name":"n-table-header-cell-class","cell-class-name":"n-table-cell-class"}},[r("el-table-column",{attrs:{prop:"username",label:"用户名","min-width":"180"}}),e._v(" "),r("el-table-column",{attrs:{label:"头像",prop:"avatar","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.avatar?e._e():r("span",[e._v("--")]),e._v(" "),t.row.avatar?r("img",{staticStyle:{width:"40px",height:"40px"},attrs:{src:t.row.avatar},on:{click:function(r){e.previewImg=t.row.avatar,e.visible=!0}}}):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"工作手机",prop:"phone","min-width":"140"}}),e._v(" "),r("el-table-column",{attrs:{label:"所属部门",prop:"group_id","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(""===t.row.group_name?"--":t.row.group_name))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"对应角色",prop:"role","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("validVal")(t.row.role)))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"客服类型",prop:"service_type","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.service_map[t.row.service_type]))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"添加时间",prop:"created_at","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("validDateTime")(t.row.created_at)))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"最后登录",prop:"login_time","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("validDateTime")(t.row.login_time)))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.jurisdiction.admincp_member.edit],expression:"[$api.jurisdiction.admincp_member.edit]"}],staticClass:"look-word",attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(r){return r.stopPropagation(),e.handleEdit(t.row.id)}}},[e._v("编辑")]),e._v(" "),r("span",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.jurisdiction.admincp_member.del],expression:"[$api.jurisdiction.admincp_member.del]"}],staticClass:"look-word",attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(r){return e.handleDel(t.row.id)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),r("Pagination",{attrs:{current:e.current,pageSize:e.pageSize,count:e.count},on:{pageChangeCBK:e.handlePageChange,sizeChangeCBK:e.handleSizeChange}})],e._v(" "),r("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),r("RightSidePopup",{attrs:{mask:"",visible:e.drawerVisible,width:"50%"},on:{"update:visible":function(t){e.drawerVisible=t}}},[r("p",{staticClass:"title"},[e._v(e._s(e.id?"编辑":"添加")+"成员")]),e._v(" "),r("el-form",{ref:"ruleForm",staticStyle:{width:"565px",margin:"0 auto"},attrs:{autocomplete:"off","label-position":"right","label-width":"150px",rules:e.rules,model:e.ruleForm}},[r("el-form-item",{attrs:{label:"用户名",prop:"username",rules:[e.simpleRule]}},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入用户名"},model:{value:e.ruleForm.username,callback:function(t){e.$set(e.ruleForm,"username",t)},expression:"ruleForm.username"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入手机号"},model:{value:e.ruleForm.phone,callback:function(t){e.$set(e.ruleForm,"phone",t)},expression:"ruleForm.phone"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[r("FileUpload",{attrs:{isOnly:!0,fileList:e.avatar,width:"80px",height:"80px"},on:{successUploadCBK:e.getsuccessUpload}})],1),e._v(" "),r("el-form-item",{attrs:{label:"所属部门",prop:"group_id"}},[r("el-cascader",{staticStyle:{width:"200px"},attrs:{"change-on-select":"",filterable:"","expand-trigger":"hover",options:e.adminGroup},model:{value:e.ruleForm.group_id,callback:function(t){e.$set(e.ruleForm,"group_id",t)},expression:"ruleForm.group_id"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"对应角色",prop:"role",rules:[e.simpleRule]}},[r("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择",prop:"role",filterable:"",autocomplete:"off",clearable:""},model:{value:e.ruleForm.role,callback:function(t){e.$set(e.ruleForm,"role",t)},expression:"ruleForm.role"}},e._l(e.roles,function(e){return r("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"客服类型",prop:"service_type",rules:[e.simpleRule]}},[r("el-select",{staticStyle:{width:"200px"},attrs:{name:"service_type",placeholder:"请选择",prop:"role",clearable:""},model:{value:e.ruleForm.service_type,callback:function(t){e.$set(e.ruleForm,"service_type",t)},expression:"ruleForm.service_type"}},e._l([{name:"无",id:0},{name:"咨询",id:1},{name:"售后",id:10}],function(e){return r("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"登录密码",prop:"password",rules:e.id?[]:[e.simpleRule]}},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入密码",type:"password"},model:{value:e.ruleForm.password,callback:function(t){e.$set(e.ruleForm,"password",t)},expression:"ruleForm.password"}}),e._v(" "),e.id?r("p",{staticClass:"tips"},[e._v("不修改密码可不填写")]):e._e()],1),e._v(" "),r("el-button",{staticClass:"submit",attrs:{type:"primary"},on:{click:e.submit}},[e._v("提 交")])],1)],1)],2)},staticRenderFns:[]};var b=r("C7Lr")(f,g,!1,function(e){r("8p42")},"data-v-4f4e1487",null);t.default=b.exports}});