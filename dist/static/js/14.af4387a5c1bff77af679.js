webpackJsonp([14],{"+ArS":function(e,t){},"/t1X":function(e,t){},"1EOk":function(e,t){},"4bHn":function(e,t){},JSiB:function(e,t){},MGIy:function(e,t){},MezF:function(e,t){},PgoK:function(e,t){},U4hP:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("3cXf"),r=s.n(i),o=s("IHPB"),n=s.n(o),l=s("4YfN"),c=s.n(l),d=s("48sp"),u=s("IcnI"),p=s("lC5x"),v=s.n(p),f=s("J0Oq"),m=s.n(f),_=[{command:2,label:"按未读数排序"},{command:1,label:"按会话时间排序"}],h={props:{kefuStatus:[Number]},data:function(){return{chooseCommand:2,REFRESH_LIST:_,serviceStatus:{label:"在线",icon:"zaixian",status:1},serviceStatusOptions:[{label:"在线",icon:"zaixian",status:1,code:5001},{label:"离线",icon:"lixian",status:0,code:5e3}]}},computed:c()({},Object(d.e)("user",["userInfo"])),watch:{kefuStatus:function(e){this.serviceStatus=this.serviceStatusOptions.find(function(t){return t.status==e})}},methods:{handleCommand:function(e){this.$emit("sendSocket",{message:e.label},e.code,!1),this.serviceStatus=e},handleSortCommand:function(e){this.chooseCommand=e,this.$emit("refresh",e)},refresh:function(){this.$emit("refresh")}}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"avatar-container-box"},[s("el-dropdown",{staticClass:"avatar-container",attrs:{placement:"bottom-start",trigger:"click"},on:{command:e.handleCommand}},[s("div",{staticClass:"userAvatar-container",staticStyle:{"margin-right":"20px",display:"flex","align-items":"center"}},[s("div",{staticStyle:{position:"relative"}},[e.userInfo.avatar?s("img",{staticClass:"user-via",attrs:{src:e.userInfo.avatar}}):s("svg-icon",{staticClass:"icon",attrs:{"icon-name":"icon-test1"}}),e._v(" "),s("svg-icon",{staticClass:"icon-tag",attrs:{"icon-name":e.serviceStatus.icon}})],1),e._v(" "),s("div",{staticStyle:{"margin-left":"16px"}},[s("span",{staticStyle:{"font-size":"14px",color:"#000"}},[e._v("客服"+e._s(e.userInfo.username))]),e._v(" "),s("span",{staticStyle:{"font-size":"14px",color:"rgb(102, 102, 102)"}},[e._v("("+e._s(e.serviceStatus.label)+")")])])]),e._v(" "),s("el-dropdown-menu",{staticClass:"user-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.serviceStatusOptions,function(t){return s("el-dropdown-item",{key:t.icon,attrs:{command:t}},[s("svg-icon",{attrs:{"icon-name":t.icon}}),e._v(" "),s("span",[e._v(e._s(t.label))])],1)}),1)],1),e._v(" "),s("div",{staticClass:"right-btn"},[s("i",{staticClass:"el-icon-refresh",on:{click:e.refresh}}),e._v(" "),s("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleSortCommand}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"iconfont iconpaixu"})]),e._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.REFRESH_LIST,function(t){return s("el-dropdown-item",{key:t.command,attrs:{disabled:t.command===e.chooseCommand,command:t.command}},[e._v("\n                    "+e._s(t.label)+"\n                ")])}),1)],1)],1)],1)},staticRenderFns:[]};var b=s("C7Lr")(h,g,!1,function(e){s("4bHn")},null,null).exports,y=s("FFUX"),k={name:"User",props:{userBody:[Array],userObj:[Object],showBody:[Array],kefuStatus:[Number]},components:{UserAvatar:b},data:function(){return{activeKey:null,mark:"",current:1,serachname:"",pageSize:20}},watch:{serachname:Object(y.g)(function(){this.serachname?this.$emit("sendSocket",{message:"搜索",search_name:this.serachname},2550,!1):this.$emit("getSessionList")},500)},created:function(){},mounted:function(){this.bindScrollEvent()},methods:{refresh:function(e){this.$emit("refresh",e)},bindScrollEvent:function(){var e=this;this.$refs.scrollList.onscroll=Object(y.g)(function(){var t=e.$refs.scrollList;e.$refs.scrollList.scrollHeight-t.clientHeight-t.scrollTop<50&&0!==e.showBody.length&&e.$emit("getSessionList",e.showBody[e.showBody.length-1].key)},1e3)},resetAll:function(e){this.current=1,this.showBody=[]},getHistory:function(e,t){var s=this;return m()(v.a.mark(function i(){var r,a,o;return v.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r={service_id:u.a.state.user.userInfo.id,size:s.pageSize,username:s.serachname,page:t,status:e},i.next=3,s.$api.service.sessionHistory(r);case 3:a=i.sent,o=a.data,1===e&&(s.historyProcessing.count=o.count,s.historyProcessingPageTotal=Math.ceil(o.count/s.pageSize),s.historyProcessing.items=s.historyProcessing.items.concat(o.items)),2===e&&(s.historyCompelete.count=o.count,s.historyCompeletePageTotal=Math.ceil(o.count/s.pageSize),s.historyCompelete.items=s.historyCompelete.items.concat(o.items)),"processing"===s.activeName&&(s.showBody=s.historyProcessing.items),"complete"===s.activeName&&(s.showBody=s.historyCompelete.items);case 9:case"end":return i.stop()}},i,s)}))()},selectUser:function(e,t,s){this.$emit("update:chatBody",[]),this.$emit("update:activeKey",e),this.$emit("getChatHistoryList",0),this.activeKey=e,t.unread_msg_num=0;t.person_name,t.person_head_picture,t.person_id,1==t.sn_type&&t.sn_code,t.conversation_id;this.$emit("update:userObj",{username:t.person_name,avatar:t.person_head_picture,id:t.person_id,order_id:t.sn_code,session_id:t.conversation_id}),this.$emit("update:receiver_id",t.person_id)},sendSocket:function(e,t,s){this.$emit("sendSocket",e,t,s)}}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user"},[s("UserAvatar",{attrs:{kefuStatus:e.kefuStatus},on:{sendSocket:e.sendSocket,refresh:e.refresh}}),e._v(" "),s("div",{staticStyle:{padding:"0 10px"}},[s("el-input",{staticClass:"mt10",attrs:{placeholder:"请输入用戶名","prefix-icon":"el-icon-search"},model:{value:e.serachname,callback:function(t){e.serachname=t},expression:"serachname"}})],1),e._v(" "),s("div",{staticClass:"list"},[s("ul",{ref:"scrollList",staticClass:"items"},e._l(e.showBody,function(t,i){return s("li",{key:i,class:e.activeKey===t.key?"active":"",on:{click:function(s){return e.selectUser(t.key,t,i)}}},[s("div",{staticClass:"info"},[s("img",{attrs:{src:t.person_head_picture}}),e._v(" "),s("div",{staticStyle:{flex:"1"}},[s("span",[e._v("\n                            "+e._s(t.person_name)+" \n                            ")]),e._v(" "),s("div",{staticClass:"time-content"},[t.latest_msg?s("span",{staticClass:"time",staticStyle:{display:"inline-block"}},[e._v(e._s(t.latest_msg.date))]):e._e(),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.unread_msg_num,expression:"item.unread_msg_num"}],staticClass:"badge"},[e._v(e._s(t.unread_msg_num>99?"99":t.unread_msg_num))]),e._v(" "),t.transfer_num>0?s("i",{staticClass:"icon-transfer el-icon-sort"}):e._e()])])])])}),0)])],1)},staticRenderFns:[]};var x=s("C7Lr")(k,w,!1,function(e){s("/t1X"),s("1EOk")},"data-v-a797b904",null).exports,C=s("HzJ8"),S=s.n(C),$=s("KH7x"),O=s.n($),D=s("lEsE"),V={people:["😄","😃","😀","😊","😉","😍","😘","😚","😗","😙","😜","😝","😛","😳","😁","😔","😌","😒","😞","😣","😢","😂","😭","😪","😥","😰","😅","😓","😩","😫","😨","😱","😠","😡","😤","😖","😆","😋","😷","😎","😴","😵","😲","😟","😦","😧","😈","👿","😮","😬","😐","😕","😯","😶","😇","😏","😑","👲","👳","👮","👷","💂","👶","👦","👧","👨","👩","👴","👵","👱","👼","👸","😺","😸","😻","😽","😼","🙀","😿","😹","😾","👹","👺","🙈","🙉","🙊","💀","👽","💩","🔥","✨","🌟","💫","💥","💢","💦","💧","💤","💨","👂","👀","👃","👅","👄","👍","👎","👌","👊","✊","✌","👋","✋","👐","👆","👇","👉","👈","🙌","🙏","☝","👏","💪","🚶","🏃","💃","👫","👪","👬","👭","💏","💑","👯","🙆","🙅","💁","🙋","💆","💇","💅","👰","🙎","🙍","🙇","🎩","👑","👒","👟","👞","👡","👠","👢","👕","👔","👚","👗","🎽","👖","👘","👙","💼","👜","👝","👛","👓","🎀","🌂","💄","💛","💙","💜","💚","❤","💔","💗","💓","💕","💖","💞","💘","💌","💋","💍","💎","👤","👥","💬","👣","💭"],hot:["☀","☁","☔","⛄","⚡","🌀","🌂","🌙","🌟","🍀","🌷","🌱","🍁","🌸","🌹","🍂","🍃","🌺","🌻","🌴","🌵","🌾","🍎","🍊","🍓","👀","👂","👃","👄","👅","💅","👦","👧","👨","👩","👫","👮","👱","👲","👳","👴","👵","👶","👷","👸","👯","👻","👼","👽","👾","👿","💀","💂","💃","🐍","🐎","🐔","🐗","🐫","🐘","🐨","🐒","🐑","🐙","🐚","🐛","🐠","🐡","🐥","🐦","🐧","🐩","🐟","🐬","🐭","🐯","🐱","🐳","🐴","🐵","🐶","🐷","🐻","🐹","🐺","🐮","🐰","🐸","🐾","😠","😩","😲","😞","😵","😰","😒","😍","😤","😜","😝","😋","😘","😚","😷","😳","😃","😆","😁","😂","☺","😄","😢","😭","😨","😣","😡","😌","😖","😔","😱","😪","😏","😓","😥","😫","😉","😺","😸","😹","😽","😻","😿","😼","🙀","🙋","🙌","🙍","🙏","🔥","🎁","🎄","🎅","🎈","🎉","🎍","🎎","🎓","🎏","🎐","🎃","📞","📱","📲","📠","💻","💽","💾","💿","📀","🎵","🎶","🎼","📺","💋","💏","💐","💑","🍔","☕","🍸","🍺","❤","💓","💔","💖","💗","💘","💙","💚","💛","💜","💝","♥","💢","💤","💦","💨","💩","💪","✨","🔔","✊","✋","✌","👊","👍","☝","👆","👇","👈","👉","👋","👏","👌","👎","👐"],nature:["🐶","🐺","🐱","🐭","🐹","🐰","🐸","🐯","🐨","🐻","🐷","🐽","🐮","🐗","🐵","🐒","🐴","🐑","🐘","🐼","🐧","🐦","🐤","🐥","🐣","🐔","🐍","🐢","🐛","🐝","🐜","🐞","🐌","🐙","🐚","🐠","🐟","🐬","🐳","🐋","🐄","🐏","🐀","🐃","🐅","🐇","🐉","🐎","🐐","🐓","🐕","🐖","🐁","🐂","🐲","🐡","🐊","🐫","🐪","🐆","🐈","🐩","🐾","💐","🌸","🌷","🍀","🌹","🌻","🌺","🍁","🍃","🍂","🌿","🌾","🍄","🌵","🌴","🌲","🌳","🌰","🌱","🌼","🌐","🌞","🌝","🌚","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌜","🌛","🌙","🌍","🌎","🌏","🌋","🌌","🌠","⭐","☀","⛅","☁","⚡","☔","❄","⛄","🌀","🌁","🌈","🌊"],items:["🎍","💝","🎎","🎒","🎓","🎏","🎆","🎇","🎐","🎑","🎃","👻","🎅","🎄","🎁","🎋","🎉","🎊","🎈","🎌","🔮","🎥","📷","📹","📼","💿","📀","💽","💾","💻","📱","☎","📞","📟","📠","📡","📺","📻","🔊","🔉","🔈","🔇","🔔","🔕","📢","📣","⏳","⌛","⏰","⌚","🔓","🔒","🔏","🔐","🔑","🔎","💡","🔦","🔆","🔅","🔌","🔋","🔍","🛁","🛀","🚿","🚽","🔧","🔩","🔨","🚪","🚬","💣","🔫","🔪","💊","💉","💰","💴","💵","💷","💶","💳","💸","📲","📧","📥","📤","✉","📩","📨","📯","📫","📪","📬","📭","📮","📦","📝","📄","📃","📑","📊","📈","📉","📜","📋","📅","📆","📇","📁","📂","✂","📌","📎","✒","✏","📏","📐","📕","📗","📘","📙","📓","📔","📒","📚","📖","🔖","📛","🔬","🔭","📰","🎨","🎬","🎤","🎧","🎼","🎵","🎶","🎹","🎻","🎺","🎷","🎸","👾","🎮","🃏","🎴","🀄","🎲","🎯","🏈","🏀","⚽","⚾","🎾","🎱","🏉","🎳","⛳","🚵","🚴","🏁","🏇","🏆","🎿","🏂","🏊","🏄","🎣","☕","🍵","🍶","🍼","🍺","🍻","🍸","🍹","🍷","🍴","🍕","🍔","🍟","🍗","🍖","🍝","🍛","🍤","🍱","🍣","🍥","🍙","🍘","🍚","🍜","🍲","🍢","🍡","🍳","🍞","🍩","🍮","🍦","🍨","🍧","🎂","🍰","🍪","🍫","🍬","🍭","🍯","🍎","🍏","🍊","🍋","🍒","🍇","🍉","🍓","🍑","🍈","🍌","🍐","🍍","🍠","🍆","🍅","🌽"],place:["🏠","🏡","🏫","🏢","🏣","🏥","🏦","🏪","🏩","🏨","💒","⛪","🏬","🏤","🌇","🌆","🏯","🏰","⛺","🏭","🗼","🗾","🗻","🌄","🌅","🌃","🗽","🌉","🎠","🎡","⛲","🎢","🚢","⛵","🚤","🚣","⚓","🚀","✈","💺","🚁","🚂","🚊","🚉","🚞","🚆","🚄","🚅","🚈","🚇","🚝","🚋","🚃","🚎","🚌","🚍","🚙","🚘","🚗","🚕","🚖","🚛","🚚","🚨","🚓","🚔","🚒","🚑","🚐","🚲","🚡","🚟","🚠","🚜","💈","🚏","🎫","🚦","🚥","⚠","🚧","🔰","⛽","🏮","🎰","♨","🗿","🎪","🎭","📍","🚩"],single:["🔟","🔢","🔣","⬆","⬇","⬅","➡","🔠","🔡","🔤","↗","↖","↘","↙","↔","↕","🔄","◀","▶","🔼","🔽","↩","↪","ℹ","⏪","⏩","⏫","⏬","⤵","⤴","🆗","🔀","🔁","🔂","🆕","🆙","🆒","🆓","🆖","📶","🎦","🈁","🈯","🈳","🈵","🈴","🈲","🉐","🈹","🈺","🈶","🈚","🚻","🚹","🚺","🚼","🚾","🚰","🚮","🅿","♿","🚭","🈷","🈸","🈂","Ⓜ","🛂","🛄","🛅","🛃","🉑","㊙","㊗","🆑","🆘","🆔","🚫","🔞","📵","🚯","🚱","🚳","🚷","🚸","⛔","✳","❇","❎","✅","✴","💟","🆚","📳","📴","🅰","🅱","🆎","🅾","💠","➿","♻","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","⛎","🔯","🏧","💹","💲","💱","©","®","™","❌","‼","⁉","❗","❓","❕","❔","⭕","🔝","🔚","🔙","🔛","🔜","🔃","🕛","🕧","🕐","🕜","🕑","🕝","🕒","🕞","🕓","🕟","🕔","🕠","🕕","🕖","🕗","🕘","🕙","🕚","🕡","🕢","🕣","🕤","🕥","🕦","✖","➕","➖","➗","♠","♥","♣","♦","💮","💯","✔","☑","🔘","🔗","➰","〰","〽","🔱","◼","◻","◾","◽","▪","▫","🔺","🔲","🔳","⚫","⚪","🔴","🔵","🔻","⬜","⬛","🔶","🔷","🔸","🔹"]},I={name:"Emoji",props:{showEmoji:{type:Boolean,default:!1}},data:function(){return{emojiData:V,pannels:["hot"],activeIndex:0}},computed:{emojis:function(){return this.emojiData.people}},methods:{changeActive:function(e){this.activeIndex=e},getPureName:function(e){return e.replace(/:/g,"")},selectItem:function(e){this.$emit("select",e)}}},P={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"emoji"},[s("ul",{staticClass:"emoji-container"},e._l(e.emojis,function(t,i){return s("li",{key:i,staticStyle:{padding:"0"}},[s("a",{attrs:{href:"javascript:;"},on:{click:function(s){return e.selectItem(t)}}},[s("span",{staticClass:"emoji-item"},[e._v(e._s(t))])])])}),0)])},staticRenderFns:[]};var F=s("C7Lr")(I,P,!1,function(e){s("+ArS")},"data-v-630922c4",null).exports,E={name:"Chat",props:{receiver_id:[String,Number],operation:[Number],chatBody:[Array,Object],session_id:[Number,String],userObj:[Object],hotChat:Object,lookMore:[Boolean],canTalk:[Boolean]},components:{Emoji:F},directives:{clickoutside:D.a},data:function(){return{count:0,current:1,anotherkefuVisible:!1,historyVisible:!1,sessionOver:!1,visible:!1,previewImg:"",activeName:"current",message:"",msgs:[],emNode:null,showEmoji:!1,username:"",last_id:"",fastReplies:[],fastRepliesFilter:[],fastRepliesKeywords:"",firstSession_id:"",history_filter_time:null,popverVisible:!1,historyList:[],pageSize:50,page:1,allKefu:[],allKefuFilter:[],kefuKeywords:""}},watch:{fastRepliesKeywords:function(e){this.fastRepliesFilter=this.fastReplies.filter(function(t){return t.includes(e)})},kefuKeywords:function(e){this.allKefuFilter=this.allKefu.filter(function(t){return t.username.includes(e)})},message:function(e){var t=this.fastReplies.filter(function(t){return t.includes(e)});if(0!==t.length&&t.length!==this.fastReplies.length){if(1===t.length&&t[0]===e)return;this.popverVisible=!0,this.fastRepliesFilter=t}else this.popverVisible=!1,this.fastRepliesFilter=this.fastReplies},hotChat:function(e){var t=this;this.msgs.push(e),setTimeout(function(){t.$refs.session.scrollTo(0,99999)},100)},chatBody:function(e){var t=this;this.msgs=e.slice(0).reverse(),this.firstSession_id=this.session_id,setTimeout(function(){t.$refs.session.scrollTo(0,99999)},100)},receiver_id:function(e){},userObj:function(e){this.username=e.username||""},msgs:function(e){}},created:function(){this.getPhrase(),this.getKeFus(),this.firstSession_id=this.session_id},methods:{changeKefu:function(e){e.id;e.id!=u.a.state.user.userInfo.id?(this.$emit("sendSocket",{message:"切换客服",switch_service_id:e.id},2800),this.anotherkefuVisible=!1):this.$message.error("转接失败")},getKeFus:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.service.getKefus({pageSize:1e4});case 2:s=t.sent,i=s.data,e.allKefu=i.items,e.allKefuFilter=i.items;case 6:case"end":return t.stop()}},t,e)}))()},getPhrase:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.service.phraselist();case 2:s=t.sent,i=s.data,e.fastReplies=i,e.fastRepliesFilter=i;case 6:case"end":return t.stop()}},t,e)}))()},onHistorySearch:function(){this.page=1,this.getIMHistory()},getIMHistory:function(){var e=this;this.$api.service.phraseHistory({session_id:this.session_id,page:this.page,size:this.pageSize,start_time:this.history_filter_time&&this.history_filter_time[0],end_time:this.history_filter_time&&this.history_filter_time[1]}).then(function(t){e.historyList=t.data.items,e.count=Number(t.data.count)})},getMore:function(){this.$emit("getChatHistoryList",this.msgs[0].msg_index)},handleClickMsg:function(e){this.visible=!0,this.previewImg=e},handleFastReply:function(e){this.popverVisible=!1,this.message=e},clickoutside:function(e){var t=e.toElement,s=!0,i=!1,r=void 0;try{for(var a,o=S()(["表情","自然","物品"].entries());!(s=(a=o.next()).done);s=!0){var n=a.value,l=O()(n,2),c=(l[0],l[1]);if(t.innerHTML.includes(c))return void(this.showEmoji&&(this.showEmoji=!0))}}catch(e){i=!0,r=e}finally{try{!s&&o.return&&o.return()}finally{if(i)throw r}}this.showEmoji&&(this.showEmoji=!1)},selectEmoji:function(e){this.showEmoji=!1,this.message+=e},uploadCBK:function(e,t){var s=void 0;["video/ogg","video/mp4","video/webm"].includes(t)?s=3:["image/jpeg","image/jpg","image/png","image/gif"].includes(t)?s=2:(this.$message({message:"不支持的文件格式！",type:"warning"}),s=4),this.commonSendMessage(s,e[0])},sendMsg:function(e){if(this.canTalk)if(console.log(e),"ArrowDown"!==e.key){if(this.message&&this.receiver_id){var t=this.message.replace(/(.?)(\n)$/,"$1");""!==t&&this.commonSendMessage(1,t)}}else this.message=this.message+"\n"},commonSendMessage:function(e,t){var s=this;return m()(v.a.mark(function i(){return v.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:s.$emit("sendSocket",{message:t,msg_content_type:e},2100),s.message="";case 2:case"end":return i.stop()}},i,s)}))()},closeSession:function(){this.$emit("removeChat")},closeChat:function(e){var t=this;1===e&&this.$emit("finishChat",this.session_id);try{var s={operation:7,time:Date.parse(new Date)/1e3,body:{session_id:this.session_id,is_finish:e}},i=r()(c()({},s));this.$socket.send(i),setTimeout(function(){t.sessionOver=!0},500)}catch(e){console.log(e)}this.$emit("update:receiver_id",null)},showHistorySession:function(){this.session_id&&(this.historyVisible=!0,this.getIMHistory())},handlePageChange:function(e){this.page=e,this.getIMHistory()},handleSizeChange:function(e){}}},j={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat"},[s("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"当前会话:"+e.username||"",name:"current"}},[s("div",{ref:"session",staticClass:"session"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.lookMore&&0!==e.msgs.length,expression:"lookMore &&  msgs.length!==0"}],staticClass:"session-more",on:{click:e.getMore}},[e._v("查看更多")]),e._v(" "),e._l(e.msgs,function(t,i){return s("div",{key:i,ref:t.id,refInFor:!0,staticClass:"session-item",staticStyle:{position:"relative"},attrs:{id:"id"+t.id}},[3!==t.sender_type?s("div",{class:2===t.sender_type?"left":"right"},[s("div",{staticClass:"user-info"},[s("span",[e._v(e._s(t.sender_name))]),e._v(" "),s("span",[e._v(e._s(e._f("validDateTime")(t.time,"showToday")))])]),e._v(" "),1==t.type?s("el-input",{class:["content",2==t.sender_type?"white":"green"],attrs:{type:"textarea",disabled:"",autosize:"",value:t.message}}):e._e(),e._v(" "),2==t.type?s("img",{staticStyle:{"max-width":"200px"},attrs:{src:t.message},on:{click:function(s){return e.handleClickMsg(t.message)}}}):e._e(),e._v(" "),3==t.type?s("video",{staticStyle:{"max-width":"300px"},attrs:{src:t.message,controls:"controls"}}):e._e(),e._v(" "),1===t.sender_type?s("span",{staticStyle:{position:"absolute",right:"0",bottom:"0px"}},[0==t.is_read?s("span",{staticStyle:{color:"#00CD66"}},[e._v("未读")]):s("span",{staticStyle:{color:"#ccc"}},[e._v("已读")])]):e._e()],1):e._e(),e._v(" "),3===t.sender_type?s("div",{staticClass:"system-msg-box"},[s("div",{staticClass:"system-msg"},[e._v("系统消息:"+e._s(t.message))])]):e._e(),e._v(" "),s("div",{staticStyle:{height:"20px",float:"right",width:"100%"}})])}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.sessionOver,expression:"sessionOver"}],staticClass:"session-over"},[e._v("会话已结束")])],2),e._v(" "),s("div",{staticClass:"operate"},[s("emoji",{directives:[{name:"show",rawName:"v-show",value:e.showEmoji,expression:"showEmoji"}],attrs:{showEmoji:e.showEmoji},on:{"update:showEmoji":function(t){e.showEmoji=t},"update:show-emoji":function(t){e.showEmoji=t},select:e.selectEmoji}}),e._v(" "),s("div",{staticClass:"icon-bar"},[s("svg-icon",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.clickoutside,expression:"clickoutside"}],attrs:{"icon-name":"biaoqing"},nativeOn:{click:function(t){e.showEmoji=!e.showEmoji}}}),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"图片 / 视频",placement:"bottom-start"}},[s("FileUpload",{staticClass:"file-button mr10 ml10",attrs:{isOnly:"",isSvg:"","icon-name":"fasongwenjian",width:"30px",height:"30px"},on:{successUploadCBK:e.uploadCBK}})],1),e._v(" "),s("el-popover",{attrs:{"popper-class":"fast-replies fuck",placement:"top",width:"650","max-height":"250",trigger:"click"},model:{value:e.popverVisible,callback:function(t){e.popverVisible=t},expression:"popverVisible"}},[s("el-input",{attrs:{placeholder:"输入关键字快速检索"},model:{value:e.fastRepliesKeywords,callback:function(t){e.fastRepliesKeywords=t},expression:"fastRepliesKeywords"}}),e._v(" "),s("ul",{staticStyle:{"font-size":"16px"}},e._l(e.fastRepliesFilter,function(t,i){return s("li",{key:i,on:{click:function(s){return e.handleFastReply(t)}}},[e._v(e._s(t))])}),0),e._v(" "),s("svg-icon",{attrs:{slot:"reference","icon-name":"kuaijiehuifu1"},slot:"reference"})],1),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"转接客服",placement:"bottom-start"}},[s("el-popover",{attrs:{"popper-class":"fast-replies fuck",placement:"top",width:"200","max-height":"250",trigger:"click"},model:{value:e.anotherkefuVisible,callback:function(t){e.anotherkefuVisible=t},expression:"anotherkefuVisible"}},[s("el-input",{attrs:{placeholder:"输入用户名搜索"},model:{value:e.kefuKeywords,callback:function(t){e.kefuKeywords=t},expression:"kefuKeywords"}}),e._v(" "),s("ul",{staticStyle:{"font-size":"16px"}},e._l(e.allKefuFilter,function(t,i){return s("li",{key:i,on:{click:function(s){return e.changeKefu(t)}}},[e._v(e._s(t.username))])}),0),e._v(" "),s("svg-icon",{directives:[{name:"show",rawName:"v-show",value:e.userObj.session_id,expression:"userObj.session_id"}],attrs:{slot:"reference","icon-name":"huifu"},slot:"reference"})],1)],1)],1)],1),e._v(" "),s("div",{staticClass:"type-writing"},[s("el-input",{ref:"textarea",attrs:{maxlength:1e3,type:"textarea",placeholder:"请输入，字数限制为1000字"},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.sendMsg(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMsg(t)}]},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),e._v(" "),s("div",{staticClass:"send-bar"},[s("div"),e._v(" "),s("el-button",{attrs:{type:e.receiver_id&&e.canTalk?"primary":"info",size:"mini"},on:{click:e.sendMsg}},[e._v("发 送")])],1)])],1),e._v(" "),s("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),s("el-button",{staticClass:"close-session",class:{"open-color":e.receiver_id},attrs:{type:"text"},on:{click:e.closeSession}},[e._v("关闭对话")]),e._v(" "),s("el-dialog",{staticClass:"im-history-dialog",attrs:{title:"历史记录",visible:e.historyVisible},on:{"update:visible":function(t){e.historyVisible=t}}},[s("div",[s("el-row",{staticStyle:{"margin-bottom":"10px"}},[s("el-col",{attrs:{span:16}},[s("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.history_filter_time,callback:function(t){e.history_filter_time=t},expression:"history_filter_time"}})],1),e._v(" "),s("el-col",{attrs:{span:4}},[s("el-button",{attrs:{size:"mini",icon:"el-icon-search",type:"primary"},on:{click:e.onHistorySearch}},[e._v("\n                查询\n            ")])],1)],1)],1),e._v(" "),s("div",{staticClass:"session-history"},[0===e.historyList.length?s("div",{staticClass:"no-msg"},[e._v("暂无聊天记录")]):e._e(),e._v(" "),e._l(e.historyList,function(t,i){return s("div",{key:i,staticClass:"session-item"},[3!==t.sender_type?s("div",{class:2===t.sender_type?"left":"right"},[s("div",{staticClass:"user-info"},[s("span",[e._v(e._s(t.sender_name))]),e._v(" "),s("span",[e._v(e._s(e._f("validDateTime")(t.time,"showToday")))])]),e._v(" "),1==t.type?s("el-input",{class:["content",2==t.sender_type?"white":"green"],attrs:{type:"textarea",disabled:"",autosize:"",value:t.message}}):e._e(),e._v(" "),2==t.type?s("img",{staticStyle:{"max-width":"200px"},attrs:{src:t.message},on:{click:function(s){return e.handleClickMsg(t.message)}}}):e._e(),e._v(" "),3==t.type?s("video",{staticStyle:{"max-width":"300px"},attrs:{src:t.message,controls:"controls"}}):e._e()],1):e._e(),e._v(" "),3===t.sender_type?s("div",{staticClass:"system-msg-box"},[s("div",{staticClass:"system-msg"},[e._v("系统消息:"+e._s(t.message))])]):e._e()])})],2),e._v(" "),s("el-pagination",{staticClass:"pagation",attrs:{small:"",total:e.count,"page-size":e.pageSize,"current-page":e.page,layout:"total, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange}})],1)],1)},staticRenderFns:[]};var T=s("C7Lr")(E,j,!1,function(e){s("bTmZ")},null,null).exports,M=s("z7uW"),R={name:"ExpressCheck",props:{logistics_sn:[String]},data:function(){return{}},watch:{logistics_sn:function(e){this.lookFor()}},mounted:function(){},methods:{lookFor:function(){if(""!=this.logistics_sn){var e=document.querySelector(".express-iframe");e.src="http://m.kuaidi100.com/result.jsp?nu="+this.logistics_sn,e.onload=function(){try{var e=document.querySelector(".express-iframe").contentWindow.document,t=e.querySelector(".com-info"),s=e.querySelector(".download-nav"),i=e.querySelector(".common-header"),r=e.querySelector(".result-btn"),a=e.querySelector("#m_result_redpacket");[t,s,i].map(function(e){e.style.display="none"}),r&&(r.style.display="none"),a&&(a.style.display="none")}catch(e){console.log(e)}}}}}},B={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"express-check"},[t("p",{staticClass:"title"},[this._v("物流信息")]),this._v(" "),t("iframe",{staticClass:"express-iframe",attrs:{frameborder:"0",width:"100%"}})])}]};var N=s("C7Lr")(R,B,!1,function(e){s("n0wP")},"data-v-7bb7a425",null).exports,K=s("drEk"),z=s("aA9S"),L=s.n(z),H={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"orderFollow"},[t("p",{staticClass:"title"},[this._v("订单跟踪")]),this._v(" "),t("div",{staticStyle:{margin:"20px"}},[t("el-steps",{attrs:{direction:"vertical",active:1,space:70}},[t("el-step",{attrs:{title:"订单已签收，期待再次为您服务",description:"2017-04-01 12:00:00"}}),this._v(" "),t("el-step",{attrs:{title:"到达目的地网点广东深圳公司，快件将很快进行派送",description:"2017-04-01 12:00:00"}}),this._v(" "),t("el-step",{attrs:{title:"在广东深圳公司进行发出扫描",description:"2017-04-01 12:00:00"}})],1)],1)])},staticRenderFns:[]};var q={name:"orderDetail",components:{orderFollow:s("C7Lr")({name:"orderFollow"},H,!1,function(e){s("tx5V")},"data-v-32678d3f",null).exports,logisticsInfo:s("tP/k").a},data:function(){return{needMask:!0,simpleRule:{required:!0,message:"必填项",trigger:"change"},provinceData:[],cityData:[],countyData:[],townData:[],goodsData:[],id:this.$route.params.id,detailData:{sale_records:[]},rghtPopupVisible:!1,visible:!1,previewImg:"",active:1,multipleSelection:[],tableData:[],remark:"",closeForm:{is_refund:0,password:"",actual_fee:0},msg:{title:"",content:""},invoice:{receiver_name:"",receiver_mobile:"",receiver_province_id:"",receiver_city_id:"",receiver_district_id:"",receiver_street_id:"",receiver_address:""},buyer:{receiver_name:"",receiver_mobile:"",receiver_province_id:"",receiver_city_id:"",receiver_district_id:"",receiver_street_id:"",receiver_address:""},dialogVisible:!1,msgdialogVisible:!1,closedialogVisible:!1,invoicedialogVisible:!1,buyerdialogVisible:!1,invoiceTypeoptions:[{value:"1",label:"不开发票"},{value:"2",label:"电子发票"},{value:"3",label:"纸质发票"}],invoiceContentoptions:[{value:"1",label:"日用品"},{value:"2",label:"家居用品"},{value:"3",label:"食品"},{value:"4",label:"酒/饮料"},{value:"5",label:"服饰"},{value:"6",label:"化妆品"}],provinceoptions:[],cityceoptions:[],areaceoptions:[],rules:{remarks:[{required:!0,message:"请输入",trigger:"change"}],growup:[{required:!0,message:"请输入",trigger:"change"}],title:[{required:!0,message:"请输入",trigger:"blur"}],content:[{required:!0,message:"请输入",trigger:"blur"}],invoiceType:[{required:!0,message:"请选择",trigger:"blur"}]},looklogistics:!1,changeTransportVisible:!1,changeTransportForm:{code:"",sn:""},express:[]}},watch:{"buyer.receiver_province_id":function(e){this.getCityData(e,"city")},"buyer.receiver_city_id":function(e){this.getCityData(e,"county")},"buyer.receiver_district_id":function(e){this.getCityData(e,"town")},detailData:function(e){e.logistics_sn&&(this.looklogistics=!0)},$route:function(e,t){"orderDetail"===e.name&&(console.log(e.query),this.id=this.$route.params.id,this.getOrderDetail())}},created:function(){this.getOrderDetail(),this.getCityData(0,"province"),this.getExpress()},methods:{changeTransport:function(){this.changeTransportVisible=!0},submitChangeTransport:function(){var e,t=this;this.$refs.changeTransportForm.validate((e=m()(v.a.mark(function e(s){var i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=c()({},t.changeTransportForm,{id:t.id}),e.next=3,t.$api.order.deliverySave({items:[i]});case 3:t.changeTransportVisible=!1,t.getOrderDetail();case 5:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},getExpress:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.setting.getExpressList({status:10});case 3:s=t.sent,i=s.data,e.express=i.items,t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(0),new Error(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},resetForm:function(e){this.$refs[e].resetFields()},modifyReceive:function(){var e=this;return m()(v.a.mark(function t(){var s;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(s=L()({},e.buyer)).id=e.id,t.next=5,e.$api.order.modifyReceive(s);case 5:e.resetForm("buyerForm"),e.buyerdialogVisible=!1,e.getOrderDetail(),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:case"end":return t.stop()}},t,e,[[0,10]])}))()},getCityData:function(e,t){var s=this;return m()(v.a.mark(function i(){var r,a;return v.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,s.$api.common.getAreaList({pid:e});case 3:r=i.sent,a=r.data,s[t+"Data"]=a,i.next=11;break;case 8:throw i.prev=8,i.t0=i.catch(0),new Error(i.t0);case 11:case"end":return i.stop()}},i,s,[[0,8]])}))()},orderRemark:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.order.orderRemark({id:e.id,remark:e.remark});case 3:e.dialogVisible=!1,e.getOrderDetail(),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}},t,e,[[0,7]])}))()},orderClose:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$refs.closeForm.validate(function(){var t=m()(v.a.mark(function t(s){var i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=17;break}if((i=L()({},e.closeForm)).id=e.id,0==i.is_refund){t.next=7;break}if(!(Number(e.detailData.actual_fee)<Number(i.actual_fee))){t.next=7;break}return e.$message.error("退款金额高于实付金额！"),t.abrupt("return");case 7:return 0==i.is_refund&&delete i.actual_fee,t.prev=8,t.next=11,e.$api.order.orderClose(i);case 11:e.closedialogVisible=!1,e.getOrderDetail(),t.next=17;break;case 15:t.prev=15,t.t0=t.catch(8);case 17:case"end":return t.stop()}},t,e,[[8,15]])}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,e)}))()},getOrderDetail:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.id){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.$api.order.orderDetail({id:e.id});case 5:s=t.sent,i=s.data,e.detailData=i,e.goodsData=i.orderExtend.map(function(e){return{goods_thumb:e.goods_thumb,goods_name:e.goods_name,shop_price:e.shop_price,goods_id:e.goods_id,sku_properties_name:e.sku_properties_name,nums:e.nums,rowDotal:e.shop_price*e.nums}}),e.changeTransportForm.code=i.express_code,e.changeTransportForm.sn=i.logistics_sn,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),e.loading=!1;case 16:case"end":return t.stop()}},t,e,[[2,13]])}))()},handleSelectionChange:function(e){this.multipleSelection=e},follow:function(){this.$router.push({name:"orderFollow",params:{id:""}})},look:function(){this.$router.push({name:"userDetail",params:{type:"read",id:this.detailData.uid,listType:this.detailData.user_type}})},openRemarks:function(){this.dialogVisible=!0},openMsg:function(){this.msgdialogVisible=!0},closeOrder:function(){this.closeForm.password="",this.closedialogVisible=!0,this.closeForm.actual_fee=this.detailData.actual_fee},invoiceOpen:function(){this.invoicedialogVisible=!0},buyerOpen:function(){for(var e in this.buyerdialogVisible=!0,this.buyer)this.buyer[e]=this.detailData[e]}}},A={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"taskReward-content"},[s("div",{staticClass:"mune-content"},[s("span",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-gantanhao"}})]),e._v(" "),s("span",{staticStyle:{"margin-left":"5px"}},[e._v("当前订单状态："),s("b",{staticStyle:{color:"#FC5855"}},[e._v(e._s(e.detailData.status_name))])])]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.order.delivery.save],expression:"[$api.order.delivery.save]"}],attrs:{type:"primary",plain:""},on:{click:e.changeTransport}},[e._v("修改物流信息")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.order.order.modify_receive],expression:"[$api.order.order.modify_receive]"}],attrs:{type:"primary",plain:""},on:{click:e.buyerOpen}},[e._v("修改收货人信息")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.order.order.remark],expression:"[$api.order.order.remark]"}],attrs:{type:"primary",plain:""},on:{click:e.openRemarks}},[e._v("备注订单")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.order.order.close],expression:"[$api.order.order.close]"}],attrs:{type:"warning",plain:""},on:{click:e.closeOrder}},[e._v("关闭订单")])],1),e._v(" "),s("div",{staticClass:"card"},[s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-icon_favorite"}})]),e._v(" "),s("span",{staticClass:"f16"},[e._v("基本信息")]),e._v(" "),s("div",{staticClass:"table-content"},[s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("订单编号")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.order_sn))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("发货单流水号")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.order_sn))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("用户账号")]),e._v(" "),s("div",{},[e._v("\n                            "+e._s(e.detailData.buyer_nickname)+"\n                            "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.user.userManage.detail],expression:"[$api.user.userManage.detail]"}],staticStyle:{"margin-left":"10px"},attrs:{type:"info",plain:"",size:"mini"},on:{click:e.look}},[e._v("查看")])],1)]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("支付方式")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.pay_type))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("订单来源")]),e._v(" "),s("div",{},[e._v(e._s(e._f("validVal")(e.detailData.from)))])])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("物流单号")]),e._v(" "),s("div",[e._v(e._s(e._f("validVal")(e.detailData.logistics_sn))+"\n                        "),e.looklogistics?s("logisticsInfo",{staticStyle:{"margin-left":"10px"},attrs:{logisticssn:e.detailData.logistics_sn,expresscode:e.detailData.express_code}}):e._e()],1)]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("付款时间")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.pay_time))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("发货时间")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.send_time))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("成交时间")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.take_time))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("卖家留言")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.remark))])])])])])]),e._v(" "),s("div",{staticClass:"card"},[s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-icon_favorite"}})]),e._v(" "),s("span",{staticClass:"f16"},[e._v("收货人信息")]),e._v(" "),s("div",{staticClass:"table-content"},[s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("收货人")]),e._v(" "),s("div",{},[e._v(e._s(e._f("validVal")(e.detailData.receiver_name)))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("手机号码")]),e._v(" "),s("div",{},[e._v(e._s(e._f("validVal")(e.detailData.receiver_mobile)))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("收货地址")]),e._v(" "),s("div",{},[e._v(e._s(e._f("validVal")(e.detailData.receiver_address)))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("买家留言")]),e._v(" "),s("div",{},[e._v(e._s(e._f("validVal")(e.detailData.buyer_message)))])])])])])]),e._v(" "),s("div",{staticClass:"card"},[s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-icon_favorite"}})]),e._v(" "),s("span",{staticClass:"f16"},[e._v("商品信息")]),e._v(" "),s("div",{staticClass:"table-content"},[s("div",{staticClass:"table-row"},[s("el-table",{ref:"multipleTable",attrs:{"show-summary":"",border:"",data:e.goodsData}},[s("el-table-column",{attrs:{width:"100",align:"center",prop:"goods_thumb",label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("img",{staticStyle:{width:"80px"},attrs:{src:t.row.goods_thumb},on:{click:function(s){e.previewImg=t.row.goods_thumb,e.visible=!0}}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"商品名称",align:"center",prop:"goods_name"}}),e._v(" "),s("el-table-column",{attrs:{prop:"usernum",align:"center",label:"价格/货号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("p",[e._v("价格：￥"+e._s(t.row.shop_price))]),e._v(" "),s("p",[e._v("货号："+e._s(t.row.goods_id))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"属性",align:"center",prop:"sku_properties_name","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"数量（件）",align:"center",prop:"nums"}}),e._v(" "),s("el-table-column",{attrs:{label:"小计（元）",prop:"rowDotal",align:"center"}})],1)],1)])])]),e._v(" "),s("div",{staticClass:"card"},[s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-icon_favorite"}})]),e._v(" "),s("span",{staticClass:"f16"},[e._v("费用信息")]),e._v(" "),s("div",{staticClass:"table-content"},[s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("商品合计")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.goods_fee))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("运费(运费险)")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.freight_fee)+"("+e._s(e.detailData.insurance_fee)+")")])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("优惠券")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.coupon_name)+"("+e._s(e.detailData.coupon_fee)+") ")])])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("活动优惠")]),e._v(" "),s("div",{},[e._v(e._s(e.detailData.discount_fee))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("订单总金额")]),e._v(" "),s("div",{staticClass:"red"},[e._v(e._s(e.detailData.total_fee))])]),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("应付款金额")]),e._v(" "),s("div",{staticClass:"red"},[e._v(e._s(e.detailData.actual_fee))])])])])])]),e._v(" "),0!=e.detailData.sale_records.length?s("div",{staticClass:"card"},[s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-icon_favorite"}})]),e._v(" "),s("span",{staticClass:"f16"},[e._v("售后记录")]),e._v(" "),s("div",{staticClass:"table-content"},[s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("时间")]),e._v(" "),e._l(e.detailData.sale_records,function(t){return s("div",{key:t.id,staticClass:"for-div"},[e._v(e._s(t.created_at))])})],2),e._v(" "),s("div",{staticClass:"table-row-col"},[s("div",{},[e._v("内容")]),e._v(" "),e._l(e.detailData.sale_records,function(t){return s("div",{key:t.id,staticClass:"for-div"},[e._v(e._s(t.content))])})],2)])])])]):e._e(),e._v(" "),s("el-dialog",{attrs:{title:"备注订单",visible:e.dialogVisible,modal:e.needMask,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-form",{ref:"form",attrs:{"label-width":"120px","label-position":"right"}},[s("el-form-item",{attrs:{label:"操作备注："}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{type:"textarea",rows:4,autocomplete:"off"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{disabled:!e.remark,type:"primary"},on:{click:e.orderRemark}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"发生站内信",visible:e.msgdialogVisible,modal:e.needMask,width:"30%"},on:{"update:visible":function(t){e.msgdialogVisible=t}}},[s("el-form",{ref:"form",attrs:{model:e.msg,rules:e.rules,"label-width":"120px","label-position":"right"}},[s("el-form-item",{attrs:{label:"标题：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{autocomplete:"off"},model:{value:e.msg.title,callback:function(t){e.$set(e.msg,"title",t)},expression:"msg.title"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"操作备注：",prop:"content"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{type:"textarea",rows:4,autocomplete:"off"},model:{value:e.msg.content,callback:function(t){e.$set(e.msg,"content",t)},expression:"msg.content"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.msgdialogVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.msgdialogVisible=!1}}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"关闭订单",visible:e.closedialogVisible,modal:e.needMask,width:"30%"},on:{"update:visible":function(t){e.closedialogVisible=t}}},[s("el-form",{ref:"closeForm",attrs:{model:e.closeForm,"label-width":"120px","label-position":"right"}},[s("el-form-item",{attrs:{label:"是否退款："}},[s("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.closeForm.is_refund,callback:function(t){e.$set(e.closeForm,"is_refund",t)},expression:"closeForm.is_refund"}})],1),e._v(" "),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.closeForm.is_refund,expression:"closeForm.is_refund==1"}],attrs:{label:"退款金额：",prop:"actual_fee",rules:[e.simpleRule]}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{type:"number"},model:{value:e.closeForm.actual_fee,callback:function(t){e.$set(e.closeForm,"actual_fee",t)},expression:"closeForm.actual_fee"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"操作密码：",prop:"password",rules:[e.simpleRule]}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{type:"password"},model:{value:e.closeForm.password,callback:function(t){e.$set(e.closeForm,"password",t)},expression:"closeForm.password"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.closedialogVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{disabled:!e.closeForm.password,type:"primary"},on:{click:e.orderClose}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"修改发票信息",visible:e.invoicedialogVisible,modal:e.needMask,width:"30%"},on:{"update:visible":function(t){e.invoicedialogVisible=t}}},[s("el-form",{ref:"form",attrs:{model:e.invoice,rules:e.rules,"label-width":"120px","label-position":"right"}},[s("el-form-item",{attrs:{label:"发票类型：",prop:"invoiceType"}},[s("el-select",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{placeholder:"请选择"},model:{value:e.invoice.invoiceType,callback:function(t){e.$set(e.invoice,"invoiceType",t)},expression:"invoice.invoiceType"}},e._l(e.invoiceTypeoptions,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"发票抬头：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{autocomplete:"off"},model:{value:e.invoice.title,callback:function(t){e.$set(e.invoice,"title",t)},expression:"invoice.title"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"发票内容：",prop:"content"}},[s("el-select",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{placeholder:"请选择"},model:{value:e.invoice.invoiceType,callback:function(t){e.$set(e.invoice,"invoiceType",t)},expression:"invoice.invoiceType"}},e._l(e.invoiceContentoptions,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"收票人手机：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{autocomplete:"off"},model:{value:e.invoice.tel,callback:function(t){e.$set(e.invoice,"tel",t)},expression:"invoice.tel"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"收票人邮箱：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{autocomplete:"off"},model:{value:e.invoice.mailbox,callback:function(t){e.$set(e.invoice,"mailbox",t)},expression:"invoice.mailbox"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.invoicedialogVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.invoicedialogVisible=!1}}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"修改收货人信息",visible:e.buyerdialogVisible,modal:e.needMask,width:"30%"},on:{"update:visible":function(t){e.buyerdialogVisible=t}}},[s("el-form",{ref:"buyerForm",attrs:{model:e.buyer,"label-width":"120px","label-position":"right"}},[s("el-form-item",{attrs:{label:"收货人姓名：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{autocomplete:"off"},model:{value:e.buyer.receiver_name,callback:function(t){e.$set(e.buyer,"receiver_name",t)},expression:"buyer.receiver_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"手机号码：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{autocomplete:"off"},model:{value:e.buyer.receiver_mobile,callback:function(t){e.$set(e.buyer,"receiver_mobile",t)},expression:"buyer.receiver_mobile"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"所在区域：",prop:"content"}},[s("el-select",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{clearable:"",filterable:"",placeholder:"省"},model:{value:e.buyer.receiver_province_id,callback:function(t){e.$set(e.buyer,"receiver_province_id",t)},expression:"buyer.receiver_province_id"}},e._l(e.provinceData,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),s("el-select",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{clearable:"",filterable:"",placeholder:"市"},model:{value:e.buyer.receiver_city_id,callback:function(t){e.$set(e.buyer,"receiver_city_id",t)},expression:"buyer.receiver_city_id"}},e._l(e.cityData,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),s("el-select",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{clearable:"",filterable:"",placeholder:"区县"},model:{value:e.buyer.receiver_district_id,callback:function(t){e.$set(e.buyer,"receiver_district_id",t)},expression:"buyer.receiver_district_id"}},e._l(e.countyData,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),s("el-select",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{clearable:"",filterable:"",placeholder:"街道"},model:{value:e.buyer.receiver_street_id,callback:function(t){e.$set(e.buyer,"receiver_street_id",t)},expression:"buyer.receiver_street_id"}},e._l(e.townData,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"详细地址：",prop:"title"}},[s("el-input",{staticStyle:{width:"70%",margin:"0 5% 10px 0"},attrs:{type:"textarea",rows:4,autocomplete:"off"},model:{value:e.buyer.receiver_address,callback:function(t){e.$set(e.buyer,"receiver_address",t)},expression:"buyer.receiver_address"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.buyerdialogVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.modifyReceive}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"修改物流信息",visible:e.changeTransportVisible,modal:e.needMask,width:"30%"},on:{"update:visible":function(t){e.changeTransportVisible=t}}},[s("el-form",{ref:"changeTransportForm",attrs:{model:e.changeTransportForm,"label-width":"120px","label-position":"right"}},[s("el-form-item",{attrs:{label:"快递",prop:"code",rules:[e.simpleRule]}},[s("el-select",{attrs:{placeholder:"快递公司"},model:{value:e.changeTransportForm.code,callback:function(t){e.$set(e.changeTransportForm,"code",t)},expression:"changeTransportForm.code"}},e._l(e.express,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.express_code}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"物流单号",prop:"sn",rules:[e.simpleRule]}},[s("el-input",{model:{value:e.changeTransportForm.sn,callback:function(t){e.$set(e.changeTransportForm,"sn",t)},expression:"changeTransportForm.sn"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.changeTransportVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submitChangeTransport}},[e._v("\n            确定\n        ")])],1)],1),e._v(" "),s("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),s("RightSidePopup",{attrs:{visible:e.rghtPopupVisible,width:"30%"},on:{"update:visible":function(t){e.rghtPopupVisible=t}}},[s("orderFollow")],1)],1)},staticRenderFns:[]};var U=s("C7Lr")(q,A,!1,function(e){s("Vx6f")},"data-v-2bca2a1c",null).exports,J=s("ujAg"),W=s.n(J),G={order_sn:"",status_name:"",logistics_sn:"",actual_fee:"",receiver_name:"",receiver_mobile:"",supplier_name:"",orderExtend:[],insurance_fee:"",orderSale:[]},X={sale_type:"",reason:"",description:"",username:"",phone:"",imgs:[],video:[],order_id:"",uid:"",freight_fee:"",is_quality:"0",goods_fee:"",add_fee:"",freight_type:"0",is_rebate:"",receiver_address:"",remark:""},Z={name:"customer",props:{userObj:[Object],refresh:[Number]},components:{afterSaleApplicationDetail:M.default,ExpressCheck:N,ProductDetail:K.a,OrderDetail:U},data:function(){return{visible:!1,showCreateRecoup:!1,dialogVisible:!1,orderDetailVisible:!1,previewImg:"",rghtPopupVisible:!1,rghtProductVisible:!1,rghtPopupVisibleExpress:!1,options1:[],options2:[],loading:!1,username:"",phone:"",avatar:"",haveOrder:!1,orderInfo:JSON.parse(r()(G)),inputOrder:"",uid:"",order_id:"",form:JSON.parse(r()(X)),rules:{},simpleRule:{required:!0,message:"必填项",trigger:"change"},videos:[],inputProduct:"",goods_id:"",productList:[],shouwProdect:!1,logistics_snSerch:"",orderExtend:[],goodsChoosed:[]}},watch:{userObj:function(e){console.log(e),this.username=e.username,this.avatar=e.avatar,this.haveOrder=!0,this.uid=e.id,this.order_id=e.order_id,this.goodsChoosed=[],e.id&&e.order_id?(this.getOrder(),this.getOrderExtend()):(this.orderInfo=JSON.parse(r()(G)),this.orderExtend=[])},"form.is_quality":{handler:function(e){switch(e){case"0":case"1":2==this.form.freight_type&&this.calculateFreight_fee()}},immediate:!0},"form.freight_type":function(e){switch(e){case"0":case"1":this.form.freight_fee=0;break;case"2":this.calculateFreight_fee()}},"form.sale_type":function(e){1!=e&&4!=e||(this.form.is_rebate="1"),2!=e&&3!=e&&5!=e||(this.form.is_rebate="0"),4==e?this.calculatePrice(this.orderExtend,"max_return_count"):this.calculatePrice(this.goodsChoosed,"now_count")},goodsChoosed:{handler:function(e){this.calculatePrice(e,"now_count")},deep:!0}},created:function(){this.getSaleinfo()},mounted:function(){},methods:{calculatePrice:function(e,t){if(0===e.length)return this.form.goods_fee="0";var s=e.map(function(e){return String(W()(String(e.sale_price)).mul(String(e[t])))}).reduce(function(e,t){return String(W()(e).plus(t))}),i=String(W()(String(this.orderInfo.actual_fee)).minus(String(this.orderInfo.insurance_fee)));this.form.goods_fee=+s>+i?+i:+s},calculateFreight_fee:function(){0==this.form.is_quality&&(this.form.freight_fee=String(W()(+this.orderInfo.freight_fee).plus(+this.orderInfo.compensate)),console.log(+this.orderInfo.freight_fee,+this.orderInfo.compensate)),1==this.form.is_quality&&(this.form.freight_fee=String(W()(+this.orderInfo.freight_fee).plus(+this.orderInfo.compensate).plus(+this.orderInfo.insurance_fee)),console.log(+this.orderInfo.freight_fee,+this.orderInfo.compensate))},handleSelectionChange:function(e){this.goodsChoosed=e},showAddWorkOrder:function(e){var t=this;return m()(v.a.mark(function s(){return v.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t.dialogVisible=!0,1===e&&(t.showCreateRecoup=!1,t.form.sale_type="",t.$nextTick(function(){t.orderExtend=JSON.parse(r()(t.orderExtend))})),2===e&&(t.showCreateRecoup=!0,t.form.sale_type=5);case 3:case"end":return s.stop()}},s,t)}))()},getOrder:function(e){var t=this;return m()(v.a.mark(function s(){var i,a;return v.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t.form=JSON.parse(r()(X)),s.prev=1,s.next=4,t.$api.order.orderinfo({uid:t.uid,order_id:t.order_id,keywords:e});case 4:if(i=s.sent,a=i.data,t.uid){s.next=8;break}return s.abrupt("return");case 8:a.order_data?t.orderInfo=a.order_data:t.orderInfo=JSON.parse(r()(G)),t.phone=a.user_info&&a.user_info.phone?a.user_info.phone:"",t.order_id=a.order_data&&a.order_data.id?a.order_data.id:"",s.next=18;break;case 13:s.prev=13,s.t0=s.catch(1),t.orderInfo=JSON.parse(r()(G)),t.phone="",t.order_id="";case 18:case"end":return s.stop()}},s,t,[[1,13]])}))()},getOrderExtend:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.orderExtend=[],t.next=3,e.$api.order.getOrderExtend({order_id:e.order_id});case 3:s=t.sent,(i=s.data).length?(i.forEach(function(e){e.now_count=0}),e.orderExtend=i):e.orderExtend=[];case 6:case"end":return t.stop()}},t,e)}))()},getSaleinfo:function(e){var t=this;return m()(v.a.mark(function e(){var s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.service.saleinfo();case 2:s=e.sent,i=s.data,t.options1=i.reason,t.options2=i.sale_type;case 6:case"end":return e.stop()}},e,t)}))()},getProduct:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.product.getGoodsList({keywords:e.inputProduct,goods_id:e.goods_id,pageSize:50,page:1});case 2:s=t.sent,i=s.data,e.productList=i.list.items;case 5:case"end":return t.stop()}},t,e)}))()},proDetail:function(e){this.rghtProductVisible=!0,this.detailData=e,console.log(e)},resetForm:function(){this.$refs.form.resetFields()},getsuccessUpload:function(e,t){switch(console.log(e[0]),t){case"imgs":this.form.imgs.push(e[0]);break;case"video":this.form.video.push(e[0])}},checkParams:function(e){var t=!0;return["is_quality","is_rebate","remark"].forEach(function(s){0===e[s]||e[s]||(t=!1)}),t},addOrder:function(){var e,t=this;this.$refs.form.validate((e=m()(v.a.mark(function e(s){var i,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=32;break}if(i=c()({},t.form),1!=t.orderInfo.status&&delete i.receiver_address,i.order_id=t.order_id,i.uid=t.uid,i.session_id=t.userObj.session_id,t.showCreateRecoup){e.next=12;break}if(4==t.form.sale_type?i.return_sku_list=t.orderExtend.map(function(e){return{sku_id:e.sku_id,count:e.max_return_count}}):i.return_sku_list=t.goodsChoosed.map(function(e){return{sku_id:e.sku_id,count:e.now_count}}),0!==i.return_sku_list.length){e.next=11;break}return t.$message.error("请选择商品"),e.abrupt("return");case 11:i.return_sku_list=i.return_sku_list.filter(function(e){return 0!=e.count});case 12:if(r=+String(W()(String(t.orderInfo.actual_fee)).minus(String(t.orderInfo.insurance_fee))),!(+i.goods_fee>r)){e.next=16;break}return t.$message.error("商品退款不能大于订单支付减去运费险"),e.abrupt("return");case 16:if(t.checkParams(i)){e.next=19;break}return t.$message.error("请检查必填信息是否完整"),e.abrupt("return");case 19:if(t.showCreateRecoup){e.next=24;break}return e.next=22,t.$api.service.apply(i);case 22:e.next=26;break;case 24:return e.next=26,t.$api.service.applyMoney(i);case 26:t.refresh=t.refresh+1,t.$emit("update:refresh",t.refresh),t.getOrder(),t.getOrderExtend(),t.dialogVisible=!1,t.resetForm();case 32:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},successUpload:function(e,t){this[t]=[{name:t,url:e[0]}]},removeMinorVideo:function(e){this.form.video.splice(e,1)},removeImgs:function(e){this.form.imgs.splice(e,1)},jumpTo:function(e){this.orderDetailVisible=!0,this.$refs.orderDetail.needMask=!1,this.$refs.orderDetail.id=e,this.$refs.orderDetail.getOrderDetail()},handleOrder:function(e){this.rghtPopupVisible=!0,this.$refs.detail.getDetailData(e.id)},successCallback:function(){this.getOrder(),this.getOrderExtend(),this.rghtPopupVisible=!1,this.refresh=this.refresh+1,this.$emit("update:refresh",this.refresh)},handlePreviewImg:function(e){this.visible=!0,this.previewImg=e},expressCheck:function(){this.orderInfo.logistics_sn?(this.rghtPopupVisibleExpress=!0,this.logistics_snSerch=this.orderInfo.logistics_sn):this.$message.info("无物流信息")}}},Y={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"customer"},[s("section",{directives:[{name:"show",rawName:"v-show",value:e.haveOrder,expression:"haveOrder"}]},[s("div",{staticClass:"user-info border-bottom"},[s("img",{directives:[{name:"show",rawName:"v-show",value:e.avatar,expression:"avatar"}],attrs:{src:e.avatar}}),e._v(" "),s("p",[s("span",[e._v(e._s(e.username))]),e._v(" "),s("span",[e._v(e._s(e.phone))])])]),e._v(" "),s("div",{staticClass:"sale-info border-bottom flex"},[s("el-input",{attrs:{placeholder:"请输入订单编号"},model:{value:e.inputOrder,callback:function(t){e.inputOrder=t},expression:"inputOrder"}}),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getOrder(e.inputOrder)}}},[e._v("查询")])],1),e._v(" "),e._l(e.orderInfo.orderSale,function(t){return s("div",{key:t.id,staticClass:"sale-info border-bottom flex",on:{click:function(s){return s.stopPropagation(),e.handleOrder(t)}}},[s("div",[s("p",[s("span",[e._v("工单编号：")]),s("span",[e._v(e._s(t.return_sn))])]),e._v(" "),s("p",[s("span",[e._v("工单状态：")]),s("span",[e._v(e._s(t.status_name))])]),e._v(" "),s("p",[s("span",[e._v("售后类型：")]),s("span",[e._v(e._s(t.type_name))])])]),e._v(" "),s("i",{staticClass:"el-icon-arrow-right"})])}),e._v(" "),e.orderInfo&&""!=e.orderInfo.order_sn?s("section",[s("div",{staticClass:"sale-info border-bottom flex",staticStyle:{cursor:"pointer"},on:{click:function(t){return t.stopPropagation(),e.jumpTo(e.orderInfo.id)}}},[s("div",[s("p",[s("span",[e._v("订单编号：")]),s("span",[e._v(e._s(e.orderInfo.order_sn))])]),e._v(" "),s("p",[s("span",[e._v("订单状态：")]),s("span",[e._v(e._s(e.orderInfo.status_name))])])]),e._v(" "),s("i",{staticClass:"el-icon-arrow-right"})]),e._v(" "),s("div",{staticClass:"sale-info border-bottom flex",staticStyle:{cursor:"pointer"},on:{click:function(t){return t.stopPropagation(),e.expressCheck(t)}}},[s("div",[s("p",[s("span",[e._v("物流单号：")]),s("span",[e._v(e._s(e.orderInfo.logistics_sn))])])]),e._v(" "),s("i",{staticClass:"el-icon-arrow-right"})]),e._v(" "),s("div",{staticClass:"sale-info border-bottom"},[s("p",[s("span",[e._v("总价：")]),s("span",[e._v(e._s(e.orderInfo.actual_fee))])]),e._v(" "),s("p",[s("span",[e._v("收货人：")]),s("span",[e._v(e._s(e.orderInfo.receiver_name))])]),e._v(" "),s("p",[s("span",[e._v("收货人电话：")]),s("span",[e._v(e._s(e.orderInfo.receiver_mobile))])]),e._v(" "),s("br"),e._v(" "),s("p",[s("span",[e._v("供货商：")]),s("span",[e._v(e._s(e.orderInfo.supplier_name))])]),e._v(" "),s("p",[s("span",[e._v("运费险：")]),s("span",[e._v(e._s(e.orderInfo.insurance_fee))])])]),e._v(" "),e._l(e.orderInfo.orderExtend,function(t){return s("div",{key:t.id,staticClass:"product-info border-bottom"},[s("img",{attrs:{src:t.goods_thumb},on:{click:function(s){return e.handlePreviewImg(t.goods_thumb)}}}),e._v(" "),s("p",[s("span",[e._v(e._s(t.goods_name))]),e._v(" "),s("span",[e._v(e._s(t.sku_properties_name))]),e._v(" "),s("span",[e._v("数量："+e._s(t.nums))])])])})],2):e._e()],2),e._v(" "),s("div",{staticClass:"btns"},[0!=e.orderExtend.length?s("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.showAddWorkOrder(1)}}},[e._v("创建工单")]):e._e(),e._v(" "),0!=e.orderExtend.length?s("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.showAddWorkOrder(2)}}},[e._v("创建补偿")]):e._e()],1),e._v(" "),e.shouwProdect?s("section",[s("div",{staticClass:"sale-info border-bottom flex"},[s("el-input",{attrs:{placeholder:"请输入商品名称"},model:{value:e.inputProduct,callback:function(t){e.inputProduct=t},expression:"inputProduct"}}),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getProduct()}}},[e._v("查询")])],1),e._v(" "),e._l(e.productList,function(t){return s("div",{key:t.id,staticClass:"product-info border-bottom",on:{click:function(s){return s.stopPropagation(),e.proDetail(t)}}},[s("img",{attrs:{src:t.thumb},on:{click:function(s){return s.stopPropagation(),e.handlePreviewImg(t.thumb)}}}),e._v(" "),s("p",[s("span",[e._v(e._s(t.title))]),e._v(" "),s("span",[e._v("价格："+e._s(t.shop_price))]),e._v(" "),s("span",[e._v("库存："+e._s(t.stock))])])])}),e._v(" "),s("RightSidePopup",{attrs:{visible:e.rghtProductVisible,width:"60%"},on:{"update:visible":function(t){e.rghtProductVisible=t}}},[s("ProductDetail",{attrs:{detailData:e.detailData}})],1)],2):e._e(),e._v(" "),s("RightSidePopup",{attrs:{visible:e.rghtPopupVisible,width:"800px"},on:{"update:visible":function(t){e.rghtPopupVisible=t}}},[s("afterSaleApplicationDetail",{ref:"detail",on:{successCBK:e.successCallback}})],1),e._v(" "),s("RightSidePopup",{staticClass:"express-check",attrs:{visible:e.rghtPopupVisibleExpress,width:"800px"},on:{"update:visible":function(t){e.rghtPopupVisibleExpress=t}}},[s("express-check",{ref:"detailExpress",attrs:{logistics_sn:e.logistics_snSerch},on:{successCBK:e.successCallback}})],1),e._v(" "),s("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),s("el-dialog",{attrs:{title:"创建工单",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px","label-position":"right"}},[s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"售后原因：",prop:"reason",rules:[e.simpleRule]}},[s("el-select",{staticStyle:{width:"70%"},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}},e._l(e.options1,function(e){return s("el-option",{key:e.id,attrs:{label:e.content,value:e.content}})}),1)],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"售后类型：",prop:"sale_type",rules:[e.simpleRule]}},[s("el-select",{staticStyle:{width:"70%"},attrs:{disabled:e.showCreateRecoup},model:{value:e.form.sale_type,callback:function(t){e.$set(e.form,"sale_type",t)},expression:"form.sale_type"}},e._l(e.options2,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"联系人：",prop:"username"}},[s("el-input",{staticStyle:{width:"70%"},attrs:{autocomplete:"off"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"联系电话：",prop:"phone"}},[s("el-input",{staticStyle:{width:"70%"},attrs:{autocomplete:"off"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"问题描述："}},[s("el-input",{staticStyle:{width:"70%"},attrs:{type:"textarea",rows:4,autocomplete:"off"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"上传图片："}},[e._l(e.form.imgs,function(t,i){return s("li",{key:i,staticClass:"imgs",style:{backgroundImage:"url("+t+")"},on:{click:function(s){return e.handlePreview(t)}}},[s("i",{staticClass:"el-icon-circle-close-outline",on:{click:function(t){return t.stopPropagation(),e.removeImgs("index")}}})])}),e._v(" "),s("FileUpload",{attrs:{width:"100px",height:"100px",limit:5,isBotton:""},on:{successUploadCBK:function(t){return e.getsuccessUpload(t,"imgs")}}})],2),e._v(" "),s("el-form-item",{attrs:{label:"上传视频："}},[e._l(e.form.video,function(t,i){return s("li",{key:i,staticClass:"videos"},[t?s("video",{attrs:{src:t,controls:"",preload:""}}):e._e(),e._v(" "),s("i",{staticClass:"el-icon-circle-close-outline",on:{click:function(t){return t.stopPropagation(),e.removeMinorVideo("index")}}})])}),e._v(" "),s("FileUpload",{attrs:{width:"100px",height:"100px",limit:2,isVideo:"",isBotton:""},on:{successUploadCBK:function(t){return e.getsuccessUpload(t,"video")}}})],2),e._v(" "),e.showCreateRecoup?e._e():s("el-form-item",{attrs:{label:4!=e.form.sale_type?"请选择需处理的商品：":"需处理的商品","label-width":"140",rules:[e.simpleRule]}},[s("el-table",{attrs:{border:"",data:e.orderExtend},on:{"selection-change":e.handleSelectionChange}},[4!=e.form.sale_type?s("el-table-column",{attrs:{fixed:"",width:"50",align:"center",type:"selection"}}):e._e(),e._v(" "),s("el-table-column",{attrs:{align:"center",prop:"goods_name",width:"120",label:"商品标题"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",prop:"sku_properties_name",label:"商品型号"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",prop:"sale_price",label:"价格"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",width:"100",prop:"nums",label:"数量"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",width:"200",label:"退货数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[4!=e.form.sale_type?s("el-input-number",{attrs:{step:1,min:1,max:+t.row.max_return_count,label:"退货数量"},model:{value:t.row.now_count,callback:function(s){e.$set(t.row,"now_count",s)},expression:"scope.row.now_count"}}):e._e(),e._v(" "),4==e.form.sale_type?s("span",[e._v(e._s(t.row.max_return_count))]):e._e()]}}],null,!1,435616866)})],1)],1),e._v(" "),s("div",{staticClass:"card"},[s("div",[s("div",{staticClass:"table-content"},[s("div",{directives:[{name:"show",rawName:"v-show",value:0==e.form.sale_type||1==e.form.sale_type||4==e.form.sale_type,expression:"form.sale_type==0||form.sale_type==1||form.sale_type==4"}],staticClass:"table-row"},[s("div",{staticClass:"table-left"},[e._v("商品退款")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticClass:"s1"},[s("el-input",{model:{value:e.form.goods_fee,callback:function(t){e.$set(e.form,"goods_fee",t)},expression:"form.goods_fee"}},[s("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),s("span",{staticStyle:{"font-size":"12px",color:"#908181"}},[e._v("商品退款不能大于订单支付减去运费险")])])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-left"},[e._v("补偿金额")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticClass:"s1"},[s("el-input",{model:{value:e.form.add_fee,callback:function(t){e.$set(e.form,"add_fee",t)},expression:"form.add_fee"}},[s("template",{slot:"append"},[e._v("元")])],2)],1)])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-left"},[s("i",{staticStyle:{color:"red"}},[e._v("*")]),e._v("\n                        是否是质量问题\n                    ")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticClass:"s1"},[s("el-radio",{attrs:{label:"0"},model:{value:e.form.is_quality,callback:function(t){e.$set(e.form,"is_quality",t)},expression:"form.is_quality"}},[e._v("否")]),e._v(" "),s("el-radio",{attrs:{label:"1"},model:{value:e.form.is_quality,callback:function(t){e.$set(e.form,"is_quality",t)},expression:"form.is_quality"}},[e._v("是")])],1)])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-left"},[e._v("运费类型")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticStyle:{"padding-left":"10px"}},[s("el-radio",{attrs:{label:"0"},model:{value:e.form.freight_type,callback:function(t){e.$set(e.form,"freight_type",t)},expression:"form.freight_type"}},[e._v("无")]),e._v(" "),s("el-radio",{attrs:{label:"1"},model:{value:e.form.freight_type,callback:function(t){e.$set(e.form,"freight_type",t)},expression:"form.freight_type"}},[e._v("补平台运费")]),e._v(" "),s("el-radio",{attrs:{label:"2"},model:{value:e.form.freight_type,callback:function(t){e.$set(e.form,"freight_type",t)},expression:"form.freight_type"}},[e._v("退用户运费/运费险")]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:1==e.form.freight_type||2==e.form.freight_type,expression:"form.freight_type == 1 || form.freight_type == 2"}]},[s("el-input",{staticStyle:{display:"inline-block",width:"100px","margin-left":"20px"},attrs:{placeholder:"请输入运费"},model:{value:e.form.freight_fee,callback:function(t){e.$set(e.form,"freight_fee",t)},expression:"form.freight_fee"}}),e._v(" 元\n                                ")],1)],1)])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-left"},[s("i",{staticStyle:{color:"red"}},[e._v("*")]),e._v("\n                        是否扣除返利\n                    ")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticClass:"s1"},[s("el-radio",{attrs:{label:"0"},model:{value:e.form.is_rebate,callback:function(t){e.$set(e.form,"is_rebate",t)},expression:"form.is_rebate"}},[e._v("否")]),e._v(" "),s("el-radio",{attrs:{label:"1"},model:{value:e.form.is_rebate,callback:function(t){e.$set(e.form,"is_rebate",t)},expression:"form.is_rebate"}},[e._v("是")])],1)])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:1==e.form.sale_type||2==e.form.sale_type,expression:"form.sale_type == 1 || form.sale_type == 2"}]},[s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-left"},[e._v("\n                            仓库信息")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticClass:"s1",staticStyle:{width:"500px"}},[1==e.orderInfo.status?s("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"收货人姓名   联系电话   详细地址"},model:{value:e.form.receiver_address,callback:function(t){e.$set(e.form,"receiver_address",t)},expression:"form.receiver_address"}}):s("span",[e._v(e._s(e.orderInfo.receiver_address))])],1)])])]),e._v(" "),s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-left"},[s("i",{staticStyle:{color:"red"}},[e._v("*")]),e._v("\n                        处理备注")]),e._v(" "),s("div",{staticClass:"table-right"},[s("span",{staticClass:"s1",staticStyle:{width:"500px"}},[s("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)])])])])])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1,e.isEdit=!1,e.resetForm()}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.addOrder}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),s("RightSidePopup",{attrs:{visible:e.orderDetailVisible,width:"1000px"},on:{"update:visible":function(t){e.orderDetailVisible=t}}},[s("OrderDetail",{ref:"orderDetail"})],1)],1)},staticRenderFns:[]};var Q=s("C7Lr")(Z,Y,!1,function(e){s("bc1z"),s("PgoK")},"data-v-7aee96e9",null).exports,ee={name:"MoreOrder",props:{userObj:[Object],refresh:[Number]},components:{afterSaleApplicationDetail:M.default},data:function(){return{visible:!1,rghtPopupVisible:!1,previewImg:"",pageSize:5,uid:"",list:[],count:0,current:1}},computed:{},watch:{userObj:function(e){this.uid=e.id,e.id?this.getMore():(this.list=[],this.count=0)},refresh:function(e){this.getMore()}},created:function(){},mounted:function(){},methods:{handleChange:function(e){e&&(this.rghtPopupVisible=!0,this.$refs.detail.getDetailData(e))},successCallback:function(){this.getMore(),this.rghtPopupVisible=!1},handlePreviewImg:function(e){this.visible=!0,this.previewImg=e},getMore:function(){var e=this;return m()(v.a.mark(function t(){var s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.order.orderlist({uid:e.uid,pageSize:e.pageSize,page:e.current});case 2:s=t.sent,i=s.data,e.uid&&(e.list=i.items,e.count=i.total_num);case 5:case"end":return t.stop()}},t,e)}))()},handlePageChange:function(e){this.current=e,this.getMore()},handleSizeChange:function(e){this.pageSize=e,this.getMore()}}},te={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"customer"},[e._l(e.list,function(t){return s("section",{key:t.id,staticClass:"list"},[s("div",{staticClass:"sale-info border-bottom"},[s("p",[s("span",[e._v("工单编号：")]),s("span",[e._v(e._s(t.return_sn))]),s("span",{staticClass:"span-btn"},[e._v(e._s(t.type_name))])]),e._v(" "),s("p",[s("span",[e._v("订单编号：")]),s("span",[e._v(e._s(t.order.order_sn))]),s("span",{staticClass:"span-btn"},[e._v(e._s(t.status_name))])]),e._v(" "),s("p",[s("span",[e._v("物流单号：")]),s("span",[e._v(e._s(t.order.logistics_sn))])]),e._v(" "),s("p",[s("span",[e._v("运费险：")]),s("span",[e._v(e._s(t.order.insurance_fee))])]),e._v(" "),1==t.status||10==t.status||15==t.status||11==t.status?s("el-button",{attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),e.handleChange(t.id)}}},[e._v("处理")]):e._e(),e._v(" "),12==t.status?s("el-button",{attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),e.handleChange(t.id)}}},[e._v("查看")]):e._e()],1),e._v(" "),e._l(t.orderExtend,function(t){return s("div",{key:t.id,staticClass:"product-info border-bottom"},[s("img",{attrs:{src:t.goods_thumb},on:{click:function(s){return e.handlePreviewImg(t.goods_thumb)}}}),e._v(" "),s("p",[s("span",[e._v(e._s(t.goods_name))]),e._v(" "),s("span",[e._v(e._s(t.sku_properties_name))]),e._v(" "),s("span",[e._v("数量："+e._s(t.nums))])])])})],2)}),e._v(" "),s("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),s("el-pagination",{directives:[{name:"show",rawName:"v-show",value:0!=e.count,expression:"count!=0"}],staticClass:"pagation",attrs:{small:"",total:e.count,"page-size":e.pageSize,"current-page":e.current,layout:"total, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange}}),e._v(" "),s("RightSidePopup",{attrs:{visible:e.rghtPopupVisible,width:"60%"},on:{"update:visible":function(t){e.rghtPopupVisible=t}}},[s("afterSaleApplicationDetail",{ref:"detail",on:{successCBK:e.successCallback}})],1)],2)},staticRenderFns:[]};var se=s("C7Lr")(ee,te,!1,function(e){s("o79w")},"data-v-f710bdb4",null).exports,ie={name:"Order",props:{userObj:[Object]},components:{Customer:Q,MoreOrder:se},data:function(){return{activeName:"customer",keywords:"",rghtPopupVisible:!1,searchLoading:!1,filterData:[],refresh:0}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{querySearchAsync:function(e){this.filterData=e?[{id:"503",sn:"S20190222174447576885"}]:[]},handleChange:function(e){e&&(this.rghtPopupVisible=!0,this.$refs.detail.getDetailData(e))},successCallback:function(){this.getData(),this.rghtPopupVisible=!1}}},re={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"order-service-single"},[s("el-radio-group",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-radio-button",{attrs:{label:"customer"}},[e._v("客户")]),e._v(" "),s("el-radio-button",{attrs:{label:"more"}},[e._v("更多工单")])],1),e._v(" "),s("customer",{directives:[{name:"show",rawName:"v-show",value:"customer"===e.activeName,expression:"activeName === 'customer'"}],attrs:{userObj:e.userObj,refresh:e.refresh},on:{"update:refresh":function(t){e.refresh=t}}}),e._v(" "),s("more-order",{directives:[{name:"show",rawName:"v-show",value:"more"===e.activeName,expression:"activeName === 'more'"}],attrs:{userObj:e.userObj,refresh:e.refresh},on:{"update:refresh":function(t){e.refresh=t}}})],1)},staticRenderFns:[]};var ae=s("C7Lr")(ie,re,!1,function(e){s("JSiB"),s("MGIy")},"data-v-22d92d50",null).exports,oe=s("69f0"),ne=void 0,le=void 0,ce={page:1,page_size:100},de={name:"Service",components:{User:x,Chat:T,Order:ae},data:function(){var e=u.a.state.user.userInfo;return console.log(e),{chatBody:{},showBody:[],hotChat:{},receiver_id:null,operation:0,session_id:"",userObj:{},serachname:"",current:1,key:0,heartTimer:null,kefuStatus:1,baseMsg:{company_id:oe.company_id,person_type:1,person_id:e.id,person_name:e.username,person_head_picture:e.avatar,auth_key:"",type:0,message:"",msg_type:2100,msg_content_type:1,status:0,sort_type:2},pageInfo:c()({},ce),activeKey:"",lookMore:!0,canTalk:!0}},computed:{reconnectSuccess:function(){return u.a.state.socket.socket.reconnectSuccess}},watch:{reconnectSuccess:function(e){e&&(this.sendSocket({message:"客服连接"},2e3,!1),u.a.state.socket.socket.reconnectSuccess=!1)},activeKey:function(e){if(e){var t=this.showBody.find(function(t){return t.key===e});t&&(this.canTalk=2!=t.conversation_status)}else this.canTalk=!1}},created:function(){var e=this;0!==u.a.state.tagsView.tabKey&&(clearInterval(le),clearInterval(this.heartTimer),le=null,this.heartTimer=null,le=setInterval(function(){e.$connect&&(e.init(),clearInterval(le),le=null,e.heartTimer=setInterval(function(){e.sendSocket({message:"心跳消息"},1001,!1)},1e4))},500))},beforeDestroy:function(){},methods:c()({},Object(d.d)("socket",["SOCKET_ONMESSAGE"]),{dislogShow:function(){var e=this;this.$createElement;ne=this.$notify.info({title:"系统提示",message:"您有新的会话消息，请及时处理。",duration:0,onClick:function(){e.$router.push({name:"ServiceIm"}),e.closeMessage()},onClose:function(){e.closeMessage()}})},refresh:function(e){e&&(this.baseMsg.sort_type=e),this.pageInfo=c()({},ce),this.showBody=[],this.getSessionList()},closeMessage:function(){this.isClose||(this.isClose=!0,ne.close(),ne=void 0,this.isClose=!1)},init:function(){var e=this;ne&&this.closeMessage(),this.$connect(),this.$socket.onopen=function(){e.sendSocket({message:"客服连接"},2e3,!1)},window.a=null,this.$socket.onmessage=a=function(t){var s=t.data,i=JSON.parse(s),r=i.msg_type;[1005,2100].includes(r)&&(r="1005,2100");var a=void 0,o=void 0;switch(i.key!==e.activeKey&&(a=e.showBody.findIndex(function(t){return t.key===e.activeKey}))>=0&&(o=e.showBody.splice(a,1)[0]),r){case 2500:var l=[].concat(n()(i.result.list));e.showBody.forEach(function(e){for(var t=0;t<l.length;t++)if(e.key===l[t].key){l.splice(t,1);break}}),e.showBody=e.showBody.concat(l);break;case"1005,2100":if("/Service/Service"!==e.$router.history.current.path&&!ne)return void e.dislogShow();if(i.key===e.activeKey)return console.log("当前会话"),e.hotChat=e.transformMsgContentForOldVersion(i),void(2===i.person_type&&e.readed([i.msg_index]));var c=e.showBody.map(function(e){return e.key}),d=e.showBody.slice(0);if(c.includes(i.key)){console.log("已有会话"+i.key+i.person_name+e.showBody.map(function(e){return e.key}));var u=d.findIndex(function(e){return e.key===i.key}),p=d[u];p.unread_msg_num=+p.unread_msg_num+1,p.latest_msg?p.latest_msg.date=i.date:p.latest_msg={date:i.date},d.splice(u,1),d.unshift(p),e.showBody=d}else console.log("新增会话"+i.key+i.person_name+e.showBody.map(function(e){return e.key})),d.unshift(i),e.showBody=d;break;case 2099:if("/Service/Service"!==e.$router.history.current.path&&!ne)return void e.dislogShow();var v=e.showBody.map(function(e){return e.key}),f=e.showBody.slice(0);v.includes(i.key)?console.log("已有会话"+i.key+i.person_name+e.showBody.map(function(e){return e.key})):(console.log("新增会话"+i.key+i.person_name+e.showBody.map(function(e){return e.key})),f.unshift(i),e.showBody=f);break;case 2e3:0===e.showBody.length&&e.getSessionList(),e.kefuStatus=i.person_status;break;case 2600:var m=!e.$refs.chat.msgs.length,_=e.$refs.chat.$refs.session.scrollHeight;e.$refs.chat.msgs=i.list.map(function(t){return e.transformMsgContentForOldVersion(t)}).concat(e.$refs.chat.msgs),m?(e.lookMore=!0,setTimeout(function(){e.$refs.chat.$refs.session.scrollTo(0,99999)},0)):setTimeout(function(){var t=e.$refs.chat.$refs.session.scrollHeight;e.$refs.chat.$refs.session.scrollTo(0,t-_)},0),0===i.list.length&&(e.lookMore=!1),e.readed(i.list.map(function(e){if(1!=e.person_type&&0==e.status)return e.msg_index}));break;case 2800:console.log("转接客服成功"),e.removeChat(i.key);break;case 2200:var h=e.$refs.chat.msgs.slice(0),g=i.msg_ids;h.forEach(function(e){(g.includes(e.msg_index)||g.includes(e.msg_index+""))&&(e.is_read=1)}),e.$refs.chat.msgs=h;break;case 2550:e.showBody=i.result;break;case 1001:console.log("heart beat");break;case 1104:throw new Error(i.message);case 1e3:e.$message.error(i.message);break;default:console.log("msg_type "+r+" 未定义")}i.key!==e.activeKey&&a>=0&&e.showBody.splice(a,0,o)}},sendSocket:function(e,t){var s=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("心跳消息"!==e.message||0!==this.kefuStatus){"离线"===e.message&&(this.kefuStatus=0),"忙碌"===e.message&&(this.kefuStatus=2),"在线"===e.message&&(this.kefuStatus=1,setTimeout(function(e){s.refresh()},500));var a=c()({},this.baseMsg,{msg_type:t},e,1===this.baseMsg.sort_type?{}:this.pageInfo);i&&(a.key=this.activeKey),2e3===t&&(a.auth_key=y.c.getToken());try{this.$socket.send(r()(a))}catch(e){throw this.$message.error("连接异常 发送失败"),e}}},getSessionList:function(e){e?this.pageInfo.page+=1:this.showBody=[],this.sendSocket({message:"拉取会话列表",key:e,page_size:100},2500,!1)},getChatHistoryList:function(e){e||(this.$refs.chat.msgs=[]),this.sendSocket({message:"拉取"+e+"之前的聊天数据",msg_index:e},2600)},transformMsgContentForOldVersion:function(e){return{sender_type:parseInt(e.person_type,10),sender_name:e.person_name,time:e.date,type:e.msg_content_type,message:e.message,is_read:e.status,msg_index:parseInt(e.msg_index,10)}},readed:function(e){this.sendSocket({message:"消息已读",status:1,msg_ids:e},2200)},finishChat:function(e){var t=this.$refs.user.historyProcessing.items;this.$refs.user.historyProcessing.count--,this.$refs.user.historyCompelete.count++,t=t.filter(function(t){return t.session_id!=e}),this.$refs.user.historyProcessing.items=JSON.parse(r()(t))},socket:function(e,t){console.log("regergreger")},clickstate:function(){console.log(this.$store.state.socket.socket)},changeKefu:function(e){var t=this.$refs.user.historyProcessing.items;this.$refs.user.historyProcessing.count--,t=t.filter(function(t){return t.session_id!=e}),this.$refs.user.historyProcessing.items=JSON.parse(r()(t))},removeChat:function(e){var t=e||this.activeKey,s=this.showBody.findIndex(function(e){return e.key===t});-1!==s&&(this.showBody.splice(s,1),this.userObj={},this.activeKey="",this.$refs.chat.msgs=[])}})},ue={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{key:e.key,class:"im-wrap "+(5===e.baseMsg.company_id?"":"tall")},[s("user",{ref:"user",attrs:{kefuStatus:e.kefuStatus,activeKey:e.activeKey,receiver_id:e.receiver_id,session_id:e.session_id,userObj:e.userObj,showBody:e.showBody},on:{refresh:e.refresh,getChatHistoryList:e.getChatHistoryList,getSessionList:e.getSessionList,"update:activeKey":function(t){e.activeKey=t},"update:active-key":function(t){e.activeKey=t},sendSocket:e.sendSocket,"update:receiver_id":function(t){e.receiver_id=t},"update:session_id":function(t){e.session_id=t},"update:userObj":function(t){e.userObj=t},"update:user-obj":function(t){e.userObj=t},"update:showBody":function(t){e.showBody=t},"update:show-body":function(t){e.showBody=t}}}),e._v(" "),s("chat",{ref:"chat",attrs:{canTalk:e.canTalk,lookMore:e.lookMore,chatBody:e.chatBody,hotChat:e.hotChat,receiver_id:e.receiver_id,session_id:e.session_id,operation:e.operation,userObj:e.userObj},on:{removeChat:e.removeChat,getChatHistoryList:e.getChatHistoryList,sendSocket:e.sendSocket,changeKefu:e.changeKefu,finishChat:e.finishChat,"update:receiver_id":function(t){e.receiver_id=t}}}),e._v(" "),s("order",{attrs:{userObj:e.userObj}})],1)},staticRenderFns:[]};var pe=s("C7Lr")(de,ue,!1,function(e){s("MezF")},null,null);t.default=pe.exports},Vx6f:function(e,t){},bTmZ:function(e,t){},bc1z:function(e,t){},n0wP:function(e,t){},ntPz:function(e,t){},o79w:function(e,t){},"tP/k":function(e,t,s){"use strict";var i=s("lC5x"),r=s.n(i),a=s("J0Oq"),o=s.n(a),n={name:"logisticsInfo",props:["logisticssn","expresscode"],data:function(){return{dialogVisible:!1,list:[]}},created:function(){},methods:{getData:function(){var e=this;return o()(r.a.mark(function t(){var s,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.order.logistics({express_code:e.expresscode,logistics_sn:e.logisticssn});case 2:s=t.sent,i=s.data,e.list=i.items;case 5:case"end":return t.stop()}},t,e)}))()},look:function(){this.dialogVisible=!0,this.getData()}}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("span",{staticClass:"text",attrs:{type:"text"},on:{click:e.look}},[e._v("查看物流")]),e._v(" "),s("el-dialog",{attrs:{title:"物流信息",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-form",{attrs:{"label-width":"120px","label-position":"right"}},[s("el-steps",{attrs:{direction:"vertical",active:0}},e._l(e.list,function(e){return s("el-step",{key:e,attrs:{title:e.context,description:e.ftime}})}),1),e._v(" "),0==e.list.length?s("div",{staticClass:"noTips"},[e._v("暂无信息")]):e._e()],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var c=s("C7Lr")(n,l,!1,function(e){s("ntPz")},"data-v-4678df61",null);t.a=c.exports},tx5V:function(e,t){}});