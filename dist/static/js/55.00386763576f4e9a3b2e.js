webpackJsonp([55],{"6SUa":function(e,t){},Ekg8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("4YfN"),l=a.n(r),i=a("lC5x"),n=a.n(i),o=a("J0Oq"),s=a.n(o),c=a("aA9S"),u=a.n(c),p={name:"Insite",mixins:[a("8Rg7").a],data:function(){return{filterData:[{value:"",label:""}],opreate:"",searchLoading:!1,rghtPopupVisible:!1,detailData:{},loading:!1,dialogVisible:!1,form:{title:"",content:""},imgs:"",rules:{},categories:[{value:1,label:"系统消息"},{value:2,label:"服务消息"},{value:3,label:"活动消息"},{value:4,label:"售后消息"},{value:5,label:"群聊消息"}],types:[{value:1,label:"对用户"},{value:2,label:"对群"},{value:3,label:"对团队"},{value:4,label:"对全站用户"},{value:5,label:"对全部普通用户"},{value:6,label:"对全部白银"},{value:7,label:"对全部钻石"},{value:8,label:"对全部合伙人"}],searchOPtions:[{type:"input",key:"keywords",placeholder:"消息标题"},{type:"dateRangePicker",key:"start_at-end_at",placeholder:"发布时间"}],query:{},current:1,pageSize:10,count:0,tableData:[]}},watch:{"form.type":function(e){this.form.to_id=[],this.filterData=[]}},activated:function(){this.getData()},methods:{getsuccessUpload:function(e){this.imgs=e},lookDetails:function(e){this.detailData=u()({},e),this.rghtPopupVisible=!0},getUserData:function(e){var t=this;return s()(n.a.mark(function a(){var r,l;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$api.user.getUserManageList({keywords:e});case 3:r=a.sent,l=r.data,t.filterData=l.items.map(function(e){return{value:e.id,label:e.username}}),a.next=10;break;case 8:a.prev=8,a.t0=a.catch(0);case 10:case"end":return a.stop()}},a,t,[[0,8]])}))()},getGroupData:function(e){var t=this;return s()(n.a.mark(function a(){var r,l;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$api.user.groupList({name:e});case 3:r=a.sent,l=r.data,t.filterData=l.items.map(function(e){return{value:e.id,label:e.name}}),a.next=10;break;case 8:a.prev=8,a.t0=a.catch(0);case 10:case"end":return a.stop()}},a,t,[[0,8]])}))()},getPartnerData:function(e){var t=this;return s()(n.a.mark(function a(){var r,l;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$api.user.partnerlist({title:e});case 3:r=a.sent,l=r.data,t.filterData=l.items.map(function(e){return{value:e.id,label:e.title}}),a.next=10;break;case 8:a.prev=8,a.t0=a.catch(0);case 10:case"end":return a.stop()}},a,t,[[0,8]])}))()},querySearchAsync:function(e){e?(1==this.form.type&&this.getUserData(e),2==this.form.type&&this.getGroupData(e),3==this.form.type&&this.getPartnerData(e)):this.filterData=[]},categoryFomat:function(e){switch(e){case 1:return"系统消息";case 2:return"服务消息";case 3:return"活动消息";case 4:return"售后消息";case 5:return"群聊消息"}},typeFomat:function(e){switch(e){case 1:return"对用户";case 2:return"对群";case 3:return"对团队";case 4:return"对全站用户"}},handelSearch:function(e,t){var a=this;({search:function(){a.query=l()({},t),a.current=1,a.getData()},reset:function(){a.query={},a.pageSize=10,a.current=1,a.getData()}})[e]()},getData:function(){var e=this;return s()(n.a.mark(function t(){var a,r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,e.$api.operate.messageList(l()({},e.query,{pageSize:e.pageSize,page:e.current}));case 4:a=t.sent,r=a.data,e.tableData=r,e.count=r.length,e.loading=!1,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),e.loading=!1;case 14:case"end":return t.stop()}},t,e,[[0,11]])}))()},handlePageChange:function(e){this.current=e,this.getData()},handleSizeChange:function(e){this.pageSize=e,this.getData()},messageAdd:function(){var e=this;return s()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$refs.form.validate(function(){var t=s()(n.a.mark(function t(a){var r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=15;break}return t.prev=1,r=u()({},e.form),4==e.form.type&&(r.to_id=0),3===e.form.category&&(r.img=e.imgs),r.end_time=r.end_time/1e3,t.next=8,e.$api.operate.messageAdd(r);case 8:e.dialogVisible=!1,e.getData(),t.next=15;break;case 12:throw t.prev=12,t.t0=t.catch(1),new Error(t.t0);case 15:case"end":return t.stop()}},t,e,[[1,12]])}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,e)}))()}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"insite"},[a("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.operate.message.add],expression:"[$api.operate.message.add]"}],attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("发布消息")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",border:"none",borderBottom:"1px solid #e8e8e8"}}},[a("el-table-column",{attrs:{width:"60",align:"center",prop:"id",label:"编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"title",label:"消息标题"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"category",label:"消息分类"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.categoryFomat(t.row.category)))]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"type",label:"消息类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.typeFomat(t.row.type)))]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"发布时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("validDateTime")(t.row.created_at)))]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"from_user",label:"发布人员"}}),e._v(" "),a("el-table-column",{attrs:{width:"200px",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.lookDetails(t.row)}}},[e._v("查看")])]}}])})],1),e._v(" "),a("Pagination",{attrs:{current:e.current,pageSize:e.pageSize,count:e.count},on:{pageChangeCBK:e.handlePageChange,sizeChangeCBK:e.handleSizeChange}}),e._v(" "),a("el-dialog",{attrs:{top:"4vh",title:"发送站内信",visible:e.dialogVisible,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px","label-position":"right"}},[a("el-form-item",{attrs:{label:"消息类型：",rules:[e.simpleRule],prop:"type"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.types,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),4!=e.form.type?a("el-form-item",{attrs:{label:"接收者：",rules:[e.simpleRule],prop:"to_id"}},[a("el-select",{attrs:{"collapse-tags":"",multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"关键词搜索","remote-method":e.querySearchAsync,loading:e.searchLoading},model:{value:e.form.to_id,callback:function(t){e.$set(e.form,"to_id",t)},expression:"form.to_id"}},e._l(e.filterData,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("p",{staticClass:"tips"},[e._v("请选择消息类型后，此处搜索关键字查询对应用户")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"消息分类：",rules:[e.simpleRule],prop:"category"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.categories,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),3===e.form.category?a("div",[a("el-form-item",{attrs:{label:"活动链接：",rules:[e.simpleRule],prop:"url"}},[a("el-input",{staticStyle:{width:"214px"},model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"活动图片：",rules:[e.simpleRule]}},[a("FileUpload",{attrs:{isOnly:!0},on:{successUploadCBK:e.getsuccessUpload}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间：",rules:[e.simpleRule],prop:"end_time"}},[a("el-date-picker",{attrs:{"value-format":"timestamp",size:"mini",type:"datetime"},model:{value:e.form.end_time,callback:function(t){e.$set(e.form,"end_time",t)},expression:"form.end_time"}})],1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"消息标题：",rules:[e.simpleRule],prop:"title"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{autocomplete:"off"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"消息内容：",rules:[e.simpleRule],prop:"content"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{type:"textarea",autocomplete:"off"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.messageAdd}},[e._v("发 布")])],1)],1),e._v(" "),a("RightSidePopup",{attrs:{visible:e.rghtPopupVisible,width:"40%"},on:{"update:visible":function(t){e.rghtPopupVisible=t}}},[a("div",{staticClass:"insite-details"},[a("h3",[e._v("站内信详情")]),e._v(" "),a("el-form",{staticClass:"form",attrs:{"label-width":"100px",size:"mini"}},[a("el-form-item",{attrs:{label:"消息标题:",prop:"title"}},[e._v(e._s(e.detailData.title))]),e._v(" "),a("el-form-item",{attrs:{label:"消息分类:",prop:"title"}},[e._v(e._s(e.categoryFomat(e.detailData.category)))]),e._v(" "),a("el-form-item",{attrs:{label:"消息类型:",prop:"title"}},[e._v(e._s(e.typeFomat(e.detailData.type)))]),e._v(" "),3===e.detailData.category?a("div",[a("el-form-item",{attrs:{label:"活动链接:",prop:"title"}},[a("a",{attrs:{href:e.detailData.url,target:"_blank"}},[e._v(e._s(e.detailData.url))])]),e._v(" "),a("el-form-item",{attrs:{label:"活动图片:",prop:"title"}},[a("img",{staticStyle:{width:"80px",height:"80px"},attrs:{src:e.detailData.img}})]),e._v(" "),a("el-form-item",{attrs:{label:"结束时间:",prop:"title"}},[e._v(e._s(e._f("validDateTime")(e.detailData.end_time)))])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"消息内容:",prop:"title"}},[a("div",{domProps:{innerHTML:e._s(e.detailData.content)}})])],1)],1)])],1)},staticRenderFns:[]};var f=a("C7Lr")(p,m,!1,function(e){a("6SUa")},null,null);t.default=f.exports}});