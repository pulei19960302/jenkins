webpackJsonp([73],{"6q4G":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("lC5x"),s=a.n(n),r=a("3cXf"),i=a.n(r),l=a("4YfN"),o=a.n(l),c=a("J0Oq"),u=a.n(c),p={mixins:[a("8Rg7").a],data:function(){return{simpleRule:{required:!0,message:"必填项",trigger:"change"},rightPopupVisible:!1,formData:{coupon_num:""},selectUsers:[],searchOPtions:[{type:"input",key:"keywords",placeholder:"用户ID"},{type:"select",key:"level",title:"用户类型",show:!1,placeholder:"用户类型",options:[{label:"粉丝",value:1},{label:"店主",value:30},{label:"优秀店主",value:52}]}]}},watch:{selectUsers:function(e){var t=this;this.tableData.forEach(function(e){var a=t.selectUsers.map(function(e){return e.id});t.noChange=!0,a.includes(e.id)?t.$refs.multipleTable.toggleRowSelection(e,!0):t.$refs.multipleTable.toggleRowSelection(e,!1),t.noChange=!1})},$route:function(){this.$refreshTab()}},created:function(){this.getData()},methods:{handleSelectionChange:function(e){if(!this.noChange){var t=this.findLinkId(),a=t.linked,n=t.noLink;a=e.map(function(e){return{id:e.id,username:e.username}}),console.log(a),this.selectUsers=n.concat(a)}},delUser:function(e){this.selectUsers.splice(e,1)},findLinkId:function(){var e=this.tableData.map(function(e){return e.id}),t=[],a=[];return this.selectUsers.forEach(function(n){e.includes(n.id)?t.push({id:n.id,username:n.username}):a.push({id:n.id,username:n.username})}),{linked:t,noLink:a}},getData:function(){var e=this;return u()(s.a.mark(function t(){var a,n,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,e.$api.user.getUserManageList(o()({},e.query,{pageSize:20,page:e.current}));case 4:a=t.sent,n=a.data,r=JSON.parse(i()(e.selectUsers)),e.tableData=n.items,n.count&&(e.count=n.count),e.$nextTick(function(){e.selectUsers=r}),e.loading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),e.loading=!1;case 16:case"end":return t.stop()}},t,e,[[0,13]])}))()},submit:function(){var e=this;0!==this.selectUsers.length?+this.formData.coupon_num<=0?this.$message({message:"未填写数量",type:"error"}):this.$api.activity.couponSend({coupon_id:this.$route.params.coupon_id,coupon_num:this.formData.coupon_num,member_ids:this.selectUsers.map(function(e){return e.id}).join(",")}).then(function(){e.$router.back(-1)}):this.$message({message:"未选择用户",type:"error"})}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sendEnvelope-container"},[a("div",{staticClass:"title"},[e._v(e._s(e.$route.params.coupon_name))]),e._v(" "),a("el-row",{staticStyle:{height:"calc(100% - 40px)"},attrs:{gutter:20}},[a("el-col",{staticClass:"left",attrs:{span:8}},[a("div",{staticClass:"form-container"},[a("el-form",{ref:"sendEnvelopeForm",staticStyle:{height:"100%"},attrs:{model:e.formData,"label-width":"150px",size:"mini"}},[a("el-form-item",{attrs:{prop:"number",rules:[e.simpleRule],label:"每个用户发放数量"}},[a("el-input",{staticStyle:{"max-width":"180px"},attrs:{type:"number"},model:{value:e.formData.coupon_num,callback:function(t){e.$set(e.formData,"coupon_num",t)},expression:"formData.coupon_num"}})],1),e._v(" "),a("p",{staticStyle:{color:"#222222","font-weight":"400"}},[e._v("请勾选右侧列表选择用户：")]),e._v(" "),a("div",{staticClass:"tag-container"},e._l(e.selectUsers,function(t,n){return a("el-tag",{key:t.key,staticStyle:{margin:"4px"},attrs:{closable:""},on:{close:function(t){return e.delUser(n)}}},[e._v(e._s(t.username))])}),1),e._v(" "),a("el-button",{staticClass:"form-submit",attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v("立即发放")])],1)],1)]),e._v(" "),a("el-col",{staticClass:"right",staticStyle:{"padding-right":"20px"},attrs:{span:16}},[a("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{height:"calc(100% - 104px)","element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",border:"none",borderBottom:"1px solid #e8e8e8"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{fixed:"",width:"50",align:"center",type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"90",prop:"id",label:"用户ID"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"140",prop:"username",label:"账户"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"store_name",label:"所属店主"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"140",prop:"typeName",label:"用户类型"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"180",prop:"created_at",label:"注册时间"}})],1),e._v(" "),a("el-pagination",{attrs:{"current-pag":e.current,"page-size":e.pageSize,total:e.count,"page-sizes":[20,30,50]},on:{"current-change":e.handlePageChange,"size-change":e.handleSizeChange}})],1)],1)],1)},staticRenderFns:[]};var h=a("C7Lr")(p,d,!1,function(e){a("9IdG")},"data-v-00c45f80",null);t.default=h.exports},"9IdG":function(e,t){}});