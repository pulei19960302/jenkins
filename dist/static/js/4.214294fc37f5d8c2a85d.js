webpackJsonp([4],{"8ART":function(e,t){},AbuJ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("aA9S"),l=a.n(r),s=a("lC5x"),o=a.n(s),i=a("J0Oq"),n=a.n(i),c=a("4YfN"),m=a.n(c),u=a("IHPB"),d=a.n(u),p=a("48sp"),f=a("czH5"),_={name:"AddCoupon",props:["id"],data:function(){this.$route.params.id;return{visible:!1,previewImg:"",simpleRule:{required:!0,message:"必填项",trigger:"change"},types:[].concat(d()(f.a.COUPON_TYPES)),goods:[],brands:[],suppliers:[],current:1,pageSize:10,count:0,tableData:[],form:{name:"",num:"",money:"",user_num:"",max:"",is_overlay:0,goods_ids:[],member_type:["1"],start_at:"",end_at:"",ding_at:"",ding_at_end:"",description:""},rules:{},lessMoney:0,users:[{value:"1",label:"普通用户"},{value:"2",label:"会员"},{value:"3",label:"白银"},{value:"5",label:"合伙人"}],addProduct:0}},computed:m()({},Object(p.e)("product",["allGoods","allCategories"])),watch:{"form.goods_ids":function(e){e&&e.length>0?this.tableData=this.goods.filter(function(t){return e.includes(t.id)}):this.tableData=[]},lessMoney:function(){0==this.lessMoney&&(this.form.max="")},"form.max":function(e){""!=e&&(this.lessMoney=1)},id:function(e){e?(this.id=e,this.couponDetail(this.id)):(console.log(111),this.$refs.form.resetFields())}},mounted:function(){this.goods=this.allGoods,this.getBrands(),this.getSuppliers()},methods:{getBrands:function(){var e=this;return n()(o.a.mark(function t(){var a,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.product.brandList();case 3:a=t.sent,r=a.data,e.brands=r.items,t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}},t,e,[[0,8]])}))()},getSuppliers:function(){var e=this;return n()(o.a.mark(function t(){var a,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.product.supplierList();case 3:a=t.sent,r=a.data,e.suppliers=r.items,t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}},t,e,[[0,8]])}))()},couponDetail:function(e){var t=this;return n()(o.a.mark(function a(){var r,l;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$api.activity.couponDetail({id:e});case 3:r=a.sent,l=r.data,t.form=l,t.form.ding_at=1e3*l.ding_at,t.form.ding_at_end=1e3*l.ding_at_end,t.form.end_at=1e3*l.end_at,t.form.start_at=1e3*l.start_at,t.form.cat_id=String(l.cat_id),t.form.goods_ids=l.goods_ids?l.goods_ids.split(",").map(function(e){return Number(e)}):[],""!=l.goods_ids&&(t.addProduct=1),a.next=18;break;case 15:throw a.prev=15,a.t0=a.catch(0),new Error(a.t0);case 18:case"end":return a.stop()}},a,t,[[0,15]])}))()},handlePreview:function(e){e&&(this.imgSrc=e,this.visible=!0)},imgSuccessUploadCBK:function(e,t){this[t]=[].concat(d()(e))},handleDel:function(e){this.form.goods_ids=this.form.goods_ids.filter(function(t){return t!=e})},handelSubmit:function(e){var t,a=this;this.$refs[e].validate((t=n()(o.a.mark(function e(t){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=26;break}if(e.prev=1,(r=l()({},a.form)).goods_ids=r.goods_ids.join(","),r.ding_at=r.ding_at/1e3,r.ding_at_end=r.ding_at_end/1e3,r.end_at=r.end_at/1e3,r.start_at=r.start_at/1e3,r.member_type=r.member_type.join(","),0==a.lessMoney&&(r.max=0),!a.id){e.next=16;break}return r.id=a.id,e.next=14,a.$api.activity.couponEdit(r);case 14:e.next=18;break;case 16:return e.next=18,a.$api.activity.couponAdd(r);case 18:a.$emit("refresh"),e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(1),new Error(e.t0);case 24:e.next=27;break;case 26:a.$message.error("请确认信息是否填写完整");case 27:case"end":return e.stop()}},e,a,[[1,21]])})),function(e){return t.apply(this,arguments)}))}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"moreRules-content"},[a("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"label-width":"140px",size:"mini"}},[a("div",{staticClass:"col-one"},[a("el-form-item",{attrs:{label:"优惠券名称:",prop:"name",rules:[e.simpleRule]}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"总发行量:",prop:"num",rules:[e.simpleRule]}},[a("el-input",{attrs:{type:"number",placeholder:"只能输入正整数，最小为1"},model:{value:e.form.num,callback:function(t){e.$set(e.form,"num",t)},expression:"form.num"}},[a("template",{slot:"append"},[e._v("张")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"面额:",prop:"money",rules:[e.simpleRule]}},[a("el-input",{attrs:{type:"number",placeholder:"只能在0.01-10000之间"},model:{value:e.form.money,callback:function(t){e.$set(e.form,"money",t)},expression:"form.money"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"限制数量:",prop:"user_num",rules:[e.simpleRule]}},[a("el-input",{attrs:{type:"number",maxlength:"2",placeholder:"只能输入正整数，最小为1"},model:{value:e.form.user_num,callback:function(t){e.$set(e.form,"user_num",t)},expression:"form.user_num"}},[a("template",{slot:"append"},[e._v("张")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"满金额:"}},[a("el-radio-group",{model:{value:e.lessMoney,callback:function(t){e.lessMoney=t},expression:"lessMoney"}},[a("el-radio",{attrs:{label:0}},[e._v("无限制")]),e._v(" "),a("el-radio",{attrs:{label:1}},[e._v("满\n                        "),a("el-input",{staticStyle:{width:"162px"},attrs:{type:"number"},model:{value:e.form.max,callback:function(t){e.$set(e.form,"max",t)},expression:"form.max"}},[a("template",{slot:"append"},[e._v("可用")])],2)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否叠加:",prop:"is_overlay"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.is_overlay,callback:function(t){e.$set(e.form,"is_overlay",t)},expression:"form.is_overlay"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"领取开始时间:",prop:"start_at",rules:[e.simpleRule]}},[a("el-date-picker",{attrs:{"value-format":"timestamp",size:"mini",type:"datetime",placeholder:""},model:{value:e.form.start_at,callback:function(t){e.$set(e.form,"start_at",t)},expression:"form.start_at"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"领取结束时间:",prop:"end_at",rules:[e.simpleRule]}},[a("el-date-picker",{attrs:{"value-format":"timestamp",size:"mini",type:"datetime",placeholder:""},model:{value:e.form.end_at,callback:function(t){e.$set(e.form,"end_at",t)},expression:"form.end_at"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券开始时间:",prop:"ding_at",rules:[e.simpleRule]}},[a("el-date-picker",{attrs:{"value-format":"timestamp",size:"mini",type:"datetime",placeholder:""},model:{value:e.form.ding_at,callback:function(t){e.$set(e.form,"ding_at",t)},expression:"form.ding_at"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券结束时间:",prop:"ding_at_end",rules:[e.simpleRule]}},[a("el-date-picker",{attrs:{"value-format":"timestamp",size:"mini",type:"datetime",placeholder:""},model:{value:e.form.ding_at_end,callback:function(t){e.$set(e.form,"ding_at_end",t)},expression:"form.ding_at_end"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"参与用户:",prop:"member_type",rules:[e.simpleRule]}},[a("el-checkbox-group",{attrs:{min:1},model:{value:e.form.member_type,callback:function(t){e.$set(e.form,"member_type",t)},expression:"form.member_type"}},e._l(e.users,function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券描述:",prop:"description",rules:[e.simpleRule]}},[a("el-input",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"可使用商品:"}},[a("el-radio-group",{model:{value:e.addProduct,callback:function(t){e.addProduct=t},expression:"addProduct"}},[a("el-radio",{attrs:{label:0}},[e._v("全场通用")]),e._v(" "),a("el-radio",{attrs:{label:1}},[e._v("指定商品")])],1)],1),e._v(" "),1==e.addProduct?a("div",{staticClass:"card"},[a("div",{staticClass:"right"},[a("el-form-item",{attrs:{label:"添加商品:",prop:"goods_ids"}},[a("el-select",{staticStyle:{width:"620px"},attrs:{placeholder:"请选择商品",multiple:"","collapse-tags":"",filterable:"",clearable:""},model:{value:e.form.goods_ids,callback:function(t){e.$set(e.form,"goods_ids",t)},expression:"form.goods_ids"}},e._l(e.goods,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1),e._v(" "),a("p",{staticClass:"mt20 tips"},[e._v("已关联 "),a("b",{staticStyle:{color:"#000"}},[e._v(e._s(e.form.goods_ids.length))]),e._v(" 件商品")]),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"max-height":"400",size:"mini",border:"",data:e.tableData,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{width:"100",align:"center",prop:"id",label:"商品编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",prop:"title",label:"商品名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{staticClass:"table-img",attrs:{src:t.row.thumb},on:{click:function(a){e.previewImg=t.row.thumb,e.visible=!0}}})]}}],null,!1,114475066)}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"shop_price",label:"售价（元）"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"cost_price",label:"成本价（元）"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{staticStyle:{color:"red",cursor:"pointer"},on:{click:function(a){return e.handleDel(t.row.id)}}},[e._v("删除")])]}}],null,!1,1612352432)})],1)],1)],1)]):e._e()],1),e._v(" "),a("div",{staticClass:"complete"},[a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handelSubmit("form")}}},[e._v("提 交")])],1),e._v(" "),a("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}})],1)},staticRenderFns:[]};var b=a("C7Lr")(_,v,!1,function(e){a("8ART")},"data-v-cfd78032",null);t.default=b.exports}});