webpackJsonp([67],{R86G:function(e,t){},VNpJ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("lC5x"),i=n.n(a),r=n("J0Oq"),o=n.n(r),l=n("4YfN"),s=n.n(l),c=n("48sp"),u=[{value:"category",name:"商品分类"},{value:"detail",name:"商品详情"},{value:"order",name:"我的订单"},{value:"richText",name:"富文本(新人导航)"},{value:"coupon",name:"优惠券"},{value:"webview",name:"外链"},{value:"none",name:"不跳转"}],p="/pages/productDetail/productDetail?id=",d="/pages/active/active?id=",m={name:"bannerList",props:{},components:{},data:function(){return{pageOptions:[{value:"del",label:"批量删除"}],pages:u,loading:!1,visible:!1,previewImg:"",dialogVisible:!1,rules:{goto_url:[{required:!1,message:"请输入",trigger:"change"}],banner:[{required:!0,message:"请输入",trigger:"change"}],sort:[{required:!0,message:"请输入",trigger:"change"}]},isSwitch:!0,searchOPtions:[{type:"input",key:"description",placeholder:"描述"},{type:"select",key:"status",placeholder:"状态",options:[{label:"启用",value:10},{label:"禁用",value:0}]}],query:{},current:1,pageSize:10,count:0,tableData:[],type:"",typeName:"",editId:"",columnSelect:[],banner:[],form:{goto_url_prefix:"",goto_url:"",sort:1,description:"",id:"",type:"",param:"",status:!0,main_color:""},jumpOptions:[{value:p,label:"商品详情页"},{value:d,label:"活动页"},{value:"",label:"自定义"}]}},computed:s()({},Object(c.e)("user",["button_permissions"])),watch:{},created:function(){this.getData(),this.button_permissions.includes(this.$api.setting.banner.del)||(this.pageOptions=[])},mounted:function(){},methods:{gotoUrlPlaceholder:function(e){switch(e){case p:return"请填写商品ID";case d:return"请填写活动ID";case"":return"请填写完整的网页地址"}},handelSearch:function(e,t){var n=this;({search:function(){n.query=s()({},t),n.current=1,n.getData()},reset:function(){n.query={},n.pageSize=10,n.current=1,n.getData()}})[e]()},getData:function(){var e=this;return o()(i.a.mark(function t(){var n,a,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,e.$api.setting.bannerList(s()({},e.query,{pageSize:e.pageSize,page:e.current}));case 4:for(n=t.sent,a=n.data,r=0;r<a.items.length;r++)a.items[r].status=0!=a.items[r].status;e.tableData=a.items,e.count=a.count,e.loading=!1,t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),e.loading=!1;case 15:case"end":return t.stop()}},t,e,[[0,12]])}))()},handlePageChange:function(e){this.current=e,this.getData()},handleSizeChange:function(e){this.pageSize=e,this.getData()},jumpTo:function(e,t,n){this.$router.push({name:e,params:{type:t,id:n}})},handleSelectionChange:function(e){var t=[];e.length<1?this.columnSelect=[]:(e.map(function(e){t.push(e.id)}),this.columnSelect=t)},add:function(){this.$refs.form&&this.$refs.form.resetFields(),this.dialogVisible=!0,this.banner=[],this.type="add",delete this.form.id},edit:function(e){var t=this;this.type="edit",this.dialogVisible=!0,this.$nextTick(function(){e.goto_url&&"undefined"!==e.goto_url?e.goto_url.includes(p)?(t.form.goto_url=e.goto_url?e.goto_url.replace(p,""):"",t.form.goto_url_prefix=p):e.goto_url.includes(d)?(t.form.goto_url=e.goto_url?e.goto_url.replace(d,""):"",t.form.goto_url_prefix=d):(t.form.goto_url=e.goto_url||"",t.form.goto_url_prefix=""):t.form.goto_url="",t.form.type=e.type,t.form.param=e.param,t.form.sort=e.sort,t.form.description=e.description,t.form.id=e.id,t.form.main_color=e.main_color,t.banner=[{name:e.banner,url:e.banner}]})},submit:function(){var e=this,t=this;this.$refs.form.validate(function(n){if(n){var a=s()({},e.form);if(a.status=1==a.status?10:0,a.banner=e.banner[0].url,a.goto_url=""+a.goto_url_prefix+a.goto_url,delete a.goto_url_prefix,!a.banner)return;"add"==e.type?e.$api.setting.bannerAdd(a).then(function(){t.refresh()}):e.$api.setting.bannerEdit(a).then(function(){t.refresh()})}})},refresh:function(){this.dialogVisible=!1,this.banner=[],this.form.goto_url="",this.form.sort=1,this.form.description="",this.form.status=!0,this.$refs.form.resetFields(),this.form.type="",this.form.param="",this.getData()},handleDel:function(e){var t=this;this.$confirm("确认删除选中banner图？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.del(e)}).catch(function(){})},del:function(e){var t=this;if("many"==e){if(this.columnSelect.length<1)return void this.$message({message:"请至少选择一条申请",type:"error"});this.$api.setting.bannerDel({ids:this.columnSelect.join(",")}).then(function(){t.getData()})}else this.$api.setting.bannerDel({ids:e}).then(function(){t.getData()})},showEdit:function(e){var t=s()({},e);t.status=1==t.status?10:0,this.$api.setting.bannerEdit(t)},getsuccessUploadthumb:function(e){this.banner=[{name:"banner",url:e[0]}]}}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"remove-product"},[n("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.setting.banner.add],expression:"[$api.setting.banner.add]"}],attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.add}},[e._v("添 加")])],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",border:"none",borderBottom:"1px solid #e8e8e8"}},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{fixed:"",type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"id",label:"编号",width:"60"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"banner",label:"图片地址"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"图片预览"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("img",{staticClass:"photo",staticStyle:{width:"40px",height:"40px"},attrs:{src:t.row.banner},on:{click:function(n){e.previewImg=t.row.banner,e.visible=!0}}})]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"goto_url",label:"跳转地址"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"图片主色"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("el-color-picker",{attrs:{disabled:"",value:e.row.main_color}})]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"description",label:"描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("validVal")(t.row.description))+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"sort",label:"排序",width:"100"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"是否启用"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{on:{change:function(n){return e.showEdit(t.row)}},model:{value:t.row.status,callback:function(n){e.$set(t.row,"status",n)},expression:"scope.row.status"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{width:"180",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.setting.banner.edit],expression:"[$api.setting.banner.edit]"}],attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.edit(t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.setting.banner.del],expression:"[$api.setting.banner.del]"}],attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.handleDel(t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),n("Pagination",{attrs:{options:e.pageOptions,current:e.current,count:e.count,pageSize:e.pageSize},on:{opreateCBK:function(t){return e.handleDel("many")},pageChangeCBK:e.handlePageChange,sizeChangeCBK:e.handleSizeChange}},[e._v('"\n    ')]),e._v(" "),n("el-dialog",{attrs:{title:"添加类型",visible:e.dialogVisible,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px","label-position":"right"}},[n("el-form-item",{attrs:{label:"图片上传"}},[n("FileUpload",{attrs:{isOnly:!0,fileList:e.banner},on:{successUploadCBK:e.getsuccessUploadthumb}})],1),e._v(" "),n("el-form-item",{attrs:{label:"图片主色"}},[n("el-color-picker",{model:{value:e.form.main_color,callback:function(t){e.$set(e.form,"main_color",t)},expression:"form.main_color"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"跳转页面："}},e._l(e.pages,function(t){return n("el-radio",{key:t.value,attrs:{label:t.value},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[e._v(e._s(t.name))])}),1),e._v(" "),n("el-form-item",{attrs:{label:"参数"}},[n("el-input",{attrs:{type:"textarea",autosize:""},model:{value:e.form.param,callback:function(t){e.$set(e.form,"param",t)},expression:"form.param"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"排序：",prop:"sort"}},[n("el-input",{staticStyle:{width:"70%"},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"描述："}},[n("el-input",{staticStyle:{width:"70%"},attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"状态："}},[n("el-switch",{attrs:{disabled:!e.button_permissions.includes(e.$api.setting.banner.edit)},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("\n                确定\n            ")])],1)],1),e._v(" "),n("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}})],1)},staticRenderFns:[]};var g=n("C7Lr")(m,f,!1,function(e){n("R86G")},"data-v-232f6be1",null);t.default=g.exports}});