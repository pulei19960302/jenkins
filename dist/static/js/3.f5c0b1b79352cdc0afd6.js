webpackJsonp([3],{"1UNQ":function(e,t){},CzuA:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("aA9S"),a=i.n(n),r=i("lC5x"),l=i.n(r),c=i("J0Oq"),s=i.n(c),o=i("IHPB"),u=i.n(o),d=i("3cXf"),p=i.n(d),f=i("rVsN"),h=i.n(f),m=i("ZLEe"),v=i.n(m),b={name:"CityPopover",props:{cityData:{type:Array},cityCheckedDefault:{type:Array}},components:{},data:function(){return{cityChecked:[]}},computed:{},watch:{cityCheckedDefault:function(e){console.log(e,"cityCheckedDefault")}},created:function(){},mounted:function(){},methods:{handleChange:function(e){this.$emit("changeCBK",e)},handleCancel:function(){this.$emit("update:activeId",null)}}},y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"CityPopover"},[i("el-checkbox-group",{on:{change:e.handleChange},model:{value:e.cityChecked,callback:function(t){e.cityChecked=t},expression:"cityChecked"}},e._l(e.cityData,function(t){return i("el-checkbox",{key:t.id,staticClass:"province",attrs:{label:t}},[e._v("\n            "+e._s(t.name)+"\n        ")])}),1),e._v(" "),i("el-button",{staticStyle:{float:"right","margin-top":"10px"},attrs:{type:"text",size:"mini"},on:{click:e.handleCancel}},[e._v("关闭")])],1)},staticRenderFns:[]};var k=i("C7Lr")(b,y,!1,function(e){i("irbn")},null,null).exports,_={name:"el-tree-select",props:{props:{type:Object,default:function(){return{value:"id",label:"title",children:"children"}}},options:{type:Array,default:function(){return[]}},value:{type:Number,default:function(){return null}},accordion:{type:Boolean,default:function(){return!1}},isFilter:{type:Boolean,default:!1}},data:function(){return{filterText:"",valueId:this.value.map(function(e){return e.id}),valueTitle:[],defaultCheckedKey:[]}},mounted:function(){this.initHandle()},methods:{initHandle:function(){this.valueId&&(this.valueTitle=this.getTitle(this.valueId),console.log(this.valueId),this.$refs.selectTree.setCurrentKey(this.valueId),this.defaultCheckedKey=this.valueId),this.$nextTick(function(){var e=document.querySelectorAll(".el-scrollbar .el-select-dropdown__wrap")[0],t=document.querySelectorAll(".el-scrollbar .el-scrollbar__bar");e.style.cssText="margin: 0px; max-height: none; overflow: hidden;",t.forEach(function(e){return e.style.width=0})})},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},onCheck:function(e,t){var i,n=this.options,a=t.checkedKeys,r=[].concat(u()(a));!function e(t){var i=!1;return t.forEach(function(t,n){t.id&&-1===a.indexOf(t.id)&&(i=!0);var l=-1!==a.indexOf(t.id)&&t.id;if(t.items&&t.items.length){var c=e(t.items);l?c||t.items.forEach(function(e){r.splice(r.indexOf(e.id),1)}):i=c}}),i}(n),i=this.getTitle(r);for(var l=r.length-1;l>=0;l--)r[l]||r.splice(l,1);this.valueTitle=i,this.defaultCheckedKey=a,this.valueId=r,this.$emit("getValue",r)},getTitle:function(e){var t=[];return function i(n){n.forEach(function(n,a){-1!==e.indexOf(n.id)&&n.id?t.push(n.name):n.items&&n.items.length&&i(n.items)})}(this.options),t},getId:function(e){var t=[];return function i(n){n.forEach(function(n,a){-1!==e.indexOf(n.name)&&n.name?t.push(n.id):n.items&&n.items.length&&i(n.items)})}(this.options),t},clearHandle:function(){this.valueTitle=[],this.valueId=[],this.defaultCheckedKey=[],this.$refs.selectTree.setCheckedKeys([]),this.clearSelected(),this.$emit("getValue",null)},clearSelected:function(){document.querySelectorAll("#tree-option .el-tree-node").forEach(function(e){return e.classList.remove("is-current")})},onSelectChange:function(e){this.valueTitle=e;var t=this.getId(e);this.valueId=t,this.defaultCheckedKey=t,this.clearSelected(),this.$refs.selectTree.setCheckedKeys(t),this.$emit("getValue",t)}},watch:{value:function(){this.valueId=this.value.map(function(e){return e.id}),this.initHandle()},filterText:function(e){this.$refs.selectTree.filter(e)}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-select",{staticStyle:{width:"100%"},attrs:{size:"medium",value:e.valueTitle,clearable:!1,multiple:""},on:{clear:e.clearHandle,change:e.onSelectChange}},[e.isFilter?i("el-input",{staticStyle:{padding:"5px 10px"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}):e._e(),e._v(" "),i("el-option",{attrs:{value:e.valueTitle,label:e.valueTitle}},[i("el-tree",{ref:"selectTree",attrs:{id:"tree-option",accordion:e.accordion,"node-key":"id","show-checkbox":"",data:e.options,props:e.props,filterNodeMethod:e.filterNode,"current-node-key":e.defaultCheckedKey,"default-checked-keys":e.defaultCheckedKey,"expand-on-click-node":!1},on:{check:e.onCheck}})],1)],1)},staticRenderFns:[]};var C=i("C7Lr")(_,g,!1,function(e){i("1UNQ")},"data-v-484f13d7",null).exports,x=0,w={name:"AdressSet",props:{priceType:{type:[String,Number]},type:{type:[String,Number]},detailData:{type:Array,default:function(){return[]}}},components:{CityPopover:k,TreeSelect:C},data:function(){return{isIndeterminate:!1,first_num:"",first_price:"",follow_num:"",follow_price:"",activeId:null,options:[],dialogVisible:!1,addressId:null,cityPid:null,provinceData:[],provinceChecked:[],areaChecked:[],cityData:[],cityChecked:[],tableData:[],areaData:[],realCities:[]}},computed:{realProvinceCheckIds:function(){var e=[];return this.tableData.map(function(t){t.area_ids&&t.area_ids.map(function(t){e.push(t.id)})}),e},provinceCheckIds:function(){return this.provinceChecked.map(function(e){return e.id})}},watch:{areaChecked:function(e,t){if(e){var i=[];return e.map(function(e){i=i.concat(e.items)}),this.provinceChecked=i,void(this.isIndeterminate=!1)}this.provinceChecked=[]},provinceChecked:function(e,t){if(e){var i=[];return e.map(function(e){i=i.concat(e.items)}),void(this.cityChecked=i)}this.cityChecked=[]}},mounted:function(){var e=this;this.addressId=1,this.tableData=[],this.getData().then(function(t){if(e.detailData.length>0){var i=[];e.detailData.map(function(e){e.area_ids=e.areas,e.areas.map(function(e){i.push(e.id)})}),e.tableData=e.detailData}})},methods:{getValue:function(e,t){this.tableData[t].area_id=e},handleEdit:function(e){this.realCities=[],this.addressId=e.id;var t=[],i=[],n={},a=[],r=void 0;e.area_ids.forEach(function(e){t.push(e?e.id:""),e.pid&&"0"!==e.pid&&(r=e.pid,a.push(e.id))}),v()(n).includes(r)||r&&(n[r]=[].concat(a)),this.areaData.map(function(e){e.items.map(function(e){t.includes(e.id)&&i.push(e)})}),this.provinceChecked=[].concat(i),e.area_ids[0]&&e.area_ids[0].id||(this.areaChecked=[]),this.dialogVisible=!0},handleCheckedCitiesChange:function(e,t){var i=e.map(function(e){if(e)return e.id});if(!t.items.every(function(e){return i.includes(e.id)})){var n=e.filter(function(e){if(e)return e.pid===t.id});this.realCities=this.realCities.concat(n)}},transFormName:function(e){return 1==e?"件数(件)":2==e?"重量(g)":3==e?"体积(m³)":void 0},handelDel:function(e){this.tableData=this.tableData.filter(function(t){return t.id!==e})},batchUse:function(e){var t=this;this.tableData.forEach(function(i){t.$set(i,e,t[e])})},handleAdd:function(){x++,this.tableData.push({area_ids:[{name:"未添加地区"}],first_num:"",first_price:"",follow_num:"",follow_price:"",id:""+x,type:this.type})},reset:function(){this.provinceChecked=[],this.cityChecked=[],this.cityPid=null},handleClick:function(e){this.activeId=e,this.cityData=[]},getData:function(){var e=this;return s()(l.a.mark(function t(){var i,n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.common.getAllCity();case 3:return i=t.sent,n=i.data,e.areaData=n,t.abrupt("return",h.a.resolve(n));case 9:throw t.prev=9,t.t0=t.catch(0),new Error(t.t0);case 12:case"end":return t.stop()}},t,e,[[0,9]])}))()},add:function(){var e=this,t=[];t=this.realCities.length>0?this.provinceChecked.filter(function(t){return t.id!==e.realCities[0].pid}):this.provinceChecked;var i=[].concat(u()(t),u()(this.realCities));this.tableData.forEach(function(t){e.addressId===t.id&&(t.area_ids=i)}),this.dialogVisible=!1},handlecallBack:function(){var e=JSON.parse(p()(this.tableData));e.forEach(function(e){e.areas&&delete e.areas}),this.$emit("successCBK",e,this.type)},changeCBK:function(e){var t=this;this.cityChecked=e,this.cityChecked.length>0?this.cityChecked.map(function(e){t.cityPid=e.pid}):this.cityPid=null}}},S={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"temp"},[i("div",{staticClass:"item"},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"tooltip-effect":"dark"}},[i("el-table-column",{attrs:{"min-width":"500",align:"center",prop:"color",label:"运送到"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between",width:"100%"}},[i("div",{staticStyle:{width:"100%"}},[i("tree-select",{attrs:{options:e.areaData,value:t.row.area_ids,props:{children:"items",label:"name",value:"id"},accordion:!0},on:{getValue:function(i){return e.getValue(i,t.$index)}}})],1)])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",prop:"money",width:"220px",label:"首体积(m³)"},scopedSlots:e._u([{key:"header",fn:function(t){return[i("div",{staticClass:"flex-center"},[i("span",[e._v("首"+e._s(e.transFormName(e.priceType)))]),e._v(" "),i("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:""},model:{value:e.first_num,callback:function(t){e.first_num=t},expression:"first_num"}}),e._v(" "),i("i",{staticClass:"el-icon-sort-down",on:{click:function(t){return e.batchUse("first_num")}}})],1)]}},{key:"default",fn:function(t){return[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:t.row.first_num,callback:function(i){e.$set(t.row,"first_num",i)},expression:"scope.row.first_num"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",prop:"money",width:"220px",label:"首费(元)"},scopedSlots:e._u([{key:"header",fn:function(t){return[i("div",{staticClass:"flex-center"},[i("span",[e._v("首费(元)")]),e._v(" "),i("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:""},model:{value:e.first_price,callback:function(t){e.first_price=t},expression:"first_price"}}),e._v(" "),i("i",{staticClass:"el-icon-sort-down",on:{click:function(t){return e.batchUse("first_price")}}})],1)]}},{key:"default",fn:function(t){return[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:t.row.first_price,callback:function(i){e.$set(t.row,"first_price",i)},expression:"scope.row.first_price"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",prop:"money",width:"220px",label:"续体积(m³)"},scopedSlots:e._u([{key:"header",fn:function(t){return[i("div",{staticClass:"flex-center"},[i("span",[e._v("续"+e._s(e.transFormName(e.priceType)))]),e._v(" "),i("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",placeholder:""},model:{value:e.follow_num,callback:function(t){e.follow_num=t},expression:"follow_num"}}),e._v(" "),i("i",{staticClass:"el-icon-sort-down",on:{click:function(t){return e.batchUse("follow_num")}}})],1)]}},{key:"default",fn:function(t){return[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:t.row.follow_num,callback:function(i){e.$set(t.row,"follow_num",i)},expression:"scope.row.follow_num"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",prop:"money",width:"220px",label:"续费(元)"},scopedSlots:e._u([{key:"header",fn:function(t){return[i("div",{staticClass:"flex-center"},[i("span",[e._v("续费(元)")]),e._v(" "),i("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:e.follow_price,callback:function(t){e.follow_price=t},expression:"follow_price"}}),e._v(" "),i("i",{staticClass:"el-icon-sort-down",on:{click:function(t){return e.batchUse("follow_price")}}})],1)]}},{key:"default",fn:function(t){return[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:t.row.follow_price,callback:function(i){e.$set(t.row,"follow_price",i)},expression:"scope.row.follow_price"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{fixed:"right",align:"center",prop:"money",width:"80px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{staticStyle:{color:"red"},attrs:{type:"text",size:"mini"},on:{click:function(i){return e.handelDel(t.row.id)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.handleAdd}},[e._v("为指定地区城市设置运费")]),e._v(" "),i("el-dialog",{attrs:{top:"4vh",title:"选择区域",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",e._l(e.areaData,function(t){return i("el-row",{key:t.id,staticStyle:{"margin-bottom":"10px"},attrs:{span:6}},[i("div",{staticClass:"erea"},[i("el-checkbox-group",{attrs:{indeterminate:e.isIndeterminate},model:{value:e.areaChecked,callback:function(t){e.areaChecked=t},expression:"areaChecked"}},[i("el-checkbox",{attrs:{label:t}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])],1)],1),e._v(" "),i("el-checkbox-group",{model:{value:e.provinceChecked,callback:function(t){e.provinceChecked=t},expression:"provinceChecked"}},e._l(t.items,function(t){return i("el-col",{key:t.id,attrs:{span:4}},[i("el-checkbox",{staticClass:"province",attrs:{label:t,indeterminate:t.id==e.cityPid,disabled:e.realProvinceCheckIds.includes(t.id)&&!e.provinceCheckIds.includes(t.id)}},[e._v("\n                            "+e._s(t.name)+"\n                            "),t.id===e.activeId?i("div",{staticClass:"cityPopover"},[i("el-checkbox-group",{on:{change:function(i){return e.handleCheckedCitiesChange(i,t)}},model:{value:e.cityChecked,callback:function(t){e.cityChecked=t},expression:"cityChecked"}},e._l(t.items,function(t){return i("el-checkbox",{key:t.id,staticClass:"province",attrs:{label:t}},[e._v("\n                                        "+e._s(t?t.name:"")+"\n                                    ")])}),1),e._v(" "),i("el-button",{staticStyle:{float:"right","margin-top":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(t){e.activeId=null}}},[e._v("关闭")])],1):e._e()]),e._v(" "),i("i",{staticClass:"el-icon-caret-bottom",staticStyle:{"font-size":"14px","margin-left":"4px",cursor:"pointer"},on:{click:function(i){return e.handleClick(t.id)}}})],1)}),1)],1)}),1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("\n                确定\n            ")])],1)])],1)},staticRenderFns:[]};var D={name:"addFreightFormwork",components:{AdressSet:i("C7Lr")(w,S,!1,function(e){i("bAUw")},null,null).exports},data:function(){var e=this.$route.params;return{type:e.type,id:e.id,detailData:[],stock:"",activeId:null,salePrice:"",costPrice:"",options:[],provinceData:[],cityData:[],provinceChecked:[],cityChecked:[],dialogVisible:!0,submit:{name:"",id:""},formLabelAlign:{transports:[]},rules:{},checked1:"",checked2:"",checked3:"",checked4:"",radio:"1",cityPid:null,supplier:[],transports:[]}},watch:{$route:function(e){var t=e.params;t.id?(this.type=t.type,this.getFreightTemplateDetail(t.id)):(this.type="add",this.detailData=[],this.resetForm("formLabelAlign"))}},created:function(){this.getSupplierData(),"edit"===this.type&&this.getFreightTemplateDetail(this.id)},methods:{resetForm:function(e){this.$refs[e].resetFields()},successCBK:function(e,t){e&&(this.transports=[].concat(u()(e)))},getSupplierData:function(){var e=this;return s()(l.a.mark(function t(){var i,n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.product.supplierList({pageSize:0});case 3:i=t.sent,n=i.data,e.supplier=n.items,t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(0),new Error(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},getFreightTemplateDetail:function(e){var t=this;return s()(l.a.mark(function i(){var n,a,r;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,t.$api.setting.getFreightTemplateDetail({id:e});case 3:n=i.sent,a=n.data,t.detailData=a.transports,t.formLabelAlign=a,r=a.transports.map(function(e){return e.type}),t.formLabelAlign.transports=[].concat(u()(r)),i.next=14;break;case 11:throw i.prev=11,i.t0=i.catch(0),new Error(i.t0);case 14:case"end":return i.stop()}},i,t,[[0,11]])}))()},checkTransportsDetail:function(){var e=!0;return this.transports.forEach(function(t){t.first_num&&t.first_price&&t.follow_num&&t.follow_price||(e=!1)}),e||this.$message.error("请把物流信息填写完整"),e},handelSubmit:function(){var e,t=this;this.$refs.formLabelAlign.validate((e=s()(l.a.mark(function e(i){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=23;break}if(t.$refs.adressSet1.handlecallBack(),n=a()({},t.formLabelAlign),t.transports.forEach(function(e){"string"==typeof e.id&&(e.id=0),void 0!==e.area_id?e.area_ids=e.area_id||[]:e.area_ids=e.area_ids.map(function(e){return e.id})}),n.transports=t.transports,n.supplier_name&&delete n.supplier_name,t.checkTransportsDetail()){e.next=8;break}return e.abrupt("return");case 8:if(e.prev=8,"edit"!==t.type){e.next=15;break}return n.id=t.id,e.next=13,t.$api.setting.editFreightTemplate(n);case 13:e.next=17;break;case 15:return e.next=17,t.$api.setting.addFreightTemplate(n);case 17:t.$router.push({name:"freightFormwork"}),e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(8),new Error(e.t0);case 23:case"end":return e.stop()}},e,t,[[8,20]])})),function(t){return e.apply(this,arguments)}))}}},A={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"platformSetting",staticStyle:{"min-height":"calc(100vh - 135px)",background:"#fff"}},[i("p",{staticClass:"title"},[e._v("添加模板")]),e._v(" "),i("el-form",{ref:"formLabelAlign",staticClass:"form",staticStyle:{"max-width":"100%"},attrs:{"label-position":"right","label-width":"100px",model:e.formLabelAlign,rules:e.rules}},[i("el-form-item",{attrs:{label:" 模板名称：",prop:"name"}},[i("el-input",{staticStyle:{width:"200px"},model:{value:e.formLabelAlign.name,callback:function(t){e.$set(e.formLabelAlign,"name",t)},expression:"formLabelAlign.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"供应商:",prop:"brand_id"}},[i("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择",filterable:"",clearable:""},model:{value:e.formLabelAlign.supplier_id,callback:function(t){e.$set(e.formLabelAlign,"supplier_id",t)},expression:"formLabelAlign.supplier_id"}},e._l(e.supplier,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"计价方式：",prop:"region"}},[[i("el-radio-group",{model:{value:e.formLabelAlign.type,callback:function(t){e.$set(e.formLabelAlign,"type",t)},expression:"formLabelAlign.type"}},[i("el-radio",{attrs:{label:1}},[e._v("按件数")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("按重量")])],1)]],2),e._v(" "),i("el-form-item",{attrs:{label:"运送方式：",prop:"region"}},[i("el-checkbox-group",{staticClass:"eliveryType",model:{value:e.formLabelAlign.transports,callback:function(t){e.$set(e.formLabelAlign,"transports",t)},expression:"formLabelAlign.transports"}},[i("div",[i("el-checkbox",{attrs:{label:1}},[e._v("快递")])],1)]),e._v(" "),e.formLabelAlign.transports.includes(1)?i("AdressSet",{ref:"adressSet1",attrs:{type:"1",priceType:e.formLabelAlign.type,detailData:e.detailData},on:{successCBK:e.successCBK}}):e._e()],1),e._v(" "),i("el-button",{staticClass:"submit",attrs:{type:"primary"},on:{click:e.handelSubmit}},[e._v("提交")])],1)],1)},staticRenderFns:[]};var T=i("C7Lr")(D,A,!1,function(e){i("aG7+")},null,null);t.default=T.exports},"aG7+":function(e,t){},bAUw:function(e,t){},irbn:function(e,t){}});