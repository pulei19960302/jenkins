webpackJsonp([22,5],{"2xW/":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("lC5x"),i=r.n(a),n=r("J0Oq"),l=r.n(n),o=r("4YfN"),s=r.n(o),c=r("48sp"),u={name:"ConfigProduct",props:{},components:{NewConfigProduct:r("ijF1").default},data:function(){return{showAdd:!1,id:void 0,exportOptions:[],visible:!1,loading:!1,previewImg:"",options:[],dialogVisible:!1,form:{title:"",content:""},rules:{title:[{required:!0,message:"请输入",trigger:"change"}],content:[{required:!0,message:"请输入",trigger:"change"}]},isSwitch:!0,searchOPtions:[{type:"input",key:"keywords",placeholder:"分类名称"},{type:"select",key:"display",label:"",placeholder:"状态",options:[{label:"启用",value:1},{label:"禁用",value:0}]}],query:{display:-1},current:1,pageSize:10,count:0,tableData:[],columnSelect:[],data:[],defaultProps:{children:"children",label:"label"}}},computed:s()({},Object(c.e)("user",["button_permissions"])),watch:{},activated:function(){this.getData(),this.getTree()},methods:{test:function(e){console.log(e)},changeDisplayStatus:function(e){var t=this,r=e.display,a=e.id;return l()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$api.product.goodSetDisplay({status:r,id:a});case 3:t.getData(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),t.tableData.map(function(e){e.id===a&&t.$set(e,"display",1==r?0:1)});case 9:case"end":return e.stop()}},e,t,[[0,6]])}))()},changeDisplayIndexStatus:function(e){var t=this,r=e.display_index,a=e.id;return l()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$api.product.goodSetDisplayIndex({status:r,id:a});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),t.tableData.map(function(e){e.id===a&&t.$set(e,"display_index",1==r?0:1)});case 8:case"end":return e.stop()}},e,t,[[0,5]])}))()},handleNodeClick:function(e){this.query.cat_id=e.id,this.current=1,this.getData()},handelSearch:function(e,t){var r=this;({search:function(){r.query=s()({},t),r.current=1,r.getData()},reset:function(){r.query={},r.pageSize=10,r.current=1,r.getData(),r.getTree()}})[e]()},getTree:function(){var e=this;return l()(i.a.mark(function t(){var r,a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.product.tree();case 2:r=t.sent,a=r.data,e.data=a.category;case 5:case"end":return t.stop()}},t,e)}))()},getData:function(){var e=this;return l()(i.a.mark(function t(){var r,a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.id=void 0,t.prev=1,e.loading=!0,t.next=5,e.$api.product.goodsList(s()({},e.query,{pageSize:e.pageSize,page:e.current}));case 5:r=t.sent,a=r.data,e.tableData=a.items,e.count=a.count,e.exportOptions=a.fields||[],e.loading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),e.loading=!1;case 16:case"end":return t.stop()}},t,e,[[1,13]])}))()},handlePageChange:function(e){this.current=e,this.getData()},handleSizeChange:function(e){this.pageSize=e,this.getData()},jumpTo:function(e,t,r){this.id=r,this.showAdd=!0},handleSelectionChange:function(e){var t=[];e.length<1?this.columnSelect=[]:(e.map(function(e){t.push(e.id)}),this.columnSelect=t)},handleDel:function(e){var t=this;this.$confirm("确认删除选中分类？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.del(e)})},del:function(e){var t=this;if("many"==e){if(this.columnSelect.length<1)return void this.$message({message:"请至少选择一条分类",type:"error"});this.$api.product.goodDelall({ids:this.columnSelect.join(",")}).then(function(){t.getData(),t.getTree()})}else this.$api.product.goodDel({id:e}).then(function(){t.getData(),t.getTree()})},handleCommand:function(e){"listDel"!=e.name?this.$router.push({name:e.name,params:{type:e.type,id:e.id}}):this.handleDel(e.id)},composeValue:function(e,t,r){return{name:e,type:t,id:r}}}},d={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"remove-product"},[r("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}},[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.product.product.add],expression:"[$api.product.product.add]"}],attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){return t.stopPropagation(),e.jumpTo("NewConfigProduct","add",null)}}},[e._v("添 加")]),e._v(" "),r("Export",{directives:[{name:"permission",rawName:"v-permission",value:[e.$api.product.product.export],expression:"[$api.product.product.export]"}],attrs:{exportOptions:e.exportOptions,query:e.query,url:e.$api.product.product.export}})],1),e._v(" "),r("div",{staticClass:"contnet-product common-table-wrapper"},[r("el-tree",{staticStyle:{width:"150px","margin-top":"4px"},attrs:{data:e.data,props:e.defaultProps},on:{"node-click":e.handleNodeClick}}),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",border:"none",borderBottom:"1px solid #e8e8e8"}},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{align:"center",prop:"id",label:"编号"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"name",label:"分类名称"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"分类图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("img",{staticClass:"photo",staticStyle:{width:"40px",height:"40px"},attrs:{src:t.row.thumb,alt:""},on:{click:function(r){e.previewImg=t.row.thumb,e.visible=!0}}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"num",label:"商品数量"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"是否启用"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{disabled:!e.button_permissions.includes(e.$api.product.product.edit),"active-value":1,"inactive-value":0},on:{change:function(r){return e.changeDisplayStatus(t.row)}},model:{value:t.row.display,callback:function(r){e.$set(t.row,"display",r)},expression:"scope.row.display"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",width:"100",label:"是否主推"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{disabled:!e.button_permissions.includes(e.$api.product.product.edit),"active-value":1,"inactive-value":0},on:{change:function(r){return e.changeDisplayIndexStatus(t.row)}},model:{value:t.row.display_index,callback:function(r){e.$set(t.row,"display_index",r)},expression:"scope.row.display_index"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"sort",label:"排序"}}),e._v(" "),r("el-table-column",{attrs:{width:"180",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(r){return r.stopPropagation(),e.jumpTo("EditConfigProduct","edit",t.row.id)}}},[e._v("编辑")]),e._v(" "),r("el-button",{staticStyle:{color:"#fb6a6e"},attrs:{type:"text",size:"mini"},on:{click:function(r){return e.handleDel(t.row.id)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),r("Pagination",{attrs:{current:e.current,pageSize:e.pageSize,count:e.count},on:{opreateCBK:function(t){return e.handleDel("many")},pageChangeCBK:e.handlePageChange,sizeChangeCBK:e.handleSizeChange}}),e._v(" "),r("el-dialog",{attrs:{title:"转移商品",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px","label-position":"right"}},[r("el-form-item",{attrs:{label:"原商品分类："}},[r("el-select",{staticStyle:{width:"70%"},attrs:{placeholder:"请选择"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}},e._l(e.options,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"目标商品分类："}},[r("el-select",{staticStyle:{width:"70%"},attrs:{placeholder:"请选择"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}},e._l(e.options,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"warning"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("\n                开始转移\n            ")])],1)],1),e._v(" "),r("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),r("NewConfigProduct",{attrs:{show:e.showAdd,id:e.id},on:{fresh:e.getData,"update:show":function(t){e.showAdd=t}}})],1)},staticRenderFns:[]};var p=r("C7Lr")(u,d,!1,function(e){r("RFpg")},"data-v-8cbcaf94",null);t.default=p.exports},RFpg:function(e,t){},YMJJ:function(e,t){},ijF1:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("lC5x"),i=r.n(a),n=r("IHPB"),l=r.n(n),o=r("aA9S"),s=r.n(o),c=r("J0Oq"),u=r.n(c),d={name:"NewConfigProduct",props:{show:[Boolean],id:{}},data:function(){return{visible:!1,ruleForm:{name:"",num:"",delivery:!1,resource:"",desc:"",display:0,display_index:0,pid:[],thumb:[],imgs:[],sort:10},rules:{name:[{required:!0,message:"请输入",trigger:"blur"}],pid:[{required:!1,message:"请选择",trigger:"change"}],num:[{required:!0,message:"请填写",trigger:"blur"}],sort:[{required:!0,message:"请填写",trigger:"blur"}],describe:[{required:!1,message:"请填写",trigger:"blur"}],keywords:[{required:!1,message:"请填写",trigger:"blur"}]},areaList:[]}},watch:{visible:function(e){this.$emit("update:show",e)},show:function(e){this.visible=e},id:function(e){this.resetForm("ruleForm"),e||(this.ruleForm.thumb=[{url:""}],this.ruleForm.imgs=[{url:""}]),this.getData()}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){e&&t.save()})},save:function(){var e=this;return u()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((r=s()({},e.ruleForm)).thumb&&r.thumb.length>0?r.thumb=[r.thumb[0].url]:r.thumb=[],r.imgs&&r.imgs.length>0?r.imgs=[r.imgs[0].url]:r.imgs=[],r.pid&&(r.position=[].concat(l()(e.ruleForm.pid)).join(","),r.pid=[].concat(l()(e.ruleForm.pid)).splice(-1,1)[0]),!e.id){t.next=9;break}return t.next=7,e.$api.product.goodEdit(r);case 7:t.next=11;break;case 9:return t.next=11,e.$api.product.goodAdd(r);case 11:e.$emit("fresh"),e.visible=!1;case 13:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){this.$refs[e].resetFields()},getData:function(){var e=this;return u()(i.a.mark(function t(){var r,a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.product.goodsDetail({id:e.id});case 3:if(r=t.sent,a=r.data,e.areaList=e.delEmypt(a.allCat.children),e.id){t.next=8;break}return t.abrupt("return");case 8:e.ruleForm=a.detail,e.ruleForm.pid=[].concat(l()(a.detail.position.split(","))),e.ruleForm.thumb=[{name:a.detail.id,url:a.detail.thumb[0]}],e.ruleForm.imgs=[{name:a.detail.id,url:a.detail.imgs[0]}],t.next=16;break;case 14:t.prev=14,t.t0=t.catch(0);case 16:case"end":return t.stop()}},t,e,[[0,14]])}))()},delEmypt:function(e){var t=this;return e.map(function(e){e.children&&e.children.length>0&&t.delEmypt(e.children),e.children&&0===e.children.length&&delete e.children}),e},getsuccessUpload:function(e){this.ruleForm.thumb=[{name:"thumb",url:e[0]}]},getsuccessUpload2:function(e){this.ruleForm.imgs=[{name:"imgs",url:e[0]}]}}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("RightSidePopup",{attrs:{mask:"",visible:e.visible,width:"50%"},on:{"update:visible":function(t){e.visible=t}}},[r("div",{staticClass:"title",staticStyle:{"font-size":"20px","font-weight":"bold","margin-bottom":"40px"}},[e._v(e._s(this.id?"编辑分类":"添加分类"))]),e._v(" "),r("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"160px"}},[r("el-form-item",{attrs:{label:"分类名称",prop:"name"}},[r("el-input",{staticStyle:{width:"200px"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"上级分类",prop:"pid"}},[r("el-cascader",{staticStyle:{width:"200px"},attrs:{"change-on-select":"",filterable:"","expand-trigger":"hover",options:e.areaList},model:{value:e.ruleForm.pid,callback:function(t){e.$set(e.ruleForm,"pid",t)},expression:"ruleForm.pid"}}),e._v(" "),r("p",{staticClass:"tips"},[e._v("不选择分类默认为顶级分类")])],1),e._v(" "),r("el-form-item",{attrs:{label:"商品数量"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:e.ruleForm.num,callback:function(t){e.$set(e.ruleForm,"num",t)},expression:"ruleForm.num"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"排序",prop:"sort"}},[r("el-input",{staticStyle:{width:"200px"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"是否显示",prop:"display"}},[r("el-radio-group",{model:{value:e.ruleForm.display,callback:function(t){e.$set(e.ruleForm,"display",t)},expression:"ruleForm.display"}},[r("el-radio",{attrs:{label:1}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"是否显示在导航栏",prop:"display_index"}},[r("el-radio-group",{model:{value:e.ruleForm.display_index,callback:function(t){e.$set(e.ruleForm,"display_index",t)},expression:"ruleForm.display_index"}},[r("el-radio",{attrs:{label:1}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"分类图标",prop:"thumb"}},[r("FileUpload",{attrs:{isOnly:!0,fileList:e.ruleForm.thumb},on:{successUploadCBK:e.getsuccessUpload}})],1),e._v(" "),r("el-form-item",{attrs:{label:"主推图",prop:"thumb"}},[r("FileUpload",{attrs:{isOnly:!0,fileList:e.ruleForm.imgs},on:{successUploadCBK:e.getsuccessUpload2}})],1),e._v(" "),r("div",{staticStyle:{width:"100%","text-align":"center"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[]};var m=r("C7Lr")(d,p,!1,function(e){r("YMJJ")},"data-v-7c160f1a",null);t.default=m.exports}});