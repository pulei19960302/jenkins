webpackJsonp([1],{"4ZO8":function(e,t){},"6TuQ":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("aA9S"),a=o.n(i),s=o("lC5x"),r=o.n(s),n=o("J0Oq"),l=o.n(n),c=o("IHPB"),d=o.n(c),u=o("4YfN"),p=o.n(u),m=o("48sp"),h=o("9ab0"),f=[{prop:"1",type:"selection",fixed:!0},{prop:"id",label:"商品编号"},{prop:"title",label:"商品名称"},{prop:"thumb",label:"商品图片",handle:!0},{prop:"shop_price",label:"售价（元）"},{prop:"stock",label:"库存"},{prop:"cost_price",label:"成本价（元）"},{prop:"start_at",label:"开团时间"}],b={mixins:[o("8Rg7").a],props:{showChooseGoods:{type:Boolean},choosedGoodsId:[Array]},data:function(){return{chooseGoodsVisible:!1,searchOPtions:[{type:"input",key:"keywords",placeholder:"商品编号 / 商品名称"},{type:"cascader",key:"cate_id",placeholder:"商品分类",options:[]}],Colums:f,selected:[],multipleSelection:[]}},computed:p()({},Object(m.e)("product",["allGoods","allCategories"])),watch:{showChooseGoods:function(e){this.chooseGoodsVisible=e},chooseGoodsVisible:function(e){this.$emit("update:showChooseGoods",e)},choosedGoodsId:function(e){var t=this;this.tableData.forEach(function(e){t.choosedGoodsId.includes(e.id)?t.$refs.multipleTable.toggleRowSelection(e,!0):t.$refs.multipleTable.toggleRowSelection(e,!1)})}},created:function(){var e=this;this.searchOPtions.forEach(function(t){"cate_id"===t.key&&(t.options=e.allCategories)}),this.getData()},methods:p()({},Object(m.b)("product",["getAllGoods"]),{handleSelectionChange:function(e){var t=this.findLinkId(),o=t.linked,i=t.noLink;o=e.map(function(e){return e.id}),this.$emit("update:choosedGoodsId",i.concat(o))},findLinkId:function(){var e=this.tableData.map(function(e){return e.id}),t=[],o=[];return this.choosedGoodsId.forEach(function(i){e.includes(i)?t.push(i):o.push(i)}),{linked:t,noLink:o}},getData:function(){var e=this;return l()(r.a.mark(function t(){var o,i,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,e.query.cate_id&&0!==e.query.cate_id.length&&(e.query.cate_id=e.query.cate_id[e.query.cate_id.length-1]),t.next=4,e.$api.common.getGoodsSelect(p()({},e.query,{pageSize:e.pageSize,page:e.current}));case 4:o=t.sent,i=o.data,e.loading=!1,a=[].concat(d()(e.choosedGoodsId)),e.tableData=i.list.items,e.count=i.list.count,e.$nextTick(function(){0!==a.length&&e.$emit("update:choosedGoodsId",a)});case 11:case"end":return t.stop()}},t,e)}))()}})},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("RightSidePopup",{staticStyle:{width:"60%"},attrs:{visible:e.chooseGoodsVisible},on:{"update:visible":function(t){e.chooseGoodsVisible=t}}},[o("Search",{attrs:{searchOPtions:e.searchOPtions},on:{searchCallback:e.handelSearch}}),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","highlight-current-row":!0,border:"",data:e.tableData,"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",border:"none",borderBottom:"1px solid #e8e8e8"}},on:{"selection-change":e.handleSelectionChange}},[e._l(e.Colums,function(t){return[t.handle?e._e():o("el-table-column",{key:t.prop,attrs:{prop:t.prop,fixed:t.fixed,align:"center",label:t.label,type:t.type}}),e._v(" "),t.handle?o("el-table-column",{key:t.prop,attrs:{prop:t.prop,fixed:t.fixed,align:"center",label:t.label,type:t.type},scopedSlots:e._u([{key:"default",fn:function(e){return"thumb"===t.prop?[o("img",{staticClass:"table-img",attrs:{src:e.row.thumb}})]:void 0}}],null,!0)}):e._e()]})],2),e._v(" "),o("Pagination",{attrs:{current:e.current,pageSize:e.pageSize,count:e.count},on:{pageChangeCBK:e.handlePageChange,sizeChangeCBK:e.handleSizeChange}})],1)},staticRenderFns:[]};var g={name:"AddSeckill",components:{ChooseGoods:o("C7Lr")(b,v,!1,function(e){o("ZakQ")},"data-v-16a407ec",null).exports},directives:{clickoutside:o("lEsE").a},data:function(){return{visible:!1,showChooseGoods:!1,previewImg:"",simpleRule:{required:!0,message:"必填项",trigger:"change"},id:this.$route.params.id,goods:[],brands:[],suppliers:[],current:1,pageSize:10,count:0,tableData:[],form:{start_time:"",end_time:"",goods_ids:[],title:"",status:10},rules:{},nameEdit:null,readtype:(this.$route.params||"").readtype}},computed:p()({},Object(m.e)("product",["allGoods","allCategories"])),watch:{"form.goods_ids":function(e){e&&e.length>0?this.tableData=this.allGoods.filter(function(t){return e.includes(t.id)}):this.tableData=[]},$route:function(e){var t=e.params;t.id?(this.id=t.id,this.seckillDetail(t.id)):this.resetForm("form")}},created:function(){this.goods=this.allGoods,this.id&&this.seckillDetail(this.id)},methods:p()({},Object(m.b)("product",["getAllGoods"]),{edit:function(e,t){this[e]=t},handleClickoutside:function(){},handleSearch:function(e){var t=this,o=h.Loading.service({target:".cascader",fullscreen:!1,spinner:"el-icon-loading",customClass:"cascader-loading"}),i="";e&&e.length>0&&(i=[].concat(d()(e)).splice(-1,1)),this.getAllGoods({cate_id:i}).then(function(e){t.goods=e,t.$nextTick(function(){o.close()})}).catch(function(e){t.$nextTick(function(){o.close()})})},seckillDetail:function(e){var t=this;return l()(r.a.mark(function o(){var i,a;return r.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,t.$api.activity.seckillDetail({id:e});case 3:i=o.sent,a=i.data,t.form.end_time=1e3*a.end_time,t.form.start_time=1e3*a.start_time,t.form.goods_ids=a.goodsData.map(function(e){return Number(e.goods_id)}),t.form.title=a.title,t.form.status=a.status,console.log(a.status),o.next=16;break;case 13:throw o.prev=13,o.t0=o.catch(0),new Error(o.t0);case 16:case"end":return o.stop()}},o,t,[[0,13]])}))()},handlePreview:function(e){e&&(this.imgSrc=e,this.visible=!0)},imgSuccessUploadCBK:function(e,t){this[t]=[].concat(d()(e))},handleDel:function(e){this.form.goods_ids=this.form.goods_ids.filter(function(t){return t!=e})},resetForm:function(e){this.$refs[e].resetFields()},handelSubmit:function(e){var t,o=this;this.$refs[e].validate((t=l()(r.a.mark(function e(t){var i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=17;break}return e.prev=1,(i=a()({},o.form)).goods_ids=i.goods_ids.join(","),i.end_time=i.end_time/1e3,i.start_time=i.start_time/1e3,o.id&&(i.id=o.id),e.next=9,o.$api.activity.seckillAdd(i);case 9:o.$router.push({name:"Seckill"}),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),new Error(e.t0);case 15:e.next=18;break;case 17:o.$message.error("请确认信息是否填写完整");case 18:case"end":return e.stop()}},e,o,[[1,12]])})),function(e){return t.apply(this,arguments)}))},handleSave:function(e){var t=e.sort,o=e.id;this.$api.product.setSort({id:o,sort:t}),this.nameEdit=null}})},_={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"moreRules-content"},[o("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"label-width":"140px",size:"mini"}},[o("el-form-item",{attrs:{label:"活动批次:",prop:"title",rules:[e.simpleRule]}},[o("el-input",{staticStyle:{width:"300px"},attrs:{disabled:"read"==e.readtype},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"开始时间:",prop:"start_time",rules:[e.simpleRule]}},[o("el-date-picker",{staticStyle:{width:"300px"},attrs:{disabled:"read"==e.readtype,"value-format":"timestamp",size:"mini",type:"datetime"},model:{value:e.form.start_time,callback:function(t){e.$set(e.form,"start_time",t)},expression:"form.start_time"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"结束时间:",prop:"end_time",rules:[e.simpleRule]}},[o("el-date-picker",{staticStyle:{width:"300px"},attrs:{disabled:"read"==e.readtype,"value-format":"timestamp",size:"mini",type:"datetime"},model:{value:e.form.end_time,callback:function(t){e.$set(e.form,"end_time",t)},expression:"form.end_time"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"上架/下架:"}},[o("el-radio-group",{attrs:{disabled:"read"==e.readtype},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[o("el-radio",{attrs:{label:10}},[e._v("上架")]),e._v(" "),o("el-radio",{attrs:{label:0}},[e._v("下架")])],1)],1),e._v(" "),o("el-row",[o("el-form-item",{attrs:{prop:"goods_ids",rules:[e.simpleRule]}},[o("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){t.stopPropagation(),e.showChooseGoods=!0}}},[e._v("关联商品")]),e._v(" "),o("p",{staticClass:"mt20 tips"},[e._v("已关联 "),o("b",{staticStyle:{color:"#000"}},[e._v(e._s(e.form.goods_ids&&e.form.goods_ids.length))]),e._v(" 件商品")]),e._v(" "),o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"max-height":"400",size:"mini",border:"",data:e.tableData,"tooltip-effect":"dark"}},[o("el-table-column",{attrs:{width:"100",align:"center",prop:"id",label:"商品编号"}}),e._v(" "),o("el-table-column",{attrs:{align:"left",prop:"title",label:"商品名称"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("img",{staticClass:"table-img",attrs:{src:t.row.thumb},on:{click:function(o){e.previewImg=t.row.thumb,e.visible=!0}}})]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"shop_price",label:"售价（元）"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"stock",label:"库存"}}),e._v(" "),o("el-table-column",{attrs:{width:"180",align:"center",prop:"sort",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.handleClickoutside,expression:"handleClickoutside"}]},[o("span",{directives:[{name:"show",rawName:"v-show",value:e.nameEdit!=t.row.id,expression:"nameEdit != scope.row.id"}],staticClass:"el-icon-edit-content"},[e._v("\n                        "+e._s(t.row.sort)+"\n                        "),"read"!=e.readtype?o("i",{staticClass:"el-icon-edit icon",on:{click:function(o){return e.edit("nameEdit",t.row.id)}}}):e._e()]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.nameEdit==t.row.id,expression:"nameEdit == scope.row.id"}],staticStyle:{display:"flex"}},[o("el-input",{model:{value:t.row.sort,callback:function(o){e.$set(t.row,"sort",o)},expression:"scope.row.sort"}}),e._v(" "),o("el-button",{staticStyle:{"margin-left":"2px"},attrs:{type:"text",size:"mini"},on:{click:function(o){return e.handleSave(t.row)}}},[e._v("保存")])],1)])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"cost_price",label:"成本价（元）"}}),e._v(" "),"read"!=e.readtype?o("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("p",{staticStyle:{color:"red",cursor:"pointer"},on:{click:function(o){return e.handleDel(t.row.id)}}},[e._v("删除")])]}}],null,!1,1612352432)}):e._e()],1)],1)],1)],1),e._v(" "),"read"!=e.readtype?o("div",{staticClass:"complete"},[o("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handelSubmit("form")}}},[e._v("提 交")])],1):e._e(),e._v(" "),o("PreviewImg",{attrs:{visible:e.visible,imgSrc:e.previewImg},on:{"update:visible":function(t){e.visible=t}}}),e._v(" "),o("ChooseGoods",{attrs:{choosedGoodsId:e.form.goods_ids,showChooseGoods:e.showChooseGoods},on:{"update:choosedGoodsId":function(t){return e.$set(e.form,"goods_ids",t)},"update:choosed-goods-id":function(t){return e.$set(e.form,"goods_ids",t)},"update:showChooseGoods":function(t){e.showChooseGoods=t},"update:show-choose-goods":function(t){e.showChooseGoods=t}}})],1)},staticRenderFns:[]};var w=o("C7Lr")(g,_,!1,function(e){o("4ZO8")},"data-v-b1e3254a",null);t.default=w.exports},ZakQ:function(e,t){}});