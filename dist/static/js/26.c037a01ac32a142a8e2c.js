webpackJsonp([26],{A9zj:function(t,e,i){"use strict";e.__esModule=!0,e.default=function(t,e){var i={};for(var n in t)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i}},KnWu:function(t,e){},ieFc:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("lC5x"),s=i.n(n),a=i("J0Oq"),r=i.n(a),o=i("IHPB"),l=i.n(o),c=i("A9zj"),u=i.n(c),p=i("3cXf"),d=i.n(p),f=i("4YfN"),m=i.n(f),v={1:"专题"},_={plate_index:"style_3_1",plate_type:"1",num:3,contents:[{type:"1"},{type:"1"},{type:"1"}]},h={name:"createSpecial",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:void 0}},data:function(){return{form:m()({},_),TARGET_ID:v,simpleRule:{required:!0,message:"必填项",trigger:"change"},oldForm:m()({},_),targetList:[],goodsList:[],rules:{}}},computed:{getSizeText:function(){return function(t){var e=this.form.plate_index;if(0===t){if("style_1_1"===e)return"710px×180px";if("style_2_2"===e||"style_3_1"===e)return"710px×160px";if("style_2_1"===e)return"346px×260px";if("style_3_3"===e)return"220px×220px";if("style_3_2"===e)return"346px×160px"}if(1===t){if("style_2_1"===e)return"346px×260px";if("style_2_2"===e)return"710px×220px";if("style_3_1"===e)return"346px×220px";if("style_3_2"===e)return"346px×160px";if("style_3_3"===e)return"220px×220px"}if(2===t){if("style_3_1"===e)return"346px×220px";if("style_3_2"===e)return"710px×220px";if("style_3_3"===e)return"220px×220px"}}}},watch:{visible:function(t){var e=this;if(this.isChange)this.isChange=!1;else if(t)if(this.data){for(var i=this.data,n=i.content,s=u()(i,["content"]),a=n.length;a<3;a++)n[a]={type:"1"};s.num=parseInt(s.num,10),this.form=m()({},s,{contents:[].concat(l()(n))}),this.oldForm=m()({},s,{contents:[].concat(l()(n))})}else this.init();else d()(this.form)!==d()(this.oldForm)?this.$confirm("您还未提交内容，是否要退出？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.init()}).catch(function(){e.$emit("update:visible",!t),e.isChange=!0}):this.init()}},mounted:function(){var t=this;this.$api.activity.getSpecialList({}).then(function(e){t.targetList=e.data.data}).catch(function(t){})},methods:{onRadioChange:function(t){this.form.plate_type=t.toString(),this.form.plate_index="style_"+t+"_1"},init:function(){this.form=m()({},_),this.oldForm=m()({},_),this.form.contents.forEach(function(t){t.image=""})},onChooseBanner:function(t,e){this.form.plate_index=t,this.form.plate_type=e},getsuccessUpload:function(t,e){this.form.contents[e]||(this.form.contents[e]={}),this.form.contents[e].image=t[0]},vail:function(t){for(var e=!0,i="",n=0;n<this.form.num;n++){if(!this.form.contents[n].image){i="请上传板式图片",e=!1;break}if("1"===this.form.contents[n].type&&!this.form.contents[n].target_id){i="请选择专题详细内容",e=!1;break}}return e||this.$message({showClose:!0,message:i,type:"error"}),e},submit:function(t){var e,i=this;this.$refs[t].validate((e=r()(s.a.mark(function t(e){var n,a,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&i.vail()){for(n=[].concat(l()(i.form.contents)),a=2;a>=parseInt(i.form.num);a--)n.splice(a,1);r=m()({},i.form,{contents:n}),void 0,(r.id?i.$api.setting.editSpecialActivity(r):i.$api.setting.addSpecialActivity(r)).then(function(t){i.$message({type:"success",message:r.id?"修改成功!":"添加成功!"}),i.visible&&(i.init(),i.$emit("update:visible",!1))}).catch(function(t){})}case 1:case"end":return t.stop()}},t,i)})),function(t){return e.apply(this,arguments)}))}}},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"createSpecial"},[i("el-form",{ref:"form",attrs:{"label-position":"right",model:t.form,rules:t.rules,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"专题/活动名称：",prop:"name",rules:[t.simpleRule]}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"专题/活动数量："}},[i("el-radio-group",{on:{change:t.onRadioChange},model:{value:t.form.num,callback:function(e){t.$set(t.form,"num",e)},expression:"form.num"}},t._l([1,2,3],function(e){return i("el-radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])}),1)],1),t._v(" "),i("el-form-item",{staticClass:"banner-style",attrs:{label:"板式："}},t._l(["1","2","3"],function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:t.form.num===parseInt(e,10),expression:"form.num === parseInt(item, 10)"}],key:e,staticClass:"banner-line"},["1"===e?i("div",{staticClass:"banner-in",class:"style_1_1"+("style_1_1"===t.form.plate_index?" choose":""),on:{click:function(e){return t.onChooseBanner("style_1_1","1")}}},[i("div",{staticClass:"block"},[t._v("图一")])]):"2"===e?t._l(["style_2_1","style_2_2"],function(e){return i("div",{key:e,staticClass:"banner-in",class:e+(t.form.plate_index===e?" choose":""),on:{click:function(i){return t.onChooseBanner(e,"2")}}},[i("div",{staticClass:"block"},[t._v("图一")]),t._v(" "),i("div",{staticClass:"block"},[t._v("图二")])])}):"3"===e?t._l(["style_3_1","style_3_2","style_3_3"],function(e){return i("div",{key:e,staticClass:"banner-in",class:e+(t.form.plate_index===e?" choose":""),on:{click:function(i){return t.onChooseBanner(e,"3")}}},[i("div",{staticClass:"block"},[t._v("图一")]),t._v(" "),i("div",{staticClass:"block"},[t._v("图二")]),t._v(" "),i("div",{staticClass:"block"},[t._v("图三")])])}):t._e()],2)}),0),t._v(" "),i("div",[t._v("专题/活动内容：")]),t._v(" "),t._l(["图一","图二","图三"],function(e,n){return i("div",{directives:[{name:"show",rawName:"v-show",value:t.form.num>=n+1,expression:"form.num >= index + 1"}],key:e,staticClass:"special"},[i("div",{staticStyle:{"text-align":"center"}},[t._v(t._s(e+"设置"))]),t._v(" "),i("el-form-item",{class:t.form.plate_index,staticStyle:{width:"500px"},attrs:{label:"主图："}},[i("FileUpload",{attrs:{width:"100px",height:"100px",isOnly:!0,fileList:t.form.contents[n].image?[{name:"imgae",url:t.form.contents[n].image}]:void 0},on:{successUploadCBK:function(e){return t.getsuccessUpload(e,n)}}})],1),t._v(" "),i("div",{staticClass:"el-upload__tip",staticStyle:{"text-indent":"150px","margin-bottom":"10px"},attrs:{slot:"tip"},slot:"tip"},[t._v("\n                建议尺寸 "+t._s(t.getSizeText(n))+"\n            ")]),t._v(" "),i("el-form-item",{attrs:{label:"类型："}},[i("el-radio-group",{model:{value:t.form.contents[n].type,callback:function(e){t.$set(t.form.contents[n],"type",e)},expression:"form.contents[index].type"}},t._l(t.TARGET_ID,function(e,n){return i("el-radio",{key:n,attrs:{label:n}},[t._v(t._s(e))])}),1)],1),t._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"===t.form.contents[n].type,expression:"form.contents[index].type === '1'"}],attrs:{label:"详细内容："}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.contents[n].target_id,callback:function(e){t.$set(t.form.contents[n],"target_id",e)},expression:"form.contents[index].target_id"}},t._l(t.targetList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1)],1)})],2),t._v(" "),i("div",{staticClass:"submit-btn"},[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[t.$api.setting.specialActivity.edit],expression:"[$api.setting.specialActivity.edit]"}],attrs:{type:"primary",size:"medium"},on:{click:function(e){return t.submit("form")}}},[t._v("提交")])],1)],1)},staticRenderFns:[]};var y={1:"专题",2:"拼团"},g={name:"specialSetting",data:function(){return{listData:[],visible:!1,bannerVisible:!1,bannerIndex:-1,data:void 0}},components:{CreateSpecial:i("C7Lr")(h,b,!1,function(t){i("rVfG")},"data-v-65fb4b1e",null).exports},computed:{plateName:function(){return function(t){return y[t]}}},created:function(){this.getList()},methods:{opBannerModal:function(t){this.bannerVisible=!0,this.bannerIndex=t},getList:function(){var t=this;this.$api.setting.getSpecialActivityList().then(function(e){t.listData=e.data.data}).catch(function(t){})},opModal:function(t){t&&"1"===t.enabled||(this.data=t,this.visible=!0)},start:function(t){var e=this;this.$api.setting.editStatusSpecialActivity({id:this.listData[t].id,enabled:"1"}).then(function(t){e.getList()})},stop:function(t){var e=this;this.$api.setting.editStatusSpecialActivity({id:this.listData[t].id,enabled:"0"}).then(function(t){e.getList()})},deleteItem:function(t){var e=this;this.$confirm("删除类型会删除关联的问题，是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.setting.editStatusSpecialActivity({id:e.listData[t].id,delflag:"1"}).then(function(i){e.listData.splice(t,1),e.$message({type:"success",message:"删除成功!"})})})}},watch:{visible:function(t){t||this.getList()}}},x={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"specialSetting"},[i("p",{staticClass:"title"},[t._v("首页板式")]),t._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("div",{directives:[{name:"permission",rawName:"v-permission",value:[t.$api.setting.specialActivity.add],expression:"[$api.setting.specialActivity.add]"}],staticClass:"grid-content add",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.opModal()}}},[t._v("\n                新增板式\n            ")])]),t._v(" "),t._l(t.listData,function(e,n){return i("el-col",{key:n,attrs:{span:12}},[i("div",{staticClass:"grid-content"},[i("div",{staticClass:"top",on:{click:function(i){return t.opModal(e)}}},[i("div",{staticClass:"top-left"},[i("div",{staticClass:"banner-in table-img",class:e.plate_index,on:{click:function(e){return e.stopPropagation(),t.opBannerModal(n)}}},t._l(parseInt(e.num,10),function(n){return i("div",{key:n,staticClass:"block"},[e.content&&e.content[n-1]&&e.content[n-1].image?i("img",{staticClass:"banner-img",attrs:{src:e.content[n-1].image,alt:""}}):t._e()])}),0)]),t._v(" "),i("div",{staticClass:"top-right"},[i("div",[t._v("名称："+t._s(e.name))]),t._v(" "),i("div",[t._v("类型："+t._s(t._f("plateName")(e.plate_type)))]),t._v(" "),i("div",[t._v("板式数量："+t._s(e.num))])])]),t._v(" "),i("div",{staticClass:"center",on:{click:function(i){return t.opModal(e)}}},[i("div",{staticClass:"details"},[t._v("详细内容")]),t._v(" "),i("div",{staticClass:"details-right",style:{color:"1"===e.enabled?"#1890ff":"inherit"}},t._l(e.content,function(e,n){return i("div",{key:n},[t._v("\n                            "+t._s(n+1+"："+t.plateName(e.type))+"\n                        ")])}),0)]),t._v(" "),i("div",{staticClass:"bottom"},[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[t.$api.setting.specialActivity.editStatus],expression:"[$api.setting.specialActivity.editStatus]"}],attrs:{size:"medium",type:"1"===e.enabled?"primary":"info",plain:"1"!==e.enabled},on:{click:function(e){return t.start(n)}}},[t._v("\n                        "+t._s("1"===e.enabled?"已生效":"启用")+"\n                    ")]),t._v(" "),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:[t.$api.setting.specialActivity.editStatus],expression:"[$api.setting.specialActivity.editStatus]"}],attrs:{size:"medium",type:"1"===e.enabled?"info":"danger",plain:"1"===e.enabled},on:{click:function(i){"1"===e.enabled?t.stop(n):t.deleteItem(n)}}},[t._v("\n                        "+t._s("1"===e.enabled?"停用":"删除")+"\n                    ")])],1)])])})],2),t._v(" "),i("RightSidePopup",{staticStyle:{width:"800px"},attrs:{noOutside:"",visible:t.visible},on:{"update:visible":function(e){t.visible=e}}},[i("CreateSpecial",{ref:"detail",attrs:{visible:t.visible,data:t.data},on:{"update:visible":function(e){t.visible=e}}})],1),t._v(" "),i("el-dialog",{attrs:{title:"板式预览",width:"650px",visible:t.bannerVisible},on:{"update:visible":function(e){t.bannerVisible=e}}},[i("div",{staticClass:"banner-in big",class:t.listData[t.bannerIndex]&&t.listData[t.bannerIndex].plate_index},t._l((t.listData[t.bannerIndex]||{}).content,function(t){return i("div",{key:t.id,staticClass:"block"},[i("img",{staticClass:"banner-img",attrs:{src:t.image,alt:""}})])}),0)])],1)},staticRenderFns:[]};var C=i("C7Lr")(g,x,!1,function(t){i("KnWu")},"data-v-20c2f53a",null);e.default=C.exports},rVfG:function(t,e){}});