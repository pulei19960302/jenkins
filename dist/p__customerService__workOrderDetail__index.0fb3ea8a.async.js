(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{aXGe:function(e,t,a){"use strict";a.r(t);a("14J3");var r=a("BMrR"),n=(a("jCWc"),a("kPKH")),o=a("eHn4"),l=a.n(o),i=(a("2qtc"),a("kLXV")),s=a("2Taf"),c=a.n(s),d=a("vZ4D"),u=a.n(d),f=a("MhPg"),p=a.n(f),m=a("l4Ni"),v=a.n(m),h=a("ujKo"),g=a.n(h),y=a("p0pE"),k=a.n(y),E=a("MuoO"),_=a("q1tI"),R=a.n(_),w=a("Kvkj"),b=(a("IzEo"),a("bx4M")),M=(a("bP8k"),a("gFTJ")),C=(a("5Dmo"),a("3S7+")),S=(a("+L6B"),a("2/Rp")),D=a("wd/R"),O=a.n(D),x=a("t73O"),A=a("TFei"),N=a("WXRg"),I=a.n(N);function T(e){return function(){var t,a=g()(e);if(F()){var r=g()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return v()(this,t)}}function F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var P="YYYY-MM-DD HH:mm:ss",V=function(e){p()(a,e);var t=T(a);function a(){var e;c()(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n)),e.getBtns=function(){var t=e.props.details.status,a=void 0===t?"":t,r=e.props,n=r.onClose,o=r.toggleAddRelationModal,l=r.toggleTransferModal;if(a===A["k"].PROGRESS)return R.a.createElement("div",null,Object(A["l"])("addRelation")&&R.a.createElement(S["a"],{onClick:o,className:I.a.addRelation},"\u65b0\u589e\u5173\u8054\u5355\u636e"),Object(A["l"])("transfer")&&R.a.createElement(S["a"],{onClick:l,className:I.a.transfer},"\u8f6c\u79fb\u5de5\u5355"),Object(A["l"])("close")&&R.a.createElement(S["a"],{onClick:n,className:I.a.close},"\u5173\u95ed\u5de5\u5355"))},e.renderRelations=function(){var t=e.props,a=t.relations,r=void 0===a?[]:a,n=t.details,o=void 0===n?{}:n,l=t.onViewAfterSale,i=t.onViewOrderInfo,s=o.customer_member_id,c=void 0===s?"":s;if(r&&r.length){var d=r.map(function(e){var t=e.relation_sn_type,a=e.relation_sn;return t===A["h"].AFTERSALE?R.a.createElement("div",null,"\u3010\u552e\u540e\u5de5\u5355\u3011\xa0",R.a.createElement("a",{onClick:function(){l&&l(a,c)}},a)):R.a.createElement("div",null,"\u3010\u8ba2\u5355\u3011\xa0",R.a.createElement("a",{onClick:function(){i&&i(a,c)}},a))});return R.a.createElement(M["a"].Item,{label:"\u5173\u8054\u5355\u636e\u6570\u91cf"},R.a.createElement(C["a"],{title:d,placement:"bottomLeft",overlayStyle:{backgroundColor:"#fff",zIndex:"100"},className:I.a.tooltip},R.a.createElement("span",{style:{cursor:"pointer",color:"#12C2C2"}},r.length)))}},e}return u()(a,[{key:"render",value:function(){var e,t=this.props.details,a=void 0===t?{}:t,r=a.worksheet_code,n=void 0===r?"":r,o=a.status,l=void 0===o?"":o,i=a.created_at,s=void 0===i?"":i,c=a.customer_member_id,d=void 0===c?"":c,u=a.customer_member_name,f=void 0===u?"":u;switch(l){case A["k"].PROGRESS:e="\u5904\u7406\u4e2d";break;case A["k"].CLOSED:e="\u5df2\u5173\u95ed";break;case A["k"].INVALID:e="\u5df2\u5931\u6548";break}return R.a.createElement(b["a"],{extra:this.getBtns(),title:R.a.createElement(M["a"],null,R.a.createElement(M["a"].Item,{className:I.a.boldFonts},R.a.createElement(x["a"],{style:{fontSize:22,verticalAlign:"middle"}}),R.a.createElement("span",{className:I.a.boldFonts},"\u5de5\u5355\u53f7\uff1a",n)),R.a.createElement(M["a"].Item,{className:I.a.boldFonts},R.a.createElement("span",{className:I.a.boldFonts},e)),R.a.createElement(M["a"].Item,{className:I.a.boldFonts},R.a.createElement("span",{className:I.a.boldFonts},O()(s).format(P))))},R.a.createElement(M["a"],null,R.a.createElement(M["a"].Item,{label:"\u5ba2\u6237\u8d26\u53f7"},f,"\xa0 (\xa0id:\xa0",d,"\xa0)"),this.renderRelations()))}}]),a}(_["PureComponent"]),L=V,z=(a("/zsF"),a("PArb")),j=a("RotF"),q=a.n(j);function W(e){return function(){var t,a=g()(e);if(B()){var r=g()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return v()(this,t)}}function B(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var G,Y,$,H=function(e){p()(a,e);var t=W(a);function a(e){var o;c()(this,a),o=t.call(this,e),o.getConversations=function(){var e=o.props,t=e.conversation_key,a=e.dispatch,r=o.state,n=r.page,l=r.page_size,i=r.hasMore,s=r.loading;!i&&s||o.setState(function(e){return{page:e.page+1,loading:!0}},function(){t&&a({type:"workOrderDetail/getConversations",payload:{conversation_key:t,page:n,page_size:l}})})},o.renderList=function(){var e=o.state.hasMore,t=o.props.conversations,a=void 0===t?{}:t,l=a.msg_list,i=void 0===l?[]:l,s=i&&i.map(function(e,t){var a=e.created_at,o=void 0===a?"":a;return R.a.createElement("div",{key:t},R.a.createElement(r["a"],{type:"flex"},R.a.createElement(n["a"],{className:I.a.img},R.a.createElement("img",{src:e.person_head_picture})),R.a.createElement(n["a"],null,R.a.createElement("div",null,R.a.createElement("span",{className:I.a.name},e.person_name),R.a.createElement("span",{className:I.a.time},o&&O()(o).format(A["e"]))),R.a.createElement("div",{className:I.a.content},e.content))),R.a.createElement(z["a"],null))});return R.a.createElement("div",{style:{height:"calc(100vh - 342px)",overflow:"auto"}},R.a.createElement(q.a,{pageStart:0,loadMore:o.getConversations,className:I.a.person,hasMore:e,initialLoad:!1,threshold:5,useWindow:!1},s))};var l=o.props.conversations,i=void 0===l?{}:l,s=i.msg_list,d=void 0===s?[]:s,u=i.total,f=void 0===u?0:u,p=i.loading,m=void 0!==p&&p;return o.state={page:1,page_size:20,hasMore:d.length<f,loading:m},o}return u()(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.conversations,a=void 0===t?{}:t,r=a.msg_list,n=void 0===r?[]:r,o=a.total,l=void 0===o?0:o,i=a.loading,s=void 0!==i&&i;this.setState({hasMore:n.length<l,loading:s})}},{key:"render",value:function(){return R.a.createElement(b["a"],{title:"\u54a8\u8be2\u4fe1\u606f",className:I.a.card},this.renderList())}}]),a}(_["PureComponent"]),J=H,X=(a("g9YV"),a("wCAj")),K=(a("5NDa"),a("5rEg")),U=a("d6i3"),Z=a.n(U),Q=a("1l/V"),ee=a.n(Q),te=a("WsrF");a("XlDN");function ae(e){return function(){var t,a=g()(e);if(re()){var r=g()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return v()(this,t)}}function re(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var ne,oe,le,ie=(G=te["a"].create(),G(($=function(e){p()(a,e);var t=ae(a);function a(){var e;c()(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n)),e.addRecord=function(){var t=e.props,a=t.worksheet_code,r=t.getDetails,n=t.form;n.validateFields(function(){var e=ee()(Z.a.mark(function e(t,o){var l,i;return Z.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return");case 2:l=o.recordText,i=void 0===l?"":l,$api.workorder.addRecord({worksheet_code:a,worksheet_desc:i},{success:!0}).then(function(e){n.setFieldsValue({recordText:""}),r&&r()});case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}())},e}return u()(a,[{key:"renderAddRecord",value:function(){var e=this.props,t=e.status,a=void 0===t?"":t,r=e.form,n=r.getFieldDecorator;return a!==A["k"].PROGRESS?null:R.a.createElement("div",{className:"clearfix"},R.a.createElement(te["a"],null,R.a.createElement(te["a"].Item,null,n("recordText",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]})(R.a.createElement(K["a"].TextArea,{autoSize:{minRows:4,maxRows:6},rows:4,style:{resize:"none"}})))),R.a.createElement(S["a"],{type:"primary",className:"pull-right",onClick:this.addRecord},"\u65b0\u589e"))}},{key:"renderRecords",value:function(){var e=this.props,t=e.records,a=void 0===t?[]:t,r=e.status,n=void 0===r?"":r,o=n===A["k"].PROGRESS?I.a.recordsTable:I.a.closedRecordsTable,l=[{title:"\u65f6\u95f4",key:"created_at",dataIndex:"created_at",width:180,render:function(e){return R.a.createElement("span",null,e&&O()(e).format(A["e"]))}},{title:"\u64cd\u4f5c\u4eba\u8d26\u6237",key:"operation_member_name",dataIndex:"operation_member_name",width:120},{title:"\u5de5\u5355\u8bb0\u5f55",key:"action_desc",dataIndex:"action_desc"},{title:"\u5de5\u5355\u8bf4\u660e",key:"worksheet_desc",dataIndex:"worksheet_desc",width:200}];return R.a.createElement(X["a"],{dataSource:a,columns:l,pagination:!1,className:o,scroll:{y:"calc(100vh - 533px)"},style:{marginTop:10}})}},{key:"render",value:function(){return R.a.createElement(b["a"],{style:{marginLeft:"20px"},className:I.a.card,title:"\u5de5\u5355\u8bb0\u5f55"},this.renderAddRecord(),this.renderRecords())}}]),a}(_["PureComponent"]),Y=$))||Y),se=ie,ce=a("Bz3q"),de=(a("OaEy"),a("2fM7"));function ue(e){return function(){var t,a=g()(e);if(fe()){var r=g()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return v()(this,t)}}function fe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var pe,me,ve,he=de["a"].Option,ge={labelCol:{span:6},wrapperCol:{span:14}},ye=(ne=te["a"].create(),ne((le=function(e){p()(a,e);var t=ue(a);function a(){var e;c()(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n)),e.handleOk=function(){var t=e.props,a=t.customer_member_id,r=void 0===a?"":a,n=t.worksheet_code,o=void 0===n?"":n,l=t.form,i=t.onOk;l.validateFields(function(){var e=ee()(Z.a.mark(function e(t,a){var n,l,s,c,d;return Z.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return");case 2:n=a.relation_sn,l=void 0===n?"":n,s=a.relation_sn_type,c=void 0===s?"":s,d={relation_sn:l,relation_sn_type:c,customer_member_id:r,worksheet_code:o},$api.workorder.addRelation(d).then(function(e){i&&i()});case 5:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}())},e.handleCancel=function(){var t=e.props.onCancel;t&&t()},e}return u()(a,[{key:"render",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.visible;return R.a.createElement(i["a"],{title:"\u65b0\u589e\u5173\u8054\u5355\u636e",visible:a,onOk:this.handleOk,onCancel:this.handleCancel,destroyOnClose:!0,maskClosable:!1},R.a.createElement(te["a"],ge,R.a.createElement(te["a"].Item,{label:"\u5173\u8054\u5355\u636e"},t("relation_sn_type",{initialValue:A["h"].AFTERSALE})(R.a.createElement(de["a"],null,R.a.createElement(he,{value:A["h"].AFTERSALE},"\u552e\u540e\u670d\u52a1\u5355"),R.a.createElement(he,{value:A["h"].ORDER},"\u8ba2\u5355")))),R.a.createElement(te["a"].Item,{style:{position:"relative",left:"25%"}},t("relation_sn",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5355\u636e\u7f16\u53f7"}]})(R.a.createElement(K["a"],{placeholder:"\u8bf7\u8f93\u5165\u76f8\u5173\u5355\u636e\u7f16\u53f7",style:{width:"100%"}})))))}}]),a}(_["PureComponent"]),oe=le))||oe),ke=ye,Ee=a("M1UW"),_e=a("w4ly");function Re(e){return function(){var t,a=g()(e);if(we()){var r=g()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return v()(this,t)}}function we(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var be=(pe=Object(E["connect"])(function(e){var t=e.workOrderDetail;return k()({},t)}),pe((ve=function(e){p()(a,e);var t=Re(a);function a(e){var r;c()(this,a),r=t.call(this,e),r.getConversations=function(){var e=r.props.dispatch,t=r.state.conversation_key;t&&e({type:"workOrderDetail/getConversations",payload:{conversation_key:t,page:1,page_size:20}})},r.getDetails=function(){var e=r.props.dispatch,t=r.state.worksheet_code;t&&e({type:"workOrderDetail/getDetails",payload:{worksheet_code:t}})},r.getRelations=function(){var e=r.props.dispatch,t=r.state.worksheet_code;t&&e({type:"workOrderDetail/getRelations",payload:{worksheet_code:t}})},r.toggleAddRelationModal=function(){r.setState(function(e){return{addRelationModal:!e.addRelationModal}})},r.toggleTransferModal=function(){r.setState(function(e){return{transferModal:!e.transferModal}})},r.onClose=function(){var e=r.state.worksheet_code;i["a"].confirm({title:"\u786e\u8ba4\u5173\u95ed\u6240\u9009\u5de5\u5355\u4e48?",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){$api.workorder.close({worksheet_codes:[e]},{success:!0}).then(function(t){r.getDetails(e)})}})},r.onCloseDrawer=function(e){r.setState(l()({},e,!1))},r.onViewAfterSale=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&$api.customerService.afterSaleList({search_sn:e,uid:t}).then(function(e){var t=e.data,a=t&&t[0];r.setState({afterSaleModal:!0,order:a})})},r.onViewOrderInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&$api.customerService.orderDetail({order_sn:e,uid:t}).then(function(e){var t=e.data;r.setState({orderInfoModal:!0,order:t})})};var n=r.props.history.location.query,o=n.code,s=void 0===o?"":o,d=n.key,u=void 0===d?"":d;return r.state={worksheet_code:s,conversation_key:u,afterSaleModal:!1,orderInfoModal:!1,order:null,addRelationModal:!1,transferModal:!1},r}return u()(a,[{key:"componentDidMount",value:function(){this.getDetails(),this.getRelations(),this.getConversations()}},{key:"render",value:function(){var e=this,t=this.props,a=t.details,o=void 0===a?{}:a,l=t.conversations,i=void 0===l?{}:l,s=t.relations,c=void 0===s?[]:s,d=t.dispatch,u=o.records,f=void 0===u?[]:u,p=o.status,m=void 0===p?"":p,v=o.customer_member_id,h=void 0===v?"":v,g=this.state,y=g.conversation_key,k=g.order,E=g.afterSaleModal,_=g.orderInfoModal,b=g.worksheet_code,M=g.addRelationModal,C=g.transferModal;return R.a.createElement(w["x"],{className:"workDetail",style:{position:"relative"}},R.a.createElement(L,{details:o,relations:c,worksheet_code:b,onClose:this.onClose,onViewAfterSale:this.onViewAfterSale,onViewOrderInfo:this.onViewOrderInfo,toggleAddRelationModal:this.toggleAddRelationModal,toggleTransferModal:this.toggleTransferModal}),R.a.createElement(r["a"],null,R.a.createElement(n["a"],{span:10},R.a.createElement(J,{conversations:i,dispatch:d,conversation_key:y})),R.a.createElement(n["a"],{span:14},R.a.createElement(se,{records:f,worksheet_code:b,status:m,getDetails:this.getDetails}))),R.a.createElement(_e["a"],{onCancel:function(){e.onCloseDrawer("afterSaleModal")},modalVisible:E,order:k}),R.a.createElement(ce["a"],{onCancel:function(){e.onCloseDrawer("orderInfoModal")},modalVisible:_,order:k}),R.a.createElement(ke,{worksheet_code:b,customer_member_id:h,visible:M,onCancel:this.toggleAddRelationModal,onOk:function(){e.getRelations(),e.toggleAddRelationModal()}}),R.a.createElement(Ee["a"],{visible:C,onCancel:this.toggleTransferModal,onOk:function(){e.getRelations(),e.getDetails(),e.toggleTransferModal()},worksheet_codes:[b]}))}}]),a}(_["PureComponent"]),me=ve))||me);t["default"]=be}}]);