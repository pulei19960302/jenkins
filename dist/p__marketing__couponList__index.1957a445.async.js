(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[46],{"H6/v":function(t,e,n){"use strict";n.r(e);n("2qtc");var o=n("kLXV"),i=n("2Taf"),a=n.n(i),c=n("vZ4D"),s=n.n(c),r=n("MhPg"),u=n.n(r),p=n("l4Ni"),l=n.n(p),d=n("ujKo"),f=n.n(d),h=n("MuoO"),v=n("q1tI"),g=n.n(v),b=n("Kvkj"),m=n("Dpy5"),C=n("rogm"),y=(n("bbsP"),n("/wGt")),k=n("p0pE"),S=n.n(k);function L(t){return function(){var e,n=f()(t);if(w()){var o=f()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return l()(this,e)}}function w(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}var D,R,I,E=function(t){u()(n,t);var e=L(n);function n(t){var o;return a()(this,n),o=e.call(this,t),o.initialState=function(){return{list:[],pagination:{showTotal:function(t){return"\u5171 ".concat(t," \u6761\u8bb0\u5f55")},pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,current:1,total:0,pageSize:20},searchFields:m["a"]}},o.onSearch=function(t){var e=o.state.pagination,n=o.props.couponId,i=void 0===n?0:n;o.setState({pagination:S()({},e,{current:1})}),o.getList(t,i)},o.getList=function(t,e){var n=o.state.pagination,i=n.pageSize,a=n.current,c=S()({pageSize:i,page:a},t);$api.coupon.couponUseDetails(S()({},c,{coupon_id:parseInt(e)})).then(function(t){var e=t.data;o.setState({list:e.items,pagination:{total:e.count,current:c.page,pageSize:c.pageSize}})})},o.onClose=function(){var t=o.props.onClose;t&&t()},o.state=o.initialState(),o}return s()(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(t){if(t.visible&&t.visible!==this.props.visible){var e=t.couponId,n=void 0===e?0:e;this.getList({},n)}}},{key:"render",value:function(){var t=this.props.visible,e=this.state,n=e.list,o=e.pagination,i=this.onSearch,a=this.getList;return g.a.createElement(y["a"],{title:"\u4f18\u60e0\u5238\u5217\u8868/\u7801\u5e93",placement:"right",onClose:this.onClose,visible:t,width:1e3},t&&g.a.createElement(b["i"],{dataSource:n,getList:a,onSearch:i,pagination:o,pageProps:{width:1e3,right:0},columns:Object(m["c"])(),searchFields:m["a"]}))}}]),n}(v["PureComponent"]),P=E;function T(t){return function(){var e,n=f()(t);if(U()){var o=f()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return l()(this,e)}}function U(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}var _=(D=Object(h["connect"])(function(t){var e=t.couponList,n=t.loading;return{couponList:e,loading:n}}),D((I=function(t){u()(n,t);var e=T(n);function n(t){var i;return a()(this,n),i=e.call(this,t),i.onSearch=function(t){var e=i.props.dispatch;e({type:"couponList/onSearch",payload:t}),e({type:"couponList/getList",payload:t})},i.getList=function(t){var e=i.props.dispatch;e({type:"couponList/getList",payload:t})},i.handleRouteTo=function(){var t=i.props,e=t.history,n=t.dispatch;n({type:"couponAdd/updateState",payload:{couponForm:{},productList:[]}}),e.push({pathname:"/marketing/couponAdd",payload:{create:!0}})},i.tableMoreClick=function(t,e){var n=e.id;if(n)switch(n=n.toString(),t){case"publish":i.publishCoupon(n);break;case"copy":i.editCoupon(n,"copy");break;case"delete":i.deleteCoupon(n);break;case"invalid":i.invalidCoupon(n);break;case"dispatch":i.dispatchCoupon(n);break;case"edit":i.editCoupon(n);break;case"details":i.showCouponUseDetails(n);break;case"view":i.editCoupon(n,!1,"view");break;default:break}},i.publishCoupon=function(t,e){$api.coupon.publishCoupon({coupon_id_str:t},{success:!0}).then(function(t){i.getList()})},i.editCoupon=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=i.props.history;e=n?{id:t,copy:n}:o?{id:t,view:o}:{id:t},a.push({pathname:"/marketing/couponAdd",query:e})},i.deleteCoupon=function(t,e){o["a"].confirm({title:"\u786e\u8ba4\u5220\u9664\u6240\u9009\u4f18\u60e0\u5238\u4e48?",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){$api.coupon.deleteCoupon({coupon_id_str:t},{success:!0}).then(function(t){i.getList()})}})},i.invalidCoupon=function(t,e){o["a"].confirm({title:"\u4f5c\u5e9f\u540e\u4e0d\u53ef\u6062\u590d\uff0c\u662f\u5426\u786e\u8ba4\u4f5c\u5e9f?",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){$api.coupon.invalidCoupon({coupon_id_str:t},{success:!0}).then(function(t){i.getList()})}})},i.dispatchCoupon=function(){},i.showCouponUseDetails=function(t){i.setState({detailVisible:!0,couponId:t})},i.hideCouponUseDetails=function(){i.setState({detailVisible:!1,couponId:""})},i.mutipulClick=function(t,e){var n=e.join(",");switch(t){case"delete":i.deleteCoupon(n);break;default:break}},i.onDisabled=function(t){var e=t.status;return e!==C["a"].UNPUBLISHED},i.getCouponDetails=function(){var t=i.state,e=t.detailVisible,n=t.couponId;return g.a.createElement(P,{visible:e,couponId:n,onClose:i.hideCouponUseDetails})},i.state={detailVisible:!1,couponId:""},i}return s()(n,[{key:"render",value:function(){var t=this,e=this.getList,n=this.onSearch,o=this.mutipulClick,i=this.onDisabled,a=this.props,c=a.couponList,s=a.loading,r=c.list,u=c.pagination,p=[{name:"\u6279\u91cf\u5220\u9664",key:"delete",permission:$api.coupon.deleteCoupon.permission()}].filter(function(t){return t.permission}),l=[{type:"primary",name:"\u65b0\u589e",handleClick:function(){t.handleRouteTo()},permission:$api.coupon.addCoupon.permission()}].filter(function(t){return t.permission});return g.a.createElement(b["x"],{inner:!0},g.a.createElement(b["y"],{btns:l}),g.a.createElement(b["i"],{dataSource:r,getList:e,onSearch:n,pagination:u,loading:s.effects["couponList/getList"],columns:m["b"].call(this,m["e"]),searchFields:m["d"],mutipulClick:o,mutipulBtns:p,onDisabled:i}),this.getCouponDetails())}}]),n}(v["PureComponent"]),R=I))||R);e["default"]=_}}]);