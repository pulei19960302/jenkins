(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[64],{"9zFN":function(e,t,a){e.exports={page:"page___2djOu",pageTitle:"pageTitle___O_UiQ",container:"container___2hwXo",uploadHint_box:"uploadHint_box___1XxLn",uploadHint_content:"uploadHint_content___3920U"}},oQCG:function(e,t,a){"use strict";a.r(t);var n,r,c,o=a("2Taf"),i=a.n(o),l=a("vZ4D"),s=a.n(l),u=a("MhPg"),d=a.n(u),p=a("l4Ni"),m=a.n(p),h=a("ujKo"),f=a.n(h),g=a("q1tI"),y=a.n(g),v=a("Kvkj"),E=a("jehZ"),C=a.n(E),S=(a("T2oS"),a("W9HT")),w=(a("qVdP"),a("jsC+")),b=(a("Awhp"),a("KrTs")),k=(a("lUTK"),a("BvKs")),N=a("eHn4"),T=a.n(N),D=a("p0pE"),I=a.n(D),P=(a("2qtc"),a("kLXV")),x=(a("ozfa"),a("MJZm")),_=a("MuoO"),M=a("w5pM"),L=a("/MfK"),F=a("5yul"),R=a("gUdW"),$=a("xGfz"),O=(a("BoS7"),a("Sdc0")),j=(a("giR+"),a("fyUT")),q=(a("5NDa"),a("5rEg")),A=(a("y8nQ"),a("Vl3Y")),H=a("qIgq"),K=a.n(H),B=a("hm3N"),V=function(e){var t=e.treeData,a=e.handleCancel,n=e.handleSubmit,r=e.initForm,c=void 0===r?{status:B["SWITCH_TYPE"].FORBIDDEN,is_diy:1}:r,o=Object(g["useState"])(!1),i=K()(o,2),l=i[0],s=i[1],u=A["a"].useForm(),d=K()(u,1),p=d[0],m=function(e,t,a,n){var r=t?e.filter(function(e){return e.id!==t}):e,c=r.filter(function(e){return e[a]===n});return c.length>0},h=function(){s(!0),p.validateFields().then(function(e){var t=I()({},c,e,{pid:0,status:e.status?1:2});Reflect.deleteProperty(t,"is_diy"),c.id?$api.category.categoryEdit(t,{success:!0}).then(function(e){f()}).catch(function(e){s(!1)}):$api.category.categoryAdd(t,{success:!0}).then(function(e){f()}).catch(function(e){s(!1)})}).catch(function(e){s(!1)})},f=function(){s(!1),n(),a()},v=function(e,a){return a?m(t,c.id,"name",a)?Promise.reject("\u6b64\u540d\u79f0\u5df2\u5b58\u5728\uff01"):Promise.resolve():Promise.reject("\u8bf7\u8f93\u5165\u7c7b\u76ee\u540d\u79f0\uff01")},E=function(e,a){return a?m(t,c.id,"sort",a)?Promise.reject("\u6b64\u6392\u5e8f\u5df2\u5b58\u5728\uff01"):Promise.resolve():Promise.reject("\u8bf7\u8f93\u5165\u6392\u5e8f\uff01")},C={title:c.id?"\u7f16\u8f91\u4e00\u7ea7\u7c7b\u76ee":"\u65b0\u589e\u4e00\u7ea7\u7c7b\u76ee",visible:!0,width:500,maskClosable:!1,confirmLoading:l,destroyOnClose:!0,onOk:h,onCancel:a};return y.a.createElement(P["a"],C,y.a.createElement(A["a"],{initialValues:I()({},c,{status:c.status===B["SWITCH_TYPE"].ENABLE}),form:p},y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u540d\u79f0",name:"name",rules:[{required:!0,validator:v}]},1===c.is_diy?y.a.createElement(q["a"],{placeholder:"\u8bf7\u586b\u5199\u7c7b\u76ee\u540d\u79f0",maxLength:20,autoComplete:"off"}):y.a.createElement("div",null,c.name)),y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u6392\u5e8f",name:"sort",rules:[{required:!0,validator:E}]},y.a.createElement(j["a"],{min:1,max:999,precision:0})),y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u72b6\u6001",name:"status",rules:[{required:!0}],valuePropName:"checked"},y.a.createElement(O["a"],{checkedChildren:"\u542f\u7528",unCheckedChildren:"\u7981\u7528"}))))},W=V;function Y(e){return function(){var t,a=f()(e);if(z()){var n=f()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return m()(this,t)}}function z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var G,U,J,Q=x["a"].TreeNode,X=P["a"].confirm,Z=(n=Object(_["connect"])(function(e){var t=e.newCategory,a=e.loading;return I()({},t,{loading:a})}),n((c=function(e){d()(a,e);var t=Y(a);function a(){var e;i()(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r)),e.state={showCategoryModal:!1,categoryModalProps:{}},e.toggleStatus=function(t,a){e.setState(T()({},t,a))},e.handleTreeSelect=function(t){var a=e.props.dispatch;if(t.length>0){var n=t&&t[0];a({type:"newCategory/updateState",payload:{selectedKeys:t,currentId:n}}),a({type:"newCategory/getList",payload:{pid:n}}),a({type:"newCategory/updateCurrentStatus",payload:{currentId:n}})}},e.handleCancel=function(){e.toggleStatus("showCategoryModal",!1)},e.handleSubmit=function(){var t=e.props.dispatch;t({type:"newCategory/getTreeData"})},e.addDepartment=function(){var t=e.props.treeData;e.setState({categoryModalProps:{treeData:t,handleSubmit:e.handleSubmit,handleCancel:e.handleCancel}}),e.toggleStatus("showCategoryModal",!0)},e.editDepartment=function(t){var a=e.props.treeData;e.setState({categoryModalProps:{initForm:t,treeData:a,handleSubmit:e.handleSubmit,handleCancel:e.handleCancel}}),e.toggleStatus("showCategoryModal",!0)},e.delDepartment=function(t){var a=e.props,n=a.dispatch,r=a.currentId,c=t.id;X({title:"\u5220\u9664\u7c7b\u76ee",content:"\u662f\u5426\u786e\u8ba4\u5220\u9664\u5f53\u524d\u7c7b\u76ee\uff1f",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){$api.category.categoryDel({id:c},{success:!0}).then(function(e){Number(c)===Number(r)&&n({type:"newCategory/updateState",payload:{currentId:null}}),n({type:"newCategory/getTreeData"})})}})},e.handleMenuClick=function(t){var a=t.item,n=t.key,r=t.domEvent,c=a.props.data;switch(n){case"edit":e.editDepartment(c);break;case"del":e.delDepartment(c);break}r.stopPropagation()},e.renderMenuItem=function(t){return y.a.createElement(k["a"],{onClick:e.handleMenuClick},$api.category.categoryEdit.permission()&&y.a.createElement(k["a"].Item,{key:"edit",data:t,className:"permissionMenuItem"},y.a.createElement(M["a"],null),"\xa0\u7f16\u8f91"),$api.category.categoryDel.permission()&&1===t.is_diy&&y.a.createElement(k["a"].Item,{key:"del",data:t,className:"permissionMenuItem"},y.a.createElement(L["a"],null),"\xa0\u5220\u9664"))},e.renderTreeNodeTitle=function(t){var a=t.name,n=t.status;return y.a.createElement(y.a.Fragment,null,y.a.createElement("div",{className:"nodeTitle"},y.a.createElement(b["a"],{status:1===n?"success":"error"}),y.a.createElement("span",{className:"name"},a),y.a.createElement("span",{className:"operate",onClick:function(e){e.stopPropagation()}},y.a.createElement(w["a"],{overlay:e.renderMenuItem(t),trigger:["hover"]},y.a.createElement(F["a"],null)))))},e.renderTreeNodes=function(t){var a=e.props.expandedKeys;return t.map(function(t){return t.children&&Array.isArray(t.children)&&t.children.length>0?y.a.createElement(Q,{style:{position:"relative"},switcherIcon:a.includes(t.id+"")?y.a.createElement(R["a"],null):y.a.createElement($["a"],null),title:e.renderTreeNodeTitle(t),key:t.id},e.renderTreeNodes(t.children)):y.a.createElement(Q,{title:e.renderTreeNodeTitle(t),key:t.id,style:{position:"relative"}})})},e}return s()(a,[{key:"render",value:function(){var e=this.state,t=e.showCategoryModal,a=e.categoryModalProps,n=this.props,r=n.expandedKeys,c=n.selectedKeys,o=n.treeData,i=n.loading;return y.a.createElement(g["Fragment"],null,y.a.createElement("div",{className:"header"},$api.category.categoryAdd.permission()&&y.a.createElement("div",{onClick:this.addDepartment},y.a.createElement(M["a"],null),"\xa0\xa0\u65b0\u589e\u4e00\u7ea7\u7c7b\u76ee")),y.a.createElement("div",{className:"tree"},y.a.createElement(S["a"],{spinning:i.effects["newCategory/getTreeData"]},y.a.createElement(x["a"],{onSelect:this.handleTreeSelect,expandedKeys:r,selectedKeys:c},this.renderTreeNodes(o)))),t&&y.a.createElement(W,C()({handleCancel:this.handleCancel},a)))}}]),a}(g["PureComponent"]),r=c))||r),ee=Z,te=(a("+L6B"),a("2/Rp")),ae=a("d6i3"),ne=a.n(ae),re=a("1l/V"),ce=a.n(re),oe=(a("/zsF"),a("PArb")),ie=function(e){var t=e.props.currentStatus;return[{title:"\u5e8f\u53f7",dataIndex:"id"},{title:"\u7c7b\u76ee\u540d\u79f0",dataIndex:"name"},{title:"\u7c7b\u76ee\u56fe\u7247",dataIndex:"thumb",width:100,previewImg:!0},{title:"\u7c7b\u76ee\u72b6\u6001",dataIndex:"status",render:function(a,n){return y.a.createElement(O["a"],{unCheckedChildren:"\u7981\u7528",checkedChildren:"\u542f\u7528",disabled:!$api.category.categoryStatus.permission()||1!==t,checked:1===Number(n.status),onChange:function(t){return e.handleTableSwitch(n.id,t?1:2)}})}},{title:"\u4fee\u6539\u65f6\u95f4",dataIndex:"updated_at"},{title:"\u64cd\u4f5c",render:function(t,a){return y.a.createElement("div",null,$api.category.categoryEdit.permission()&&y.a.createElement("a",{onClick:function(){e.editCategory(a)}},"\u7f16\u8f91"),y.a.createElement(oe["a"],{type:"vertical"}),$api.category.categoryDel.permission()&&y.a.createElement(y.a.Fragment,null,y.a.createElement("a",{onClick:function(){e.delCategory(a)}},"\u5220\u9664")))}}]},le=(a("OaEy"),a("2fM7")),se=a("9zFN"),ue=a.n(se),de=function(e){var t=e.treeData,a=void 0===t?[]:t,n=e.getList,r=e.handleCancel,c=e.initForm,o=void 0===c?{status:B["SWITCH_TYPE"].FORBIDDEN}:c,i=Object(g["useState"])(!1),l=K()(i,2),s=l[0],u=l[1],d=A["a"].useForm(),p=K()(d,1),m=p[0];console.log(o);var h=function(e){m.setFieldsValue({thumb:e[0]})},f={pic:o?o.thumb:"",fileTotalCount:1,dataChange:h},E=function(){u(!0),m.validateFields().then(function(e){var t=I()({},o,e,{status:e.status?1:2});o.id?$api.category.categoryEdit(t,{success:!0}).then(function(e){n(),r()}).catch(function(e){u(!1)}):$api.category.categoryAdd(t,{success:!0}).then(function(e){n(),r()}).catch(function(e){u(!1)}),u(!1)}).catch(function(e){u(!1)})},C=function(){var e=ce()(ne.a.mark(function e(t){var a,n,r;return ne.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t),t&&!(t>=1e3)){e.next=3;break}return e.abrupt("return");case 3:if(a=m.getFieldValue("pid"),n={pid:a,id:o.id,sort:t,method:"sort"},!o.id){e.next=11;break}return e.next=8,$api.category.categoryEdit(n);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,$api.category.categoryAdd(n);case 13:e.t0=e.sent;case 14:r=e.t0,r&&!1===r.data&&m.setFields([{name:"sort",value:t,errors:["\u6b64\u6392\u5e8f\u5b58\u5728"]}]);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,a=null;return function(n){clearTimeout(a),a=setTimeout(function(){e(n)},t)}},w={title:o.id?"\u7f16\u8f91\u4e8c\u7ea7\u7c7b\u76ee":"\u65b0\u589e\u4e8c\u7ea7\u7c7b\u76ee",visible:!0,width:500,maskClosable:!1,confirmLoading:s,destroyOnClose:!0,onOk:E,onCancel:r};return y.a.createElement(P["a"],w,y.a.createElement(A["a"],{initialValues:I()({},o,{status:1===Number(o.status)}),form:m},y.a.createElement(A["a"].Item,{label:"\u4e0a\u7ea7\u7c7b\u76ee",name:"pid",rules:[{required:!0,message:"\u8bf7\u9009\u7740\u4e0a\u7ea7\u7c7b\u76ee"}]},y.a.createElement(le["a"],null,a.map(function(e){return y.a.createElement(le["a"].Option,{key:e.id,value:e.id},e.name)}))),y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u7c7b\u76ee\u540d\u79f0"}]},y.a.createElement(q["a"],{placeholder:"\u8bf7\u586b\u5199\u7c7b\u76ee\u540d\u79f0",maxLength:20,autoComplete:"off"})),y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u6392\u5e8f",name:"sort",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7c7b\u76ee\u6392\u5e8f"}]},y.a.createElement(j["a"],{max:999,min:1,precision:0,onChange:S(C)})),y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u56fe\u7247",name:"thumb",rules:[{required:!0,message:"\u8bf7\u4e0a\u4f20\u7c7b\u76ee\u56fe\u7247"}]},y.a.createElement("div",{className:ue.a.uploadHint_box},y.a.createElement(v["G"],f),y.a.createElement("div",{className:ue.a.uploadHint_content},y.a.createElement("p",null,"1.\u683c\u5f0f\uff1a\u56fe\u7247\u4ec5\u652f\u6301JPG\uff0cPNG\u683c\u5f0f"),y.a.createElement("p",null,"2.\u5927\u5c0f\uff1a\u5efa\u8bae1M\u4ee5\u5185")))),y.a.createElement(A["a"].Item,{label:"\u7c7b\u76ee\u72b6\u6001",name:"status",rules:[{required:!0}],valuePropName:"checked"},y.a.createElement(O["a"],{checkedChildren:"\u542f\u7528",unCheckedChildren:"\u7981\u7528"}))))},pe=de;function me(e){return function(){var t,a=f()(e);if(he()){var n=f()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return m()(this,t)}}function he(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var fe=(G=Object(_["connect"])(function(e){var t=e.newCategory,a=e.app,n=e.loading;return I()({},t,{app:a,loading:n})}),G((J=function(e){d()(a,e);var t=me(a);function a(){var e;i()(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r)),e.state={showSecondaryModal:!1,secondaryModalProps:{},switchLoading:!1},e.toggleStatus=function(t,a){e.setState(T()({},t,a))},e.handleCancel=function(){e.toggleStatus("showSecondaryModal",!1)},e.getList=function(t){var a=e.props.dispatch;a({type:"newCategory/getList",payload:I()({page:1},t)})},e.addCategory=function(){var t=e.props,a=t.treeData,n=t.currentId;e.setState({secondaryModalProps:{treeData:a,initForm:{pid:Number(n),status:B["SWITCH_TYPE"].FORBIDDEN},handleCancel:e.handleCancel,getList:e.getList}},function(){e.toggleStatus("showSecondaryModal",!0)})},e.editCategory=function(t){var a=e.props,n=a.treeData,r=a.currentId;e.setState({secondaryModalProps:{treeData:n,initForm:I()({},t,{pid:Number(r)}),handleCancel:e.handleCancel,getList:e.getList}},function(){e.toggleStatus("showSecondaryModal",!0)})},e.delCategory=function(t){var a=e.props.dispatch;$api.category.categoryDel({id:Number(t.id)},{success:!0}).then(function(e){a({type:"newCategory/getList"})})},e.handleSwitch=function(){var t=ce()(ne.a.mark(function t(a,n){var r;return ne.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.setState({switchLoading:!0}),r=e.props.dispatch,t.next=4,$api.category.categoryStatus({id:Number(a),status:n},{success:!0}).then(function(t){r({type:"newCategory/updateState",payload:{currentStatus:n}}),r({type:"newCategory/getTreeData"}),e.setState({switchLoading:!1})}).catch(function(t){e.setState({switchLoading:!1})});case 4:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}(),e.handleTableSwitch=function(t,a){var n=e.props.dispatch;$api.category.categoryStatus({id:Number(t),status:a},{success:!0}).then(function(e){n({type:"newCategory/getList"})})},e.getTableList=function(t){var a=e.props.dispatch;a({type:"newCategory/getList",payload:t})},e}return s()(a,[{key:"render",value:function(){var e=this,t=this.props.app.collapsed?"calc(100% - 378px)":"calc(100% - 468px)",a=this.getTableList,n=this.state,r=n.showSecondaryModal,c=n.secondaryModalProps,o=n.switchLoading,i=this.props,l=i.pagination,s=i.list,u=i.currentStatus,d=i.loading,p=i.currentId;return y.a.createElement(g["Fragment"],null,y.a.createElement("div",{className:"title"},y.a.createElement("div",{className:"secondary-left"},y.a.createElement("div",{className:"mr10"},"\u4e00\u7ea7\u7c7b\u76ee\u72b6\u6001"),y.a.createElement(O["a"],{unCheckedChildren:"\u7981\u7528",checkedChildren:"\u542f\u7528",disabled:!$api.category.categoryStatus.permission(),loading:o,onChange:function(t){return e.handleSwitch(p,t?1:2)},checked:u===B["SWITCH_TYPE"].ENABLE})),y.a.createElement("div",null,$api.category.categoryAdd.permission()&&y.a.createElement(te["a"],{type:"primary",onClick:this.addCategory},"\u65b0\u589e\u4e8c\u7ea7\u7c7b\u76ee"))),y.a.createElement("div",{className:"secondary-table"},y.a.createElement(v["i"],{loading:d.effects["newCategory/getList"],dataSource:s,columns:ie(this),pagination:l,pageProps:{stylePros:{width:t,bottom:16}},getList:a})),r&&y.a.createElement(pe,C()({handleCancel:this.handleCancel},c)))}}]),a}(g["PureComponent"]),U=J))||U),ge=fe;function ye(e){return function(){var t,a=f()(e);if(ve()){var n=f()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return m()(this,t)}}function ve(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}a.d(t,"default",function(){return Ee});var Ee=function(e){d()(a,e);var t=ye(a);function a(){return i()(this,a),t.apply(this,arguments)}return s()(a,[{key:"render",value:function(){return y.a.createElement(v["x"],{inner:!0,className:ue.a.page},y.a.createElement(v["y"],null),y.a.createElement("div",{className:ue.a.container},y.a.createElement("div",{className:"left"},y.a.createElement(ee,null)),y.a.createElement("div",{className:"right"},y.a.createElement(ge,null))))}}]),a}(g["PureComponent"])}}]);