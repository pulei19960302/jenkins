(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{BbJw:function(e,t,a){"use strict";a.r(t);a("14J3");var n,r,l,i=a("BMrR"),s=(a("jCWc"),a("kPKH")),o=(a("2qtc"),a("kLXV")),c=a("2Taf"),u=a.n(c),d=a("vZ4D"),m=a.n(d),p=a("MhPg"),f=a.n(p),h=a("l4Ni"),v=a.n(h),E=a("ujKo"),g=a.n(E),y=a("9UV2"),k=a.n(y),b=a("MuoO"),C=a("q1tI"),L=a.n(C),I=a("Kvkj"),x=a("7Qib"),M=a("F1Dt"),N=(a("/zsF"),a("PArb")),S=a("gWZ8"),D=a.n(S),O=a("wd/R"),R=a.n(O),_=a("d1z9"),w=a.n(_),T=function(e){var t=e&&Object.keys(e).reduce(function(t,a){return t.concat([{value:a,name:e[a]}])},[]),a=t?[{value:"",name:"\u5168\u90e8"}].concat(D()(t)):[{value:"",name:"\u5168\u90e8"}];return[{key:"supplier",placeholder:"\u4f9b\u5e94\u5546\u540d\u79f0/ID"},{key:"status",placeholder:"\u5168\u90e8",type:"enum",enums:a},{key:"time",searchKeys:["update_start_time","update_end_time"],placeholder:["\u66f4\u65b0\u5f00\u59cb\u65f6\u95f4","\u66f4\u65b0\u7ed3\u675f\u65f6\u95f4"],type:"dateRange",inputProps:{ranges:M["c"],disabledDate:function(e){return e<R()().subtract(3,"months")||e>R()().endOf("day")}},initialValue:[R()().subtract(30,"days"),R()()]}]},j=function(e){var t=this;return[{title:"\u4ea4\u6613\u5355\u53f7",dataIndex:"id"},{title:"\u4f9b\u5e94\u5546\u540d\u79f0 / ID",dataIndex:"supplier_name",render:function(e,t){return L.a.createElement("span",null,e,"\xa0/\xa0",t.supplier_id)}},{title:"\u5f85\u7ed3\u8ba2\u5355",dataIndex:"order_num",render:function(e){return L.a.createElement("span",null,k.a.formatNumber(e))}},{title:function(){return L.a.createElement("span",{className:w.a.title},"\u5f85\u7ed3\u603b\u989d")},dataIndex:"money",money:!0},{title:function(){return L.a.createElement("span",{className:w.a.title},"\u5df2\u7ed3\u91d1\u989d")},dataIndex:"paid_amount",money:!0},{title:"\u662f\u5426\u7ed3\u6e05",dataIndex:"status",render:function(e){return L.a.createElement("span",null,e===M["g"].CLOSED?"\u662f":"\u5426")}},{title:"\u64cd\u4f5c\u4eba",dataIndex:"admin_name"},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"updated_at",render:function(e){return L.a.createElement("span",null,e&&R()(1e3*e).format(M["d"].DATETIME))}},{title:"\u5907\u6ce8",width:120,dataIndex:"remark",render:function(e){return L.a.createElement("div",{style:{width:"120px"}},L.a.createElement(I["r"],{text:e,maxLine:"1"}))}},{title:"\u64cd\u4f5c",dataIndex:"operation",render:function(e,a){return L.a.createElement("div",null,Object(M["m"])("suppilerDetails")&&L.a.createElement("span",null,L.a.createElement("a",{onClick:function(){t.handleViewDetails(a)}},"\u8d27\u6b3e\u660e\u7ec6"),L.a.createElement(N["a"],{type:"vertical"})),Object(M["m"])("settle")&&L.a.createElement("a",{onClick:function(){t.onOpenSettleModal(a)}},"\u7ed3\u7b97"))}}]},F=a("SsTz"),P=(a("bbsP"),a("/wGt")),V=(a("5NDa"),a("5rEg")),A=(a("7Kak"),a("9yH6")),q=(a("bP8k"),a("gFTJ")),W=a("WsrF");a("XlDN");function J(e){return function(){var t,a=g()(e);if(K()){var n=g()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return v()(this,t)}}function K(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var $,z,U,B=100,G=(n=W["a"].create(),n((l=function(e){f()(a,e);var t=J(a);function a(e){var n;return u()(this,a),n=t.call(this,e),n.handleCancel=function(){var e=n.props.onCancel;e&&e()},n.handleOk=function(){var e=n.props,t=e.form,a=e.details.id,r=void 0===a?"":a,l=e.onOk;t&&t.validateFields(function(e,t){if(e)return null;var a=t.status,n=void 0===a?"":a,i=t.paid_amount,s=void 0===i?"":i,c=t.remark,u=void 0===c?"":c,d={id:r&&r.toString()||"",status:n&&n.toString()||"",paid_amount:s&&s.toString()||"",remark:u&&u.toString()||""},m=n===M["g"].CLOSED?"\u7ed3\u675f\u7ed3\u7b97":"\u7ed3\u7b97",p=n===M["g"].CLOSED?"\u786e\u8ba4\u7ed3\u6e05\u672c\u6b21\u8d26\u5355\uff1f":"\u786e\u8ba4\u7ed3\u7b97\u672c\u6b21\u8d26\u5355\uff1f";o["a"].confirm({title:m,content:p,cancelText:"\u53d6\u6d88",okText:"\u786e\u5b9a",onOk:function(){$api.finance.settle(d).then(function(e){l&&l()})}})})},n.handleChangeRemark=function(){n.setState({changeRemark:!0})},n.state={changeRemark:!1},n}return m()(a,[{key:"renderInfos",value:function(){var e=this.props.details,t=void 0===e?{}:e,a=t||{},n=a.supplier_name,r=void 0===n?"":n,l=a.supplier_id,i=void 0===l?"":l,s=a.created_at,o=void 0===s?"":s,c=a.order_num,u=void 0===c?"":c,d=a.money,m=void 0===d?"":d,p=a.paid_amount,f=void 0===p?"":p;return L.a.createElement(q["a"],{column:2,className:w.a.settleInfos},L.a.createElement(q["a"].Item,{label:"\u4f9b\u5e94\u5546"},r,"\xa0(",i,")"),L.a.createElement(q["a"].Item,{label:"\u751f\u6210\u65f6\u95f4"},o&&R()(1e3*o).format(M["d"].DATETIME)),L.a.createElement(q["a"].Item,{label:"\u5f85\u7ed3\u8ba2\u5355"},k.a.formatNumber(u)),L.a.createElement(q["a"].Item,{label:"\u5f85\u7ed3\u603b\u989d"},k.a.formatNumber(m),L.a.createElement("span",{style:{marginLeft:10}},"\u5143")),L.a.createElement(q["a"].Item,{label:"\u5df2\u7ed3\u91d1\u989d"},k.a.formatNumber(f),L.a.createElement("span",{style:{marginLeft:10}},"\u5143")))}},{key:"renderForm",value:function(){var e=this.props,t=e.form,a=e.details,n=void 0===a?{}:a,r=n||{},l=r.remark,i=void 0===l?"":l,s=r.status,o=void 0===s?"":s,c=t.getFieldDecorator,u=t&&t.getFieldValue("remark"),d=this.state.changeRemark,m=d?u&&u.length:i&&i.length;return L.a.createElement(W["a"],{className:w.a.settleForm},o===M["g"].WAIT&&L.a.createElement(W["a"].Item,{label:"\u672c\u6b21\u7ed3\u7b97",wrapperCol:{span:10}},c("paid_amount",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ed3\u7b97\u91d1\u989d"}]})(L.a.createElement(I["p"],{addonAfter:"\u5143",formatter:function(e){return Object(x["c"])(e,2)}}))),o===M["g"].WAIT?L.a.createElement(W["a"].Item,{label:"\u662f\u5426\u7ed3\u6e05"},c("status",{initialValue:1})(L.a.createElement(A["a"].Group,{style:{marginLeft:"15px"}},L.a.createElement(A["a"],{value:M["g"].WAIT},"\u5426"),L.a.createElement(A["a"],{value:M["g"].CLOSED},"\u662f")))):L.a.createElement(W["a"].Item,{label:"\u662f\u5426\u7ed3\u6e05"},L.a.createElement("span",null,"\u662f")),L.a.createElement(W["a"].Item,{label:"\u5907\u6ce8"},c("remark",{initialValue:i})(L.a.createElement("div",{style:{position:"relative",width:"330px",marginLeft:"39px"}},L.a.createElement(V["a"].TextArea,{rows:4,defaultValue:i,onChange:this.handleChangeRemark,maxLength:B}),L.a.createElement("span",{className:w.a.nums},m||0,"/",B)))),L.a.createElement(I["j"],{onOk:this.handleOk,onCancel:this.handleCancel}))}},{key:"render",value:function(){var e=this.props.visible;return L.a.createElement(P["a"],{title:"\u7ed3\u7b97",placement:"right",visible:e,maskClosable:!1,destroyOnClose:!0,onClose:this.handleCancel,width:600},this.renderInfos(),this.renderForm())}}]),a}(C["PureComponent"]),r=l))||r),H=G;function X(e){return function(){var t,a=g()(e);if(Z()){var n=g()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return v()(this,t)}}function Z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var Q=($=Object(b["connect"])(function(e){var t=e.supplierList,a=e.loading;return{supplierList:t,loading:a}}),$((U=function(e){f()(a,e);var t=X(a);function a(e){var n;return u()(this,a),n=t.call(this,e),n.onSearch=function(e){var t=n.props.dispatch;t({type:"supplierList/onSearch",payload:e}),t({type:"supplierList/getList",payload:e})},n.onOpenSettleModal=function(e){n.setState({settleDetails:e,settleModal:!0})},n.onCloseSettleModal=function(){n.setState({settleModal:!1})},n.toggleNotesModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n.setState(function(a){return{notesModal:!a.notesModal,id:e,notes:t}})},n.getList=function(e){var t=n.props.dispatch;t({type:"supplierList/getList",payload:e})},n.handleUpdateNotes=function(e){var t=n.state.id;t&&$api.finance.editRemark({id:t,remark:e}).then(function(e){n.getList(),n.toggleNotesModal()})},n.handleCloseLoans=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o["a"].confirm({title:"\u786e\u5b9a\u7ed3\u7b97\u6240\u9009\u8d27\u6b3e\u4e48",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){$api.finance.settle({ids:e,status:t}).then(function(e){n.getList()})}})},n.handleViewDetails=function(e){var t=e.id,a=void 0===t?"":t,n=e.supplier_id,r=void 0===n?"":n;x["j"].push({pathname:"/finance/supplierDetails",query:{id:a,supplier_id:r}})},n.mutipulClick=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=(arguments.length>2&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[]),r=t.join(","),l=a&&a.map(function(e){return e.status}),i=l&&l.join(",");switch(e){case"close":n.handleCloseLoans(r,i);break;default:break}},n.state={notesModal:!1,settleModal:!1,notes:"",id:"",settleDetails:""},n}return m()(a,[{key:"renderTotals",value:function(){var e=this.props.supplierList.sum,t=void 0===e?{}:e,a=t||{},n=a.total,r=void 0===n?"":n,l=a.settle,o=void 0===l?"":l,c=a.settlement,u=void 0===c?"":c;return L.a.createElement(i["a"],{type:"flex",justify:"space-around",className:w.a.totalRow,gutter:16},L.a.createElement(s["a"],{span:8},L.a.createElement("div",{className:w.a.totalCol},L.a.createElement("div",{style:{display:"inline-block"}},L.a.createElement("span",null,"\u603b\u4f9b\u5e94\u5546\u8d27\u6b3e\xa0(\u5143)"),L.a.createElement("span",{className:w.a.num},k.a.formatMoney(r,"\uffe5"))))),L.a.createElement(s["a"],{span:8},L.a.createElement("div",{className:w.a.totalCol},L.a.createElement("div",{style:{display:"inline-block"}},L.a.createElement("span",null,"\u5df2\u7ed3\u7b97\u8d27\u6b3e\xa0(\u5143)"),L.a.createElement("span",{className:w.a.num},k.a.formatMoney(o,"\uffe5"))))),L.a.createElement(s["a"],{span:8},L.a.createElement("div",{className:w.a.totalCol},L.a.createElement("div",{style:{display:"inline-block"}},L.a.createElement("span",null,"\u5f85\u7ed3\u7b97\u8d27\u6b3e\xa0(\u5143)"),L.a.createElement("span",{className:w.a.num},k.a.formatMoney(u,"\uffe5"))))))}},{key:"renderList",value:function(){var e=this.props,t=e.supplierList,a=e.loading,n=t.list,r=void 0===n?[]:n,l=t.pagination,i=t.status,s=t.query,o={search:s};return L.a.createElement(I["i"],{dataSource:r,pagination:l,searchProp:o,searchFields:T(i),columns:j.call(this,i),loading:a.effects["supplierList/getList"],onSearch:this.onSearch,getList:this.getList,mutipulClick:this.mutipulClick})}},{key:"renderNotesModal",value:function(){var e=this.state,t=e.notesModal,a=e.notes;return L.a.createElement(F["a"],{visible:t,notes:a,onCancel:this.toggleNotesModal,onOk:this.handleUpdateNotes})}},{key:"renderSettleModal",value:function(){var e=this,t=this.state,a=t.settleModal,n=t.settleDetails;return L.a.createElement(H,{visible:a,details:n,onCancel:this.onCloseSettleModal,onOk:function(){e.onCloseSettleModal(),e.getList()}})}},{key:"render",value:function(){var e=this.props.supplierList.query,t=void 0===e?"":e,a=[{type:"export",name:"\u5bfc\u51fa",url:$api.finance.supplierExport.url,query:t,permission:Object(M["m"])("supplierExport")}].filter(function(e){return e.permission});return L.a.createElement(I["x"],{inner:!0,className:w.a.supplierList},L.a.createElement(I["y"],{btns:a,className:w.a.totalTitle}),this.renderTotals(),this.renderList(),this.renderNotesModal(),this.renderSettleModal())}}]),a}(C["PureComponent"]),z=U))||z);t["default"]=Q}}]);